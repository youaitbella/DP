<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html [<!ENTITY nbsp "&#160;">]>

<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
                xmlns:inek="http://xmlns.jcp.org/jsf/composite/components/common"
                xmlns:jsf="http://xmlns.jcp.org/jsf">

    <h2>Ergänzende Angaben zur Normalstation</h2>

    <inek:LabeledCheckbox label="Das Krankenhaus hat Ärzte in freier Mitarbeit beschäftigt"
                          readonly="#{editCalcBasicsDrg.readOnly}"
                          value="#{editCalcBasicsDrg.calcBasics.normalFreelancing}"
                          renderElement="normalFreelancing :logout:remaining"/>

    <div jsf:id="normalFreelancing">
        <h:dataTable headerClass="list-header" id="centre"
                     value="#{editCalcBasicsDrg.calcBasics.normalFreelancers}" var="item" width="100%"
                     rowClasses="row1, row2"
                     columnClasses=",,,,centered, centered"
                     rendered="#{editCalcBasicsDrg.calcBasics.normalFreelancing}"
        >

            <h:column>
                <f:facet name="header">

                </f:facet>
                <h:commandLink styleClass="colIcon" rendered="#{!editCalcBasicsDrg.readOnly}">
                    <h:graphicImage alt="#{msg.btnDelete}" name="Icon/small/delete.png" title="#{msg.btnDelete}"
                                    value=""/>
                    <f:ajax event="click" render="@form :logout:remaining"
                            listener="#{editCalcBasicsDrg.deleteFreelancer(item)}"/>
                </h:commandLink>
            </h:column>

            <h:column>
                <f:facet name="header">
                    Bereich
                </f:facet>
                <h:inputText id="division"
                             value="#{item.division}" styleClass="inputwide"
                             validatorMessage="Bereichsname eingeben"
                             readonly="#{editCalcBasicsDrg.readOnly}"
                             required="true">
                    <f:validateLength minimum="1"/>
                    <f:ajax event="blur" render="@this :logout:remaining divisionMsg"/>
                </h:inputText>
                <h:message id="divisionMsg" for="division" styleClass="errorMessage"/>
            </h:column>

            <h:column>
                <f:facet name="header">
                    Anzahl Vollkräfte
                </f:facet>
                <inek:InputNumberWithMessage value="#{item.fullVigorCnt}" styleClass="inputwide" required="true"
                                             readonly="#{editCalcBasicsDrg.readOnly}"
                                             renderElement="@this :logout:remaining"/>
            </h:column>

            <h:column>
                <f:facet name="header">
                    Kostenvolumen (€)
                </f:facet>
                <inek:InputIntegerWithMessage value="#{item.amount}" styleClass="inputwide" required="true"
                                              readonly="#{editCalcBasicsDrg.readOnly}"
                                              renderElement="@this :logout:remaining"/>
            </h:column>

            <h:column>
                <f:facet name="header">
                    KoArtGr 1
                </f:facet>
                <h:selectBooleanCheckbox style="text-align: center;" value="#{item.costType1}" required="true"
                                         disabled="#{editCalcBasicsDrg.readOnly or item.costType6c}">
                    <f:ajax render="@this :logout:remaining"/>
                </h:selectBooleanCheckbox>
            </h:column>

            <h:column>
                <f:facet name="header">
                    KoArtGr 6c
                </f:facet>
                <h:selectBooleanCheckbox value="#{item.costType6c}" required="true"
                                         disabled="#{editCalcBasicsDrg.readOnly or item.costType1}">
                    <f:ajax render="@this :logout:remaining"/>
                </h:selectBooleanCheckbox>
            </h:column>

        </h:dataTable>

        <h:commandLink rendered="#{!editCalcBasicsDrg.readOnly and editCalcBasicsDrg.calcBasics.normalFreelancing}"
                       id="addButton"
                       styleClass="addButton inputPart" value="#{msg.btnAddEntry}">
            <f:ajax event="click" render="@form :logout:remaining" listener="#{editCalcBasicsDrg.addFreelancer()}"/>
        </h:commandLink>
    </div>

    <h2>Honorarverträge gemäß § 121 Abs. 5 SGB V mit Belegärzten</h2>

    <inek:LabeledCheckbox label="Honorarverträge gemäß § 121 Abs. 5 SGB V mit Belegärzten"
                          readonly="#{editCalcBasicsDrg.readOnly}"
                          value="#{editCalcBasicsDrg.calcBasics.feeContract}"
                          renderElement="feeContract :logout:remaining"/>

    <div jsf:id="feeContract">
        <h:dataTable headerClass="list-header"
                     value="#{editCalcBasicsDrg.calcBasics.normalFeeContracts}" var="item" width="100%"
                     rowClasses="row1, row2"
                     columnClasses=""
                     rendered="#{editCalcBasicsDrg.calcBasics.feeContract}"
        >
            <h:column>
                <f:facet name="header">

                </f:facet>
                <h:commandLink styleClass="colIcon" rendered="#{!editCalcBasicsDrg.readOnly}">
                    <h:graphicImage alt="#{msg.btnDelete}" name="Icon/small/delete.png" title="#{msg.btnDelete}"
                                    value=""/>
                    <f:ajax event="click" render="@form :logout:remaining"
                            listener="#{editCalcBasicsDrg.deleteFeeContract(item)}"/>
                </h:commandLink>
            </h:column>

            <h:column>
                <f:facet name="header">
                    Bereich
                </f:facet>
                <h:inputText id="divisionfreeContact" value="#{item.division}" styleClass="inputwide"
                             readonly="#{editCalcBasicsDrg.readOnly}"
                             validatorMessage="Bereichsname eingeben"
                             required="true">
                    <f:ajax event="blur" render="@this :logout:remaining divisionfreeContactMsg"/>
                    <f:validateLength minimum="1"/>
                </h:inputText>
                <h:message id="divisionfreeContactMsg" for="divisionfreeContact" styleClass="errorMessage"/>
            </h:column>

            <h:column>
                <f:facet name="header">
                    FAB-Schlüssel gemäß § 301 SGB V (4-stellig)
                </f:facet>
                <h:inputText id="departmentKey" value="#{item.departmentKey}" styleClass="inputwide"
                             readonly="#{editCalcBasicsDrg.readOnly}"
                             validatorMessage="FAB-Schlüssel eingeben"
                             required="true">
                    <f:validateLength minimum="4"/>
                    <f:ajax render="@this :logout:remaining departmentKeyMsg"/>
                </h:inputText>
                <h:message id="departmentKeyMsg" for="departmentKey" styleClass="errorMessage"/>
            </h:column>

            <h:column>
                <f:facet name="header">
                    Anzahl Fälle
                </f:facet>
                <inek:InputIntegerWithMessage id="caseCnt" value="#{item.caseCnt}" styleClass="inputwide" required="true"
                                              readonly="#{editCalcBasicsDrg.readOnly}"
                                              renderElement="@this :logout:remaining caseCntMsg"/>
            </h:column>
            <h:message id="caseCntMsg" for="caseCnt" styleClass="errorMessage"/>

            <h:column>
                <f:facet name="header">
                    abgegrenztes Kostenvolumen (€)
                </f:facet>
                <inek:InputIntegerWithMessage value="#{item.amount}" styleClass="inputwide" required="true"
                                              readonly="#{editCalcBasicsDrg.readOnly}"
                                              renderElement="@this :logout:remaining"/>
            </h:column>


        </h:dataTable>

        <h:commandLink rendered="#{!editCalcBasicsDrg.readOnly and editCalcBasicsDrg.calcBasics.feeContract}"
                       id="addButton2"
                       styleClass="addButton inputPart" value="#{msg.btnAddEntry}">
            <f:ajax event="click" render="@form :logout:remaining" listener="#{editCalcBasicsDrg.addFeeContract()}"/>
        </h:commandLink>
    </div>

    <h2>Leistungsdokumentation für die Kostenartengruppen 2, 4a und 6a</h2>

    <div jsf:id="serviceCost">
        <table width="100%">
            <tr>
                <th class="colInput">Dokumentation</th>
            </tr>
            <c:forEach items="#{editCalcBasicsDrg.calcBasics.normalStationServiceDocumentations}" var="item"
                       varStatus="loop">
                <tr>
                    <td>
                        <inek:BooleanRadioButton value="#{item.used}" label="#{item.contentText.text}"
                                                 labelStyle="element50"
                                                 readonly="#{editCalcBasicsDrg.readOnly}">
                            <f:ajax event="clientChange"
                                    render="serviceCost :logout:remaining :script"
                                    listener="#{sessionController.hideData(not item.used or item.contentTextId ne 85)}"/>
                        </inek:BooleanRadioButton>
                        <h:panelGroup id="ServiceDocumentationMinutes"
                                      rendered="#{!item.used and item.contentTextId == 85}">
                            <h:dataTable
                                    value="#{editCalcBasicsDrg.calcBasics.normalStationServiceDocumentationMinutes}"
                                    var="minutes"
                                    width="100%"
                                    rowClasses="row1, row2"
                            >
                                <h:column>
                                    <h:commandLink styleClass="colIcon" rendered="#{!editCalcBasicsDrg.readOnly}">
                                        <h:graphicImage alt="#{msg.btnDelete}" name="Icon/small/delete.png"
                                                        title="#{msg.btnDelete}" value=""/>
                                        <f:ajax event="click" render="@form :logout:remaining"
                                                listener="#{editCalcBasicsDrg.deleteNormalStationServiceDocMinutes(minutes)}"/>
                                    </h:commandLink>
                                </h:column>
                                <h:column>
                                    <f:facet name="header">Fachabteilung</f:facet>
                                    <h:inputText id="department" styleClass="inputwide" value="#{minutes.department}"
                                                 readonly="#{editCalcBasicsDrg.readOnly}"
                                                 validatorMessage="Fachabteilung eingeben"
                                                 required="#{!item.used}">
                                        <f:validateLength minimum="1"/>
                                        <f:ajax event="blur" render="@this :logout:remaining departmentMsg" />
                                    </h:inputText>
                                    <h:message id="departmentMsg" for="department" styleClass="errorMessage"/>
                                </h:column>
                                <h:column>
                                    <f:facet name="header">FAB-Schlüssel gemäß § 301 SGB V (4-stellig)</f:facet>
                                    <h:inputText id="departmentKey1" styleClass="inputwide" value="#{minutes.departmentKey}"
                                                 readonly="#{editCalcBasicsDrg.readOnly}"
                                                 validatorMessage="FAB-Schlüssel eingeben"
                                                 required="#{!item.used}">
                                        <f:validateLength minimum="4" />
                                        <f:ajax event="blur" render="@this :logout:remaining departmentKey1Msg"/>
                                    </h:inputText>
                                    <h:message id="departmentKey1Msg" for="departmentKey1" styleClass="errorMessage"/>
                                </h:column>
                                <h:column>
                                    <f:facet name="header">Alternativverfahren</f:facet>
                                    <h:inputText id="alternative" styleClass="inputwide" value="#{minutes.alternative}"
                                                 readonly="#{editCalcBasicsDrg.readOnly}"
                                                 validatorMessage="Bitte ein Alternativverfahren eingeben"
                                                 required="#{!item.used}">
                                        <f:validateLength minimum="1"/>
                                        <f:ajax event="blur" render="@this :logout:remaining alternativeMsg"/>
                                    </h:inputText>
                                    <h:message id="alternativeMsg" for="alternative" styleClass="errorMessage"/>
                                </h:column>
                            </h:dataTable>
                            <h:commandLink id="addButton5" styleClass="addButton inputPart" value="#{msg.btnAddEntry}"
                                           rendered="#{!editCalcBasicsDrg.readOnly}">
                                <f:ajax event="click" render="serviceCost :logout:remaining"
                                        listener="#{editCalcBasicsDrg.addNormalStationServiceDocMinutes()}"/>
                            </h:commandLink>
                        </h:panelGroup>
                    </td>
                </tr>
            </c:forEach>
        </table>
    </div>

    <h2>Hochaufwendige Pflegeleistungen</h2>

    <div class="inputPart">
        <inek:BooleanRadioButton
                label="Es liegen Patienten mit hochaufwendiger Pflege i.S.d. Pflegekomplexmaßnahmen-Scores (PKMS) vor:"
                labelStyle="label50"
                readonly="#{editCalcBasicsDrg.readOnly}"
                value="#{editCalcBasicsDrg.calcBasics.pkmsComplex}"
                renderElement="@this pkmsComplex :logout:remaining"/>
    </div>

    <div jsf:id="pkmsComplex">
        <h:panelGroup rendered="#{editCalcBasicsDrg.calcBasics.pkmsComplex}">
            <div>
                <h:outputLabel styleClass="label50" value=""/>
                <h:outputLabel styleClass="label15 number" value="#{editCalcBasicsDrg.calcBasics.dataYear}"/>
                <h:outputLabel styleClass="label15 number" value="#{editCalcBasicsDrg.calcBasics.dataYear - 1}"/>

                <br/>
                <h:outputLabel value="Anzahl der kalkulierten Fälle mit Pflegekomplexmaßnahmen-Score (PKMS):"
                               styleClass="label50"/>
                <inek:InputIntegerWithMessage value="#{editCalcBasicsDrg.calcBasics.pkmsCaseCnt}"
                                              readonly="#{editCalcBasicsDrg.readOnly}"
                                              styleClass="element15"/>
                <h:outputLabel styleClass="label15 number" value="#{editCalcBasicsDrg.priorCalcBasics.pkmsCaseCnt}">
                    <f:convertNumber/>
                </h:outputLabel>
            </div>
            <div class="inputPart">
                <h:outputLabel value="Die Erfassung des PKMS liegt in allen relevanten Normalstationen vor:"
                               styleClass="label50"/>
                <h:selectOneMenu value="#{editCalcBasicsDrg.calcBasics.pkmsRecording}"
                                 disabled="#{editCalcBasicsDrg.readOnly}">
                    <f:selectItem itemValue="0" itemLabel="Nein"/>
                    <f:selectItem itemValue="1" itemLabel="Ja"/>
                    <f:selectItem itemValue="2" itemLabel="KIS-integriert"/>
                    <f:selectItem itemValue="3" itemLabel="Manuell"/>
                    <f:ajax event="change" render="pkmsComplex :logout:remaining"/>
                </h:selectOneMenu>
            </div>

            <inek:LabeledText id="pkmsOther"
                              label="Bitte erläutern"
                              styleClassLabel="label marginRight"
                              value="#{editCalcBasicsDrg.calcBasics.pkmsOther}"
                              singleLine="true"
                              required="true"
                              rendered="#{editCalcBasicsDrg.calcBasics.pkmsRecording eq 4}"/>

            <div class="marginTop">
                <h:dataTable headerClass="list-header" id="pkmsAlt"
                             value="#{editCalcBasicsDrg.calcBasics.pkmsAlternatives}" var="item" width="100%"
                             rowClasses="row1, row2"
                             columnClasses=""
                             rendered="#{editCalcBasicsDrg.calcBasics.pkmsRecording == 0}"
                >
                    <h:column>
                        <f:facet name="header">

                        </f:facet>
                        <h:commandLink styleClass="colIcon" rendered="#{!editCalcBasicsDrg.readOnly}">
                            <h:graphicImage alt="#{msg.btnDelete}" name="Icon/small/delete.png" title="#{msg.btnDelete}"
                                            value=""/>
                            <f:ajax event="click" render="pkmsComplex :logout:remaining"
                                    listener="#{editCalcBasicsDrg.deletePkmsService(item)}"/>
                        </h:commandLink>
                    </h:column>

                    <h:column>
                        <f:facet name="header">
                            Fachabteilung
                        </f:facet>
                        <h:inputText styleClass="inputwide" value="#{item.department}"
                                     readonly="#{editCalcBasicsDrg.readOnly}">
                            <f:ajax event="blur" render="@this :logout:remaining"/>
                        </h:inputText>
                    </h:column>

                    <h:column>
                        <f:facet name="header">
                            FAB-Schlüssel gemäß § 301 SGB V (4-stellig)
                        </f:facet>
                        <h:inputText styleClass="inputwide" value="#{item.departmentKey}"
                                     readonly="#{editCalcBasicsDrg.readOnly}">
                            <f:ajax event="blur" render="@this :logout:remaining"/>
                        </h:inputText>
                    </h:column>

                    <h:column>
                        <f:facet name="header">
                            Alternativverfahren
                        </f:facet>
                        <h:inputText id="alternative1" styleClass="inputwide" value="#{item.alternative}"
                                     required="true"
                                     validatorMessage="Bitte Alternativverfahren eingeben"
                                     readonly="#{editCalcBasicsDrg.readOnly}">
                            <f:ajax event="blur" render="@this :logout:remaining alternative1Msg"/>
                        </h:inputText>
                        <h:message id="alternative1Msg" for="alternative1" styleClass="errorMessage"/>
                    </h:column>
                </h:dataTable>

                <h:commandLink id="addButton3"
                               rendered="#{!editCalcBasicsDrg.readOnly and editCalcBasicsDrg.calcBasics.pkmsRecording == 0}"
                               styleClass="addButton inputPart" value="#{msg.btnAddEntry}">
                    <f:ajax event="click" render="pkmsComplex :logout:remaining"
                            listener="#{editCalcBasicsDrg.addPkmsService()}"/>
                </h:commandLink>
                <br/>
            </div>
        </h:panelGroup>
    </div>

    <style>
        #tbl {
            table-layout: fixed;
        }

        #tbl thead tr,
        #tbl tfoot tr {
            display: block;
            position: relative;
        }

        #tbl tbody {
            display: block;
            max-height: 300px;
            overflow-y: scroll;
            width: 100%;
        }

        #tbl th.colInput,
        #tbl td.colInput,
        #tbl tfoot td.colInput {
            max-width: 100px !important;
            min-width: 100px !important;
        }

        #tbl thead td.colInput {
            width: 112px;
        }

        #tbl .col7 {
            width: 784px;
        }

        #tbl .col8 {
            width: 896px;
        }

        #tbl .col9 {
            width: 1010px;
        }

        #tbl .col3 {
            width: 330px;
        }

        #tbl tr:first-child th {
            text-align: center;
            font-size: 1.2em;
        }

        #tbl th,
        #tbl td {
            background-color: #7F9BAF;
            font-weight: bold;
            color: white;
            padding: 2px 6px 2px 6px;
        }

        #tbl input {
            width: 100px;
        }

        .red {
            color: red;
        }

        .black {
            color: black;
        }

        .prior {
            width: 100%;
            text-align: right;
            display: inline-block;
        }

        .diff {
            color: #043358;
        }

    </style>

    <h2>Kosten in der Kostenstellengruppe 1 (Normalstation) nach Durchführung der Personalkostenverrechnung</h2>

    <div class="container marginTop">
        <table id="tbl">
            <thead>
            <tr>
                <th class="colIcon"/>
                <th class="col9">Allgemeine Angaben</th>
                <th style="width: 558px;">errechnete Kostensätze</th>
                <th class="col3">Anzahl der zugeordneten VK</th>
                <th class="col7">Kosten der Kostenstelle</th>
            </tr>
            <tr>
                <th class="colIcon"/>
                <th class="colInput">
                    Nummer der Kostenstelle
                </th>
                <th class="colInput">
                    Name der Kostenstelle
                </th>
                <th class="colInput">
                    FAB-Schlüssel gemäß § 301 SGB V (4-stellig)
                </th>
                <th class="colInput">
                    Belegung: FAB
                </th>
                <th class="colInput">
                    Bettenzahl
                </th>
                <th class="colInput">
                    Pflegetage
                </th>
                <th class="colInput">
                    PPR-Minuten
                </th>
                <th class="colInput">
                    zusätzliche Gewichtung außer PPR
                </th>
                <th class="colInput">
                    Auslastung
                </th>
                <th class="colInput">
                    Kostensatz ÄD
                </th>
                <th class="colInput">
                    Kostensatz PD
                </th>
                <th class="colInput">
                    Kostensatz med. Infrastr.
                </th>
                <th class="colInput">
                    Kostensatz nicht med. Infrastr.
                </th>
                <th class="colInput">
                    Bitte bestätigen Sie die Plausibilität des errechneten Kostensatzes oder nehmen Sie ggf. Änderungen vor.
                </th>
                <th class="colInput">
                    Ärztlicher Dienst
                </th>
                <th class="colInput">
                    Pflegedienst
                </th>
                <th class="colInput">
                    Funktionsdienst
                </th>
                <th class="colInput">
                    Ärztlicher Dienst
                </th>
                <th class="colInput">
                    Pflegedienst
                </th>
                <th class="colInput">
                    Funktionsdienst
                </th>
                <th class="colInput">
                    Gemeinkosten Arzneimittel
                </th>
                <th class="colInput">
                    Gemeinkosten med. Sachbedarf
                </th>
                <th class="colInput">
                    medizinische Infrastruktur
                </th>
                <th class="colInput">
                    nicht med. Infrastruktur
                </th>
            </tr>
            </thead>

            <tbody>
            <ui:repeat id="tableContent" value="#{editCalcBasicsDrg.calcBasics.costCenterCosts}" var="x"
                       varStatus="loop">
                <tr>
                    <td class="colIcon">
                        <h:commandLink rendered="#{!editCalcBasicsDrg.readOnly}">
                            <h:graphicImage alt="#{msg.btnDelete}" name="Icon/small/delete.png" title="#{msg.btnDelete}"
                                            value=""/>
                            <f:ajax event="click" render="@form :logout:remaining"
                                    listener="#{editCalcBasicsDrg.deleteCostCenterCosts(x)}"/>
                        </h:commandLink>
                        <h:graphicImage alt="#{msg.btnDelete}" name="Icon/small/emptyPlaceholder.png" value=""
                                        rendered="#{editCalcBasicsDrg.readOnly}"/>
                    </td>
                    <td class="colInput">
                        <inek:InputTextWithMessage value="#{x.costCenterNumber}"
                                                   required="true"
                                                   readonly="#{editCalcBasicsDrg.readOnly}"/>
                    </td>
                    <td class="colInput">
                        <inek:InputTextWithMessage value="#{x.costCenterText}"
                                                   required="true"
                                                   readonly="#{editCalcBasicsDrg.readOnly}"/>
                    </td>
                    <td class="colInput">
                        <inek:InputTextWithMessage value="#{x.departmentKey}"
                                                   required="true"
                                                   readonly="#{editCalcBasicsDrg.readOnly}"/>
                    </td>
                    <td class="colInput">
                        <inek:InputTextWithMessage value="#{x.departmentAssignment}"
                                                   required="true"
                                                   readonly="#{editCalcBasicsDrg.readOnly}"/>
                    </td>
                    <td class="colInput">
                        <inek:InputIntegerWithMessage value="#{x.bedCnt}"
                                                      readonly="#{editCalcBasicsDrg.readOnly}"
                                                      renderElement="tableContent:#{loop.index}:workload approved sumBeds:text"/>
                    </td>
                    <td class="colInput">
                        <inek:InputIntegerWithMessage value="#{x.careDays}" minimum="50"
                                                      readonly="#{editCalcBasicsDrg.readOnly}"
                                                      renderElement="tableContent:#{loop.index}:workload approved"/>
                    </td>
                    <td class="colInput">
                        <inek:InputIntegerWithMessage value="#{x.pprMinutes}"
                                                      readonly="#{editCalcBasicsDrg.readOnly}"/>
                    </td>
                    <td class="colInput">
                        <inek:InputIntegerWithMessage value="#{x.pprWeight}" renderElement="sumAddPpr:text"
                                                      readonly="#{editCalcBasicsDrg.readOnly}"/>
                    </td>
                    <td class="colInput">
                        <!-- Auslastung -->
                        <h:inputText
                                title="#{(x.careDays != 0 and x.bedCnt != 0 and (x.careDays / (x.bedCnt * 365)) lt 0.6) ? 'Der Wert ist unter 60%!' : ''}"
                                styleClass="#{(x.careDays != 0 and x.bedCnt != 0 and (x.careDays / (x.bedCnt * 365)) lt 0.6) ? 'red' : 'black'}"
                                id="workload"
                                value="#{(x.careDays != 0 and x.bedCnt != 0) ? (x.careDays / (x.bedCnt * 365)) : ''}"
                                disabled="true">
                            <f:convertNumber pattern="##%"/>
                        </h:inputText>
                    </td>
                    <!-- Kostensatz ÄD -->
                    <td class="colInput">
                        <h:inputText title="Max. 100 €"
                                     id="rateDoctor"
                                     value="#{(x.medicalServiceAmount != 0 and x.careDays != 0) ? (x.medicalServiceAmount / x.careDays) : ''}"
                                     disabled="false">
                            <f:convertNumber pattern="## €"/>
                        </h:inputText>
                    </td>

                    <!-- Kostensatz PD -->
                    <td class="colInput">
                        <h:inputText title="Max. 50 €"
                                     id="rateCare"
                                     value="#{(x.nursingServiceAmount != 0 and x.pprMinutes != 0) ? (x.nursingServiceAmount / x.pprMinutes) : ''}"
                                     disabled="true">
                            <f:convertNumber pattern="#0.00€"/>
                        </h:inputText>
                    </td>

                    <!-- Kostensatz med. Infrastr. -->
                    <td class="colInput">
                        <h:inputText title="Max. 100 €"
                                     id="rateMedInfra"
                                     value="#{(x.medicalInfrastructureCost != 0 and x.careDays != 0) ? (x.medicalInfrastructureCost / x.careDays) : ''}"
                                     disabled="true">
                            <f:convertNumber pattern="## €"/>
                        </h:inputText>
                    </td>

                    <!-- Kostensatz nicht med. Infrastr. -->
                    <td class="colInput">
                        <h:inputText title="Max. 150 €"
                                     id="rateNonMedInfra"
                                     value="#{(x.nonMedicalInfrastructureCost != 0 and x.careDays != 0) ? (x.nonMedicalInfrastructureCost / x.careDays) : ''}"
                                     disabled="true">
                            <f:convertNumber pattern="## €"/>
                        </h:inputText>
                    </td>

                    <!-- Bestätigung. -->
                    <td class="colInput">
                        <h:selectBooleanCheckbox id="approved"
                                                 style="text-align: center;" value="#{x.acceptPlausibility}"
                                                 required="#{ (x.nonMedicalInfrastructureCost / x.careDays) gt 150
                                                                or (x.medicalInfrastructureCost / x.careDays) gt 100
                                                                or (x.nursingServiceAmount / x.pprMinutes) gt 50
                                                                or (x.medicalServiceAmount / x.careDays) gt 100}}"
                                                 disabled="#{editCalcBasicsDrg.readOnly}">
                            <f:ajax/>
                        </h:selectBooleanCheckbox>
                        <h:message for="approved" id="messageApproved" errorClass="errorMessage"/>
                    </td>

                    <td class="colInput">
                        <h:outputLabel styleClass="prior"
                                       rendered="#{x.prior != null}"
                                       title="Vorjahreswert (#{editCalcBasicsDrg.priorCalcBasics.dataYear})"
                                       value="#{x.prior != null ? x.prior.medicalServiceCnt : ''}">
                            <f:convertNumber pattern="#0.00" locale="de"/>
                        </h:outputLabel>
                        <inek:InputNumberWithMessage value="#{x.medicalServiceCnt}"
                                                     readonly="#{editCalcBasicsDrg.readOnly}"
                                                     renderElement="tableContent:#{loop.index}:diff-msc sumMedicalService:text"/>
                        <h:outputLabel id="diff-msc"
                                       styleClass="prior diff"
                                       rendered="#{x.prior != null}"
                                       value="#{x.prior != null ? editCalcBasicsDrg.calcPercentualDiff(x.prior.medicalServiceCnt, x.medicalServiceCnt) : ''}"/>
                    </td>
                    <td class="colInput">
                        <h:outputLabel styleClass="prior"
                                       rendered="#{x.prior != null}"
                                       title="Vorjahreswert (#{editCalcBasicsDrg.priorCalcBasics.dataYear})"
                                       value="#{x.prior != null ? x.prior.nursingServiceCnt : ''}">
                            <f:convertNumber pattern="#0.00" locale="de"/>
                        </h:outputLabel>
                        <inek:InputNumberWithMessage value="#{x.nursingServiceCnt}"
                                                     readonly="#{editCalcBasicsDrg.readOnly}"
                                                     renderElement="tableContent:#{loop.index}:diff-nsc sumNurseService:text"/>
                        <h:outputLabel id="diff-nsc"
                                       styleClass="prior diff"
                                       rendered="#{x.prior != null}"
                                       value="#{x.prior != null ? editCalcBasicsDrg.calcPercentualDiff(x.prior.nursingServiceCnt, x.nursingServiceCnt) : ''}"/>
                    </td>
                    <td class="colInput">
                        <h:outputLabel styleClass="prior"
                                       rendered="#{x.prior != null}"
                                       title="Vorjahreswert (#{editCalcBasicsDrg.priorCalcBasics.dataYear})"
                                       value="#{x.prior != null ? x.prior.functionalServiceCnt : ''}">
                            <f:convertNumber pattern="#0.00" locale="de"/>
                        </h:outputLabel>
                        <inek:InputNumberWithMessage value="#{x.functionalServiceCnt}"
                                                     readonly="#{editCalcBasicsDrg.readOnly}"
                                                     renderElement="tableContent:#{loop.index}:diff-fsc sumFuncService:text"/>
                        <h:outputLabel id="diff-fsc"
                                       styleClass="prior diff"
                                       rendered="#{x.prior != null}"
                                       value="#{x.prior != null ? editCalcBasicsDrg.calcPercentualDiff(x.prior.functionalServiceCnt, x.functionalServiceCnt) : ''}"/>
                    </td>
                    <td class="colInput">
                        <h:outputLabel styleClass="prior"
                                       rendered="#{x.prior != null}"
                                       title="Vorjahreswert (#{editCalcBasicsDrg.priorCalcBasics.dataYear})"
                                       value="#{x.prior != null ? x.prior.medicalServiceAmount : ''}">
                            <f:convertNumber type="number" locale="de"/>
                        </h:outputLabel>
                        <inek:InputIntegerWithMessage value="#{x.medicalServiceAmount}"
                                                      readonly="#{editCalcBasicsDrg.readOnly}"
                                                      renderElement="tableContent:#{loop.index}:diff-msa approved tableContent:#{loop.index}:rateDoctor sumMedicalService2:text"/>
                        <h:outputLabel id="diff-msa"
                                       styleClass="prior diff"
                                       rendered="#{x.prior != null}"
                                       value="#{x.prior != null ? editCalcBasicsDrg.calcPercentualDiff(x.prior.medicalServiceAmount, x.medicalServiceAmount) : ''}"/>
                    </td>
                    <td class="colInput">
                        <h:outputLabel styleClass="prior"
                                       rendered="#{x.prior != null}"
                                       title="Vorjahreswert (#{editCalcBasicsDrg.priorCalcBasics.dataYear})"
                                       value="#{x.prior != null ? x.prior.nursingServiceAmount : ''}">
                            <f:convertNumber type="number" locale="de"/>
                        </h:outputLabel>
                        <inek:InputIntegerWithMessage value="#{x.nursingServiceAmount}"
                                                      readonly="#{editCalcBasicsDrg.readOnly}"
                                                      renderElement="tableContent:#{loop.index}:diff-nsa approved tableContent:#{loop.index}:rateCare sumNurseService2:text"/>
                        <h:outputLabel id="diff-nsa"
                                       styleClass="prior diff"
                                       rendered="#{x.prior != null}"
                                       value="#{x.prior != null ? editCalcBasicsDrg.calcPercentualDiff(x.prior.nursingServiceAmount, x.nursingServiceAmount) : ''}"/>
                    </td>
                    <td class="colInput">
                        <h:outputLabel styleClass="prior"
                                       rendered="#{x.prior != null}"
                                       title="Vorjahreswert (#{editCalcBasicsDrg.priorCalcBasics.dataYear})"
                                       value="#{x.prior != null ? x.prior.functionalServiceAmount : ''}">
                            <f:convertNumber type="number" locale="de"/>
                        </h:outputLabel>
                        <inek:InputIntegerWithMessage value="#{x.functionalServiceAmount}"
                                                      readonly="#{editCalcBasicsDrg.readOnly}"
                                                      renderElement="tableContent:#{loop.index}:diff-fsa} sumFuncService2:text"/>
                        <h:outputLabel id="diff-fsa"
                                       styleClass="prior diff"
                                       rendered="#{x.prior != null}"
                                       value="#{x.prior != null ? editCalcBasicsDrg.calcPercentualDiff(x.prior.functionalServiceAmount, x.functionalServiceAmount) : ''}"/>
                    </td>
                    <td class="colInput">
                        <h:outputLabel styleClass="prior"
                                       rendered="#{x.prior != null}"
                                       title="Vorjahreswert (#{editCalcBasicsDrg.priorCalcBasics.dataYear})"
                                       value="#{x.prior != null ? x.prior.overheadsMedicine : ''}">
                            <f:convertNumber type="number" locale="de"/>
                        </h:outputLabel>
                        <inek:InputIntegerWithMessage value="#{x.overheadsMedicine}"
                                                      readonly="#{editCalcBasicsDrg.readOnly}"
                                                      renderElement="tableContent:#{loop.index}:diff-oa sumShareMedicine:text"/>
                        <h:outputLabel id="diff-oa"
                                       styleClass="prior diff"
                                       rendered="#{x.prior != null}"
                                       value="#{x.prior != null ? editCalcBasicsDrg.calcPercentualDiff(x.prior.overheadsMedicine, x.overheadsMedicine) : ''}"/>
                    </td>
                    <td class="colInput">
                        <h:outputLabel styleClass="prior"
                                       rendered="#{x.prior != null}"
                                       title="Vorjahreswert (#{editCalcBasicsDrg.priorCalcBasics.dataYear})"
                                       value="#{x.prior != null ? x.prior.overheadsMedicalGoods : ''}">
                            <f:convertNumber type="number" locale="de"/>
                        </h:outputLabel>
                        <inek:InputIntegerWithMessage value="#{x.overheadsMedicalGoods}"
                                                      readonly="#{editCalcBasicsDrg.readOnly}"
                                                      renderElement="tableContent:#{loop.index}:diff-omg sumShareMedicineStuff:text"/>
                        <h:outputLabel id="diff-omg"
                                       rendered="#{x.prior != null}"
                                       styleClass="prior diff"
                                       value="#{x.prior != null ? editCalcBasicsDrg.calcPercentualDiff(x.prior.overheadsMedicalGoods, x.overheadsMedicalGoods) : ''}"/>
                    </td>
                    <td class="colInput">
                        <h:outputLabel styleClass="prior"
                                       rendered="#{x.prior != null}"
                                       title="Vorjahreswert (#{editCalcBasicsDrg.priorCalcBasics.dataYear})"
                                       value="#{x.prior != null ? x.prior.medicalInfrastructureCost : ''}">
                            <f:convertNumber type="number" locale="de"/>
                        </h:outputLabel>
                        <inek:InputIntegerWithMessage value="#{x.medicalInfrastructureCost}"
                                                      readonly="#{editCalcBasicsDrg.readOnly}"
                                                      renderElement="tableContent:#{loop.index}:diff-mic approved tableContent:#{loop.index}:rateMedInfra sumMedInfra:text"/>
                        <h:outputLabel id="diff-mic"
                                       rendered="#{x.prior != null}"
                                       styleClass="prior diff"
                                       value="#{x.prior != null ? editCalcBasicsDrg.calcPercentualDiff(x.prior.medicalInfrastructureCost, x.medicalInfrastructureCost) : ''}"/>
                    </td>
                    <td class="colInput">
                        <h:outputLabel styleClass="prior"
                                       rendered="#{x.prior != null}"
                                       title="Vorjahreswert (#{editCalcBasicsDrg.priorCalcBasics.dataYear})"
                                       value="#{x.prior != null ? x.prior.nonMedicalInfrastructureCost : ''}">
                            <f:convertNumber type="number" locale="de"/>
                        </h:outputLabel>
                        <inek:InputIntegerWithMessage value="#{x.nonMedicalInfrastructureCost}"
                                                      readonly="#{editCalcBasicsDrg.readOnly}"
                                                      renderElement="tableContent:#{loop.index}:diff-nmic approved tableContent:#{loop.index}:rateNonMedInfra sumNonMedInfra:text"/>
                        <h:outputLabel id="diff-nmic"
                                       styleClass="prior diff"
                                       rendered="#{x.prior != null}"
                                       value="#{x.prior != null ? editCalcBasicsDrg.calcPercentualDiff(x.prior.nonMedicalInfrastructureCost, x.nonMedicalInfrastructureCost) : ''}"/>
                    </td>
                </tr>
            </ui:repeat>
            </tbody>

            <tfoot>
            <tr>
                <td class="colIcon"/>
                <td class="colInput">Summen</td>
                <td class="colInput"/>
                <td class="colInput"/>
                <td class="colInput"/>
                <td class="colInput">
                    <inek:InputIntegerWithMessage id="sumBeds"
                                                  value="#{editCalcBasicsDrg.getCostCenterCostsSums().get(0)}"
                                                  disabled="true"/>
                </td>
                <td class="colInput"/>
                <td class="colInput"/>
                <td class="colInput">
                    <inek:InputIntegerWithMessage id="sumAddPpr"
                                                  value="#{editCalcBasicsDrg.getCostCenterCostsSums().get(1)}"
                                                  disabled="true"/>
                </td>
                <td class="colInput"></td>
                <td class="colInput"></td>
                <td class="colInput"></td>
                <td class="colInput"></td>
                <td class="colInput"></td>
                <td class="colInput"></td>
                <td class="colInput">
                    <inek:InputIntegerWithMessage id="sumMedicalService"
                                                  value="#{editCalcBasicsDrg.getCostCenterCostsSums().get(2)}"
                                                  disabled="true"/>
                </td>
                <td class="colInput">
                    <inek:InputIntegerWithMessage id="sumNurseService"
                                                  value="#{editCalcBasicsDrg.getCostCenterCostsSums().get(3)}"
                                                  disabled="true"/>
                </td>
                <td class="colInput">
                    <inek:InputIntegerWithMessage id="sumFuncService"
                                                  value="#{editCalcBasicsDrg.getCostCenterCostsSums().get(4)}"
                                                  disabled="true"/>
                </td>
                <td class="colInput">
                    <inek:InputIntegerWithMessage id="sumMedicalService2"
                                                  value="#{editCalcBasicsDrg.getCostCenterCostsSums().get(5)}"
                                                  disabled="true"/>
                </td>
                <td class="colInput">
                    <inek:InputIntegerWithMessage id="sumNurseService2"
                                                  value="#{editCalcBasicsDrg.getCostCenterCostsSums().get(6)}"
                                                  disabled="true"/>
                </td>
                <td class="colInput">
                    <inek:InputIntegerWithMessage id="sumFuncService2"
                                                  value="#{editCalcBasicsDrg.getCostCenterCostsSums().get(7)}"
                                                  disabled="true"/>
                </td>
                <td class="colInput">
                    <inek:InputIntegerWithMessage id="sumShareMedicine"
                                                  value="#{editCalcBasicsDrg.getCostCenterCostsSums().get(8)}"
                                                  disabled="true"/>
                </td>
                <td class="colInput">
                    <inek:InputIntegerWithMessage id="sumShareMedicineStuff"
                                                  value="#{editCalcBasicsDrg.getCostCenterCostsSums().get(9)}"
                                                  disabled="true"/>
                </td>
                <td class="colInput">
                    <inek:InputIntegerWithMessage id="sumMedInfra"
                                                  value="#{editCalcBasicsDrg.getCostCenterCostsSums().get(10)}"
                                                  disabled="true"/>
                </td>
                <td class="colInput">
                    <inek:InputIntegerWithMessage id="sumNonMedInfra"
                                                  value="#{editCalcBasicsDrg.getCostCenterCostsSums().get(11)}"
                                                  disabled="true"/>
                </td>
            </tr>
            </tfoot>

        </table>

    </div>

    <inek:UploadButtons importer="#{editCalcBasicsDrg.getImporter('drgNormalWard')}"
                        calcbase="#{editCalcBasicsDrg.calcBasics}"
                        readOnly="#{editCalcBasicsDrg.readOnly}"
                        addListener="#{editCalcBasicsDrg.addCostCenterCosts()}"
                        uploadButtonText="Upload"
                        actionDeleteTable="#{editCalcBasicsDrg.deleteAllCostCenterCosts()}"
    />


    <div class="inlineBlock" jsf:rendered="#{sessionController.isInekUser('CALCULATION_HOSPITAL')}">
        <h:commandLink styleClass="button" value="Export" action="#{editCalcBasicsDrg.downloadNormalStation}"
                       immediate="true"/>
    </div>

</ui:composition>

