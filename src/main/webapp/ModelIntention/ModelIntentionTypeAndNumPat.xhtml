<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
                template="ModelIntention.xhtml"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:inek="http://xmlns.jcp.org/jsf/composite/components"
                >

    <ui:define name="editContent">
        <h:form id="form">

            <h2>#{msg.headerAdministrativeData}</h2>
            
            <!-- 
            In a first approach we used the following LabeledText without any render condition.
            Input had been ok, but JSF could not figure out the bean validation.
            Thus, we need to mutually exclusive render vor Non-InEK and InEK role.
            For InEK role, the text expression becomes simplified. No bean validation is fine.
            -->
            <inek:LabeledText styleClass="element30" rendered="#{!sessionController.isInekUser('MODEL_INTENTION')}"
                              readonly="#{not sessionController.isInekUser('MODEL_INTENTION')}"
                              displayAsLabel="true"
                              Label="#{msg.lblModelIntentionCode}" 
                              Text="#{sessionController.isInekUser('MODEL_INTENTION') or editModelIntention.modelIntention.code.length() gt 0
                                      ? editModelIntention.modelIntention.code 
                                      : msg.lblNotGrantedYet}" />
            <inek:LabeledText styleClass="element30" rendered="#{sessionController.isInekUser('MODEL_INTENTION')}" 
                              readonly="#{not sessionController.isInekUser('MODEL_INTENTION')}"
                              displayAsLabel="true"
                              Label="#{msg.lblModelIntentionCode}" 
                              Text="#{editModelIntention.modelIntention.code}" />
            
            <inek:LabeledText Label="#{msg.lblAppellation}" Text="#{editModelIntention.modelIntention.description}" 
                              Required="true" readonly="#{editModelIntention.readOnly}"/>

            
            <h2>#{msg.headerPatientTypes}</h2>
            <br/>
            #{msg.msgPatientTypes}
            <br/>

            <div class="inputPart">
                <h:outputLabel styleClass="label30" id="ageYears" value="#{msg.lblAgeYears} (von - bis):" />
                <h:inputText styleClass="inputshort" id="ageYearsFrom" value="#{editModelIntention.modelIntention.ageYearsFrom}" readonly="#{editModelIntention.readOnly}" >
                    <f:ajax event="blur" render="@this msgAgeYearsFrom :logout:remaining" />
                </h:inputText>
                &nbsp; - &nbsp;
                <h:inputText styleClass="inputshort" id="ageYearsTo" value="#{editModelIntention.modelIntention.ageYearsTo}" readonly="#{editModelIntention.readOnly}">
                    <f:ajax event="blur" render="@this msgAgeYearsTo :logout:remaining" />
                </h:inputText>
                <h:message for="ageYearsFrom" id="msgAgeYearsFrom" styleClass="errorMessage"/>
                <h:message for="ageYearsTo" id="msgAgeYearsTo" styleClass="errorMessage"/>

            </div>
            <div class="inputPart">
                <h:outputLabel styleClass="label30" id="gender" value="#{msg.lblGender}:" />
                <h:selectOneMenu id="genders" value="#{editModelIntention.modelIntention.sex}" readonly="#{editModelIntention.readOnly}">
                    <f:selectItems value="#{valueLists.genders}" />
                    <f:ajax event="change" render="@this :logout:remaining" />
                </h:selectOneMenu>
            </div>

            <inek:LabeledTextarea Label="#{msg.lblPersonalMisc}" Text="#{editModelIntention.modelIntention.miscPatient}" readonly="#{editModelIntention.readOnly}"/>

            <inek:LabeledSelectAndText Label="#{msg.lblRegionalFeatures}" 
                                       SelectElement="#{editModelIntention.modelIntention.regionType}"
                                       SelectItems="#{valueLists.regions}"
                                       Text="#{editModelIntention.modelIntention.region}"
                                       readonly="#{editModelIntention.readOnly}"
                                       />

            <inek:LabeledSelectAndText Label="#{msg.lblMedicalFeature}" 
                                       SelectElement="#{editModelIntention.modelIntention.medicalAttributesType}"
                                       SelectItems="#{valueLists.medicalAttributes}"
                                       Text="#{editModelIntention.modelIntention.medicalSpecification}" 
                                       readonly="#{editModelIntention.readOnly}"
                                       Threshold="0"
                                       />

            <h:outputLabel styleClass="label30" id="insuranceAffiliation" value="#{msg.lblModelIntentionHealthInsurance}:" />
            <h:selectOneMenu id="insuranceAffiliations" value="#{editModelIntention.modelIntention.insuranceAffiliation}" readonly="#{editModelIntention.readOnly}">
                <f:selectItems value="#{valueLists.insuranceAffiliation}" />
                <f:ajax event="change" render="@this :logout:remaining" />
            </h:selectOneMenu>

            <inek:LabeledTextarea Label="#{msg.lblMiscAttr}" Text="#{editModelIntention.modelIntention.miscAttribute}" readonly="#{editModelIntention.readOnly}"/>

            <h:outputLabel styleClass="label30" id="patientAgreement" value="#{msg.lblPatientAgreement}" />
            <h:selectBooleanCheckbox value="#{editModelIntention.modelIntention.agreement}" readonly="#{editModelIntention.readOnly}">
                <f:ajax event="blur" render="@this :logout:remaining" />
            </h:selectBooleanCheckbox>


            <h2>#{msg.headerAssignmentModelIntention}</h2>

            <inek:LabeledSelectAndText Label="#{msg.lblSettledDocs}" 
                                       SelectElement="#{editModelIntention.modelIntention.settleMedicType}"
                                       SelectItems="#{valueLists.settledTypes}"
                                       Text="#{editModelIntention.modelIntention.settleMedicText}"
                                       Threshold="1" 
                                       readonly="#{editModelIntention.readOnly}"
                                       />

            <inek:LabeledSelectAndText Label="#{msg.lblPia}" 
                                       SelectElement="#{editModelIntention.modelIntention.piaType}"
                                       SelectItems="#{valueLists.piaTypes}"
                                       Text="#{editModelIntention.modelIntention.piaText}" 
                                       readonly="#{editModelIntention.readOnly}"
                                       />

            <inek:LabeledSelectAndText Label="#{msg.lblHospital}" 
                                       SelectElement="#{editModelIntention.modelIntention.hospitalType}"
                                       SelectItems="#{valueLists.hospitalTypes}"
                                       Text="#{editModelIntention.modelIntention.hospitalText}"
                                       readonly="#{editModelIntention.readOnly}"
                                       Threshold="2"
                                       />

            <div class="inputpart">
                <h:outputLabel styleClass="label30" id="selfHospitalisation" value="#{msg.lblSelfHospitalisation}:" />
                <h:selectOneMenu id="selfHospitalisationTypes" value="#{editModelIntention.modelIntention.selfHospitalisationType}" readonly="#{editModelIntention.readOnly}">
                    <f:selectItems value="#{editModelIntention.selfHospitalisationTypes}" />
                    <f:ajax event="change" render="@this :logout:remaining" />
                </h:selectOneMenu>
            </div>

            <inek:LabeledTextarea Label="#{msg.lblMiscHospitalisation}" Text="#{editModelIntention.modelIntention.miscHospitalisation}" readonly="#{editModelIntention.readOnly}"/>

        </h:form>

        <ui:include src="#{sessionTools.pages.FragmentAgreedPatients}"/>

    </ui:define>
</ui:composition>
