<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
                template="Cert.xhtml"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:cb="http://inek.org/dataportal/clientbehaviour"
                >

    <ui:define name="editContent">
        <h2>Emailversand</h2>

        <h:form id="frmEmailSending">
            
            <div class="inputPart">
                <h:outputLabel styleClass="label30">
                    Template:
                </h:outputLabel>
                <h:selectOneMenu id="selectedTemplate" styleClass="inputmedium" value="#{certMail.selectedTemplate}">
                    <f:selectItems value="#{certMail.emailTemplates}"/>
                    <f:ajax event="change" render="@this :logout:remaining" />
                </h:selectOneMenu> 
            </div>
            
            <br/>
            
            <div class="inputPart">
                <h:outputLabel styleClass="label30">
                    System-Empfängerliste:
                </h:outputLabel>
                <h:selectOneMenu id="selectedSystemReceiverList" styleClass="inputmedium" value="#{certMail.systemReceiverList}">
                    <f:selectItems value="#{certMail.systemReceiverLists}"/>
                    <f:ajax event="change" render="@form availableLists tblEmailReceiversTemplate receiverListText selectedReceiver :logout:remaining" listener="#{certMail.receiverChanged}" />
                </h:selectOneMenu>
            </div>
            
            <!--<div class="inputPart">
                <h:outputLabel styleClass="label30">
                    eigene Empfängerliste:
                </h:outputLabel>
                <h:selectOneMenu id="selectedReceiverList" styleClass="inputmedium" value="# {certMail.receiverList}">
                    <f:selectItems value="# {certMail.emailReceiverLists}"/>
                    <f:ajax event="change" render="@this selectedSystemReceiverList selectedReceiver :logout:remaining" listener="# {certMail.receiverChanged}"/>
                </h:selectOneMenu>
            </div>-->
            <br />
            <div class="inputPart">
                <h:outputLabel styleClass="label30">
                    eigene Empfängerliste:
                </h:outputLabel>
                <h:selectOneMenu id="availableLists" styleClass="inputmedium" value="#{certMail.selectedListEdit}">
                    <f:selectItems value="#{certMail.emailReceiverLists}"/>
                    <f:ajax event="change" render="@form selectedReceiver selectedSystemReceiverList :logout:remaining" listener="#{certMail.editReceiverListChanged}" />
                </h:selectOneMenu> 
            </div>
            
            <div class="inputPart">
                <h:outputLabel styleClass="label30">
                    Bezeichnung:
                </h:outputLabel>
                <h:inputText styleClass="inputmedium" id="receiverListText" value="#{certMail.receiverListsName}">
                    <f:ajax event="blur" render="@this :logout:remaining" />
                </h:inputText>
            </div>
            
            <div class="inputPart">
                <h:outputLabel styleClass="label30">
                    Empfänger-Auswahl:
                </h:outputLabel>
                <h:selectOneMenu id="receiverNewList" styleClass="inputlong" value="#{certMail.selectedReceiverNewList}">
                    <f:selectItems value="#{certMail.singleReceivers}"/>
                    <f:ajax event="change" render="@this :logout:remaining" />
                </h:selectOneMenu> 
            </div>
            
            <h:dataTable rendered="#{certMail.renderEmailReceiverTable()}" value="#{certMail.emailReceivers}" headerClass="list-header" id="tblEmailReceiversTemplate"
                         var="er" width="100%" rowClasses="row1, row2" columnClasses="colIcon, colValue">
                <h:column id="colDeleteId" >
                    <f:facet name="header">
                        <h:outputText value=""/>
                    </f:facet>
                    <h:commandLink action="#{certMail.deleteReceiverFromTemplate(er.emailReceiversId, er.accountId)}" immediate="true" >
                        <h:graphicImage alt="löschen" name="delete.png" library="Icon/small" title="Löschen" value=""/>
                    </h:commandLink>
                </h:column>
                <h:column id="colName">
                    <f:facet name="header">
                        <h:outputText value="Name"/>
                    </f:facet>
                    <h:outputLabel value="#{certMail.getCompanyNameByAccId(er.accountId)}"/>
                </h:column>
            </h:dataTable>
            
            <div class="inputPart" style="float: right;">
                <h:commandLink styleClass="button" value="Empfänger hinzufügen" action="#{certMail.addReceiverToList}"/>
            </div>
            
            <br style="clear: right;"/>
            
            <div class="inputPart" style="float: right;">
                <h:commandLink styleClass="button" id="btnDeleteTemplate" value="Empfängerliste löschen" action="#{certMail.deleteReceiverList}"/>
                <h:commandLink styleClass="button" id="btnSaveTemplate" value="Empfängerliste speichern" action="#{certMail.saveReceiverList}"/>
            </div>
            
            <br style="clear: right;"/>
            <br/>
            
            <div class="inputPart">
                <h:outputLabel styleClass="label30">
                    einzelner Empfänger:
                </h:outputLabel>
                <h:selectOneMenu id="selectedReceiver" styleClass="inputlong" value="#{certMail.singleReceiver}">
                    <f:selectItems value="#{certMail.singleReceivers}"/>
                    <f:ajax event="change" render="@form availableLists tblEmailReceiversTemplate receiverListText selectedSystemReceiverList :logout:remaining" listener="#{certMail.receiverChanged}"/>
                </h:selectOneMenu>    
            </div>
            
            <br />
            
            <div class="inputPart" style="text-align: center; width:99%;">
                <h:message for="btnPreview" styleClass="errorMessage" style="border: red solid thin; padding: 3px"/>
            </div>
            
            <div class="inputPart" style="float: right;">
                <h:commandLink id="btnPreview" styleClass="button" value="Email-Vorschau" action="#{certMail.showPreview}" binding="#{certMail.previewButton}"/>
                <h:button id="btnSendMails" styleClass="button" value="Emails abschicken" />
            </div>
            <div style="clear: both;"/>
        </h:form>
        
        <br />
        
        <h:panelGroup rendered="#{certMail.previewEnabled()}">
            <h2>
                Email-Vorschau
            </h2>
            <h:form id="frmEmailPreview">
                <div class="inputPart">
                    <h:outputLabel styleClass="label15" value="Empfänger:" />
                    <h:selectOneMenu id="selectEmailReceiverPreview" styleClass="inputmedium" value="#{certMail.selectedEmailAddressPreview}">
                        <f:selectItems value="#{certMail.emailAddressForPreview}" />
                        <f:ajax event="change" render="@form :logout:remaining" listener="#{certMail.changedPreviewReceiver}"/>
                    </h:selectOneMenu>
                </div>
                
                <div class="inputPart">
                    <h:outputLabel styleClass="label15" value="Betreff:" />
                    <h:inputText styleClass="inputlong" id="previewSubject" value="#{certMail.previewSubject}" readonly="true"/>
                </div>
                
                <div class="inputPart">
                    <h:outputLabel styleClass="label15" value="Inhalt:" />
                    <h:inputTextarea styleClass="areaHuge" id="previewBody" value="#{certMail.previewBody}" readonly="true"/>
                </div>
            </h:form>
        </h:panelGroup>

    </ui:define>

</ui:composition>
