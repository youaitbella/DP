<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
                template="Cert.xhtml"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:cb="http://inek.org/dataportal/clientbehaviour"
                >

    <ui:define name="editContent">
        <h2>Emailversand</h2>

        <h:form id="frmEmailSending">
            
            <div class="inputPart">
                <h:outputLabel styleClass="label30">
                    Template:
                </h:outputLabel>
                <h:selectOneMenu id="selectedTemplate" styleClass="inputmedium" value="#{certMail.selectedTemplate}">
                    <f:selectItems value="#{certMail.emailTemplates}"/>
                    <f:ajax event="change" render="@this :logout:remaining" />
                </h:selectOneMenu> 
            </div>
            
            <br/>
            
            <div class="inputPart">
                <h:outputLabel styleClass="label30">
                    System-Empfängerliste:
                </h:outputLabel>
                <h:selectOneMenu id="selectedSystemReceiverList" styleClass="inputmedium" value="#{certMail.systemReceiverList}">
                    <f:selectItems value="#{certMail.systemReceiverLists}"/>
                    <f:ajax event="change" render="@this selectedReceiverList selectedReceiver :logout:remaining" listener="#{certMail.receiverChanged}" />
                </h:selectOneMenu>
            </div>
            
            <div class="inputPart">
                <h:outputLabel styleClass="label30">
                    eigene Empfängerliste:
                </h:outputLabel>
                <h:selectOneMenu id="selectedReceiverList" styleClass="inputmedium" value="#{certMail.receiverList}">
                    <f:selectItems value="#{certMail.emailReceiverLists}"/>
                    <f:ajax event="change" render="@this selectedSystemReceiverList selectedReceiver :logout:remaining" listener="#{certMail.receiverChanged}"/>
                </h:selectOneMenu>
            </div>
            
            <div class="inputPart">
                <h:outputLabel styleClass="label30">
                    einzelner Empfänger:
                </h:outputLabel>
                <h:selectOneMenu id="selectedReceiver" styleClass="inputlong" value="#{certMail.singleReceiver}">
                    <f:selectItems value="#{certMail.singleReceivers}"/>
                    <f:ajax event="change" render="@this selectedReceiverList selectedSystemReceiverList :logout:remaining" listener="#{certMail.receiverChanged}"/>
                </h:selectOneMenu>    
            </div>
            
            <br />
            
            <div class="inputPart" style="float: right;">
                <h:button id="btnPreview" styleClass="button" value="Email-Vorschau" />
                <h:button id="btnSendMails" styleClass="button" value="Emails abschicken" />
            </div>
            

        </h:form>
        
        <br />
        
        <h:form id="frmEmailTemplate">
            
            <h2>Empfängerliste</h2>
            
            <div class="inputPart">
                <h:outputLabel styleClass="label30">
                    vorhandene Listen:
                </h:outputLabel>
                <h:selectOneMenu id="availableLists" styleClass="inputmedium" value="#{certMail.selectedListEdit}">
                    <f:selectItems value="#{certMail.emailReceiverLists}"/>
                    <f:ajax event="change" render="@this tblEmailReceiversTemplate receiverListText :logout:remaining" listener="#{certMail.editReceiverListChanged}" />
                </h:selectOneMenu> 
            </div>
            
            <br/>
            
            <div class="inputPart">
                <h:outputLabel styleClass="label30">
                    Bezeichnung:
                </h:outputLabel>
                <h:inputText styleClass="inputmedium" id="receiverListText" value="#{certMail.receiverListsName}">
                    <f:ajax event="blur" render="@this :logout:remaining" />
                </h:inputText>
            </div>
            
            <div class="inputPart">
                <h:outputLabel styleClass="label30">
                    Empfänger-Auswahl:
                </h:outputLabel>
                <h:selectOneMenu id="receiverNewList" styleClass="inputlong" value="#{certMail.selectedReceiverNewList}">
                    <f:selectItems value="#{certMail.singleReceivers}"/>
                    <f:ajax event="change" render="@this :logout:remaining" />
                </h:selectOneMenu> 
            </div>
            
            <h:dataTable value="#{certMail.emailReceivers}" headerClass="list-header" id="tblEmailReceiversTemplate"
                         var="er" width="100%" rowClasses="row1, row2" columnClasses="colIcon, colValue">
                <h:column id="colDeleteId" >
                    <f:facet name="header">
                        <h:outputText value=""/>
                    </f:facet>
                    <h:commandLink action="#" immediate="true" >
                        <h:graphicImage alt="löschen" name="delete.png" library="Icon/small" title="Löschen" value=""/>
                    </h:commandLink>
                </h:column>
                <h:column id="colName">
                    <f:facet name="header">
                        <h:outputText value="Name"/>
                    </f:facet>
                    <h:outputLabel value="#{certMail.getCompanyNameByAccId(er.accountId)}"/>
                </h:column>
            </h:dataTable>
            
            <div class="inputPart" style="float: right;">
                <h:commandLink styleClass="button" value="Empfänger hinzufügen" action="#{certMail.addReceiverToList}"/>
            </div>
            
            <br style="clear: both;"/><br/>
            
            <div class="inputPart" style="float: right;">
                <h:commandLink styleClass="button" id="btnDeleteTemplate" value="Empfängerliste löschen" />
                <h:commandLink styleClass="button" id="btnSaveTemplate" value="Empfängerliste speichern" action="#{certMail.saveReceiverList}"/>
            </div>
            
            <div style="clear:both;" />
        </h:form>


    </ui:define>

</ui:composition>
