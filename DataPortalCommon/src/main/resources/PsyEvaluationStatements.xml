<statements>

    <statement id="KH_2_3_5_6_8_9">
        select biid
        from (
        select ROW_NUMBER() over (partition by bi.biIk order by bi.biIk, bi.biTyp ,bi.bistatusid, bi.biSend desc) as
        'rowNum', bi.biId
        from psy.AEBBaseInformation bi
        where bi.biIk = {ik}
        and bi.biDataYear = {year}
        and bi.biStatusId in (10,200)
        ) a
        where a.rowNum = 1;
    </statement>

    <statement id="KH_1_4_7">
        <![CDATA[
            select biid
            from (
            select ROW_NUMBER() over (partition by bi.biIk order by bi.biIk,bi.biDataYear desc,bi.biTyp ,bi.bistatusid, bi.biSend desc) as
            'rowNum', bi.biId
            from psy.AEBBaseInformation bi
            where bi.biIk = {ik}
            and bi.biDataYear <= {year}
            and bi.biStatusId in (10,200)
            ) a
            where a.rowNum = 1;
        ]]>
    </statement>

    <statement id="Gruppe_2_3_8_9">
        declare @year int;
        declare @psyGroupid int

        set @year = {year};
        set @psyGroupid = {psyGroupId};

        select biid
        from (
        select ROW_NUMBER() over (partition by bi.biIk order by bi.biIk, bi.biTyp ,bi.bistatusid, bi.biSend desc) as
        'rowNum', bi.biId
        from psy.AEBBaseInformation bi
        where bi.biIk in (
        select eh.ehIk
        from psy.ExpectedHospital eh
        where eh.ehYear = @year
        and eh.ehPsyGroup = @psyGroupid
        and ehIk in (
        select b.ik
        from (
        select cu.cuik as 'ik', case when cu.cuPsyStateId = 255 then cu.cuStateId else cu.cuPsyStateId end as 'stateId'
        from CallCenterDB.dbo.ccCustomer cu
        where cuIsTest = 0
        and cuIsActive = 1
        ) b
        where b.stateId in ({stateIds})
        ))
        and bi.biDataYear = @year
        and bi.biStatusId in (10,200)
        ) a
        where a.rowNum = 1
    </statement>

    <statement id="Gruppe_1_7">
        <![CDATA[
            declare @year int;
            declare @psyGroupid int

            set @year = {year};
            set @psyGroupid = {psyGroupId};

            select biid
            from (
            select ROW_NUMBER() over (partition by bi.biIk order by bi.biIk ,bi.biDataYear desc , bi.biTyp ,bi.bistatusid, bi.biSend desc) as
            'rowNum', bi.biId
            from psy.AEBBaseInformation bi
            where bi.biIk in (
            select eh.ehIk
            from psy.ExpectedHospital eh
            where eh.ehYear = <@year
            and eh.ehPsyGroup = @psyGroupid
            and ehIk in (
            select b.ik
            from (
            select cu.cuik as 'ik', case when cu.cuPsyStateId = 255 then cu.cuStateId else cu.cuPsyStateId end as 'stateId'
            from CallCenterDB.dbo.ccCustomer cu
            where cuIsTest = 0
            and cuIsActive = 1
            ) b
            where b.stateId in ({stateIds})
            ))
            and bi.biDataYear <= @year
            and bi.biStatusId in (10,200)
            ) a
            where a.rowNum = 1
        ]]>
    </statement>

    <statement id="Gruppe_5_6">
        declare @year int;
        declare @psyGroupid int

        set @year = {year};
        set @psyGroupid = {psyGroupId};

        select biid
        from (
        select ROW_NUMBER() over (partition by bi.biIk order by bi.biIk, bi.biTyp ,bi.bistatusid, bi.biSend desc) as
        'rowNum', bi.biId
        from psy.AEBBaseInformation bi
        where bi.biIk in (
        select b.ik
        from (
        select cu.cuik as 'ik', case when cu.cuPsyStateId = 255 then cu.cuStateId else cu.cuPsyStateId end as 'stateId'
        from CallCenterDB.dbo.ccCustomer cu
        where cuIsTest = 0
        and cuIsActive = 1
        ) b
        where b.stateId in ({stateIds}))
        and bi.biDataYear = @year
        and bi.biStatusId in (10,200)
        ) a
        where a.rowNum = 1
    </statement>

    <statement id="Gruppe_4">
        <![CDATA[
            declare @year int;
            declare @psyGroupid int

            set @year = {year};
            set @psyGroupid = {psyGroupId};

            select biid
            from (
            select ROW_NUMBER() over (partition by bi.biIk order by bi.biIk, bi.biDataYear desc , bi.biTyp ,bi.bistatusid, bi.biSend desc) as
            'rowNum', bi.biId
            from psy.AEBBaseInformation bi
            where bi.biIk in (
            select b.ik
            from (
            select cu.cuik as 'ik', case when cu.cuPsyStateId = 255 then cu.cuStateId else cu.cuPsyStateId end as 'stateId'
            from CallCenterDB.dbo.ccCustomer cu
            where cuIsTest = 0
            and cuIsActive = 1
            ) b
            where b.stateId in ({stateIds}))
            and bi.biDataYear <= @year
            and bi.biStatusId in (10,200)
            ) a
            where a.rowNum = 1
        ]]>
    </statement>

</statements>