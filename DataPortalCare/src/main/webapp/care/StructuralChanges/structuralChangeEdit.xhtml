<?xml version='1.0' encoding='UTF-8' ?>

<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/WEB-INF/template.xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:jsf="http://xmlns.jcp.org/jsf"
                xmlns:pf="http://primefaces.org/ui"
                xmlns:inekIk="http://xmlns.jcp.org/jsf/composite/components/Other"
                xmlns:inekInput="http://xmlns.jcp.org/jsf/composite/components/Input"
                xmlns:inekIcon="http://xmlns.jcp.org/jsf/composite/components/Icons"
                xmlns:f="http://xmlns.jcp.org/jsf/core">

    <ui:define name="title">Umbenennung oder strukturelle Veränderungen (§ 5 Abs. 4 PpUGV)</ui:define>

    <ui:define name="content">

        <style>
            .ui-datatable-odd {
                background: #d9dfe6 !important;
            }

            .ui-datatable-even {
                background: #F2F5F9;
            }

            .MARKER_1 {
                background-color: #fca752 !important;
                background-image: none !important;
                color: #000000 !important;
            }

            .MARKER_2 {
                background-color: #389c4c !important;
                background-image: none !important;
                color: #000000 !important;
            }

            .GLOBAL_MESSAGE::before {
                content: "Bei der Prüfung sind Fehler aufgetreten:";
            }

            .GLOBAL_MESSAGE::after {
                content: "Bitte prüfen Sie Ihre Eingaben. Die fehlerhaften Felder sind mit einer Fehlermeldung markiert.";
            }
        </style>

        <div style="margin-top: 10px;">
            <pf:commandButton value="HiddenButton"
                              style="display: none"
                              tabindex="0"
                              immediate="true"/>

            <pf:commandButton value="Zurück zur Übersicht"
                              icon="fa fa-arrow-left"
                              action="#{structuralChangesEdit.navigateToSummary()}"
                              immediate="true"/>
        </div>


        <h:form id="change">

            <pf:importEnum type="org.inek.dataportal.care.enums.StructuralChangesType"
                           var="StructuralChangesType"
                           allSuffix="ALL_ENUM_VALUES"/>

            <div class="ui-g">
                <div class="card" style="width: 100%">
                    <div class="ui-g-12">
                        <inekIk:MultiIk_V2 label="#{msg.lblIkShort}"
                                           required="true"
                                           value="#{structuralChangesEdit.structuralChangesBaseInformation.ik}"
                                           ikList="#{structuralChangesEdit.iks}"
                                           readonly="#{not structuralChangesEdit.changeIkAllowed}"
                                           listener="#{structuralChangesEdit.ikChanged()}"
                                           isFixed="#{structuralChangesEdit.structuralChangesBaseInformation.id gt 0}"
                                           updateElement="@form"/>

                    </div>
                </div>
            </div>

            <div class="ui-g">
                <div class="card" style="width: 100%">
                    <div class="ui-g-12">
                        <h1>Meldung von Umbenennungen oder strukturellen Veränderungen (§ 5 Abs. 4 PpUGV)</h1>

                        <div style="text-align: justify; border: 1px solid #ffa727; padding: 10px;">
                            <br/>
                            In diesem Bereich geben Sie Änderungen im Sinne des § 5 Abs. 4 PpUGV (ersatzloser Wegfall einer mitzuteilenden Fachabteilung oder Station oder eines pflegesensitiven Bereichs; Benennung von Nachfolgeeinheiten von Stationen oder mitzuteilenden Fachabteilungen (Umbenennungen oder strukturelle Veränderungen)) an.
                            Nachfolgend werden in der Stationsübersicht alle Stationen angezeigt, welche Sie im Rahmen der Mitteilung gemäß § 5 Abs. 3 PpUGV abschließend an das InEK übermittelt haben.
                            <br/>
                            <br/>
                            Sie können Änderungen im Sinne des § 5 Abs. 4 PpUGV wie folgt erfassen:
                            Änderungen, die bereits benannte Stationen betreffen, können Sie jeweils in der letzten Spalte unter dem Button „Aktionen“ vornehmen und entweder die „Stationsdaten ändern“, die „Station temporär abmelden“ oder die „Station löschen“. Unter der Überschrift „Weitere Aktionen“ können Sie zudem eine „neue Station hinzufügen“.
                            <br/>
                            <br/>
                            Bei einem Fehleintrag können Sie die hinzugefügte Zeile mit dem „Papierkorb“-Button wieder löschen.
                            <br/>
                            <br/>
                            Sie können Ihre Eingaben jederzeit speichern ohne diese direkt an das InEK zu übermitteln. So können Sie schrittweise arbeiten und erst nach Beendigung der Eingabe die Daten an das InEK übermitteln (Button „Änderungsmeldung ans InEK senden“). Gespeicherte Meldungen finden Sie auf der Übersichtsseite in der Rubrik „In Erfassung“. Sie können dort Ihre Änderung zu einem späteren Zeitpunkt erneut öffnen, weiter bearbeiten und diese abschließend an das InEK übermitteln (Button „Änderungsmeldung ans InEK senden“). Nach erfolgreicher Übermittlung erhalten Sie eine Bestätigung per E-Mail über den erfolgreichen Dateneingang im InEK. Es folgt ein Freigabeprozess durch das InEK. Nach Abschluss der Bearbeitung werden Sie per E-Mail darüber informiert.
                            <br/>
                            <br/>
                            Bei Fragen konsultieren Sie bitte zunächst den Text der Rechtsverordnung sowie die auf unserer Internetseite bereitgestellte
                            <a href="https://www.g-drg.de/Pflegepersonaluntergrenzen_2020/Umsetzung_der_Verordnung_zur_Festlegung_von_Pflegepersonaluntergrenzen_in_pflegesensitiven_Bereichen_in_Krankenhaeusern_PpUGV_fuer_das_Jahr_2020/FAQ_PpUGV_2020"
                               target="_blank">FAQ-Liste</a>. Bei darüber hinaus gehenden Fragestellungen können Sie sich gerne an das PpUG-Betreuungsteam im InEK wenden (per E-Mail:
                            <a href="mailto:PPUGV-Umsetzung@inek-drg.de">PPUGV-Umsetzung@inek-drg.de</a> bzw. per Telefon: (02241) 93 82 500).
                        </div>

                        <br/>

                        <div style="text-align: justify; border: 1px solid #ffa727; padding: 10px;"
                             jsf:rendered="#{not structuralChangesEdit.readOnly}">
                            <pf:fieldset legend="Ausfüllhinweise"
                                         style="border: none"
                                         toggleable="true"
                                         toggleSpeed="500"
                                         collapsed="true">
                                <p>Möchten Sie eine
                                    <u>Nachfolgeeinheit einer Station (aufgrund von Umbenennung oder struktureller Änderung)</u> benennen, nutzen Sie bitte den Button „Stationsdaten ändern“ in der Zeile der entsprechenden Station. Dort geben Sie die Daten der neuen Station ein und benennen die Kategorie entsprechend der durchgeführten Änderung. Die ursprünglich genannte Station wird damit zum Datum ihrer Gültigkeitsangabe abgemeldet.
                                </p>
                                <p>Möchten Sie
                                    <u>Nachfolgeeinheiten einer Fachabteilung (aufgrund von Umbenennung oder struktureller Änderung)</u> benennen, nutzen Sie bitte den Button „Stationsdaten ändern“ in der Zeile der entsprechenden Station(en) mit diesem FAB-Schlüssel. Dort geben Sie in den neuen Tabellenzeilen die neuen Fachabteilungsschlüssel ein und benennen die Kategorie entsprechend der durchgeführten Änderung. Sie können zudem das Datum angeben, ab wann diese Änderung gültig ist.
                                </p>
                                <p>Möchten Sie
                                    <u>mehrere Stationen zu einer neuen oder bestehenden Station zusammenfassen (aufgrund von Umbenennung oder struktureller Änderung)</u>, nutzen Sie bitte bei den entsprechenden Stationen den Button „Stationsdaten ändern“. Bei diesen Stationen können Sie entweder die Daten einer bestehenden Station eintragen (identische Stationsnamen sind zu verwenden), zu welcher die Stationen zusammengefasst werden oder eine neue Station eintragen. Sie können zudem das Datum angeben, ab wann diese Änderung gültig ist.
                                </p>
                                <p>Möchten Sie den
                                    <u>ersatzlosen Wegfall einer Fachabteilung</u> anzeigen (z.B. da Ihr Krankenhaus diesen Bereich nicht weiter führt), nutzen Sie bitte den Button „Station löschen“ und benennen die Kategorie entsprechend der durchgeführten Änderung. Sie können zudem das Datum angeben, ab wann diese Änderung gültig ist.
                                </p>
                                <p>Möchten Sie den
                                    <u>ersatzlosen Wegfall einer Station</u> (z.B. wegen Schließung der Station) mitteilen, benutzen Sie bitte den Button „Station löschen“, nennen das Datum der Schließung und benennen die Kategorie entsprechend der durchgeführten Änderung. Sie können zudem das Datum angeben, ab wann diese Änderung gültig ist.
                                </p>
                                <p>Soll eine Station einem <u>pflegesensitiven Bereich</u> nicht mehr zugeordnet werden,
                                    <u>da dieser ersatzlos wegfällt,</u> nutzen Sie bitte den Button „Station löschen“ in der Zeile der entsprechenden Station an und benennen die Kategorie entsprechend der durchgeführten Änderung. Sie können zudem das Datum angeben, ab wann diese Änderung gültig ist.
                                </p>
                                <p>Soll eine Station
                                    <u>temporär geschlossen werden</u>, nutzen Sie bitte den Button „Station temporär abmelden“ und nennen das Datum der Schließung und der Wiedereröffnung. Benennen Sie die Kategorie entsprechend der durchgeführten Änderung. Sie können zudem das Datum angeben, ab wann diese Änderung gültig ist.
                                </p>
                                <p>Möchten Sie eine neue Station hinzufügen, die keinen „Vorgänger“ hat, nutzen Sie bitte den Button
                                    „neue Station hinzufügen“ und geben die entsprechenden Daten an.
                                </p>
                            </pf:fieldset>
                        </div>

                        <h1>Stationsübersicht</h1>

                        <pf:dataTable value="#{structuralChangesEdit.wards}"
                                      tableStyle="width: 100%;"
                                      emptyMessage="Keine Daten vorhanden"
                                      var="ward"
                                      id="wardTable">
                            <pf:column headerText="Pflegesensitiver Bereich">
                                <pf:outputLabel value="#{ward.dept.sensitiveArea}"/>
                            </pf:column>
                            <pf:column headerText="Fachabteilungsnummer">
                                <pf:outputLabel value="#{ward.fab}"/>
                            </pf:column>
                            <pf:column headerText="Fachabteilungsname">
                                <pf:outputLabel value="#{ward.deptName}"/>
                            </pf:column>
                            <pf:column headerText="Stationsbezeichnung">
                                <pf:outputLabel value="#{ward.wardName}"/>
                            </pf:column>
                            <pf:column headerText="Standort nach § 21 KHEntgG">
                                <pf:outputLabel value="#{ward.locationCodeP21}"/>
                            </pf:column>
                            <pf:column headerText="Standort(nummer) nach § 293 Abs. 6 SGB V">
                                <pf:outputLabel value="#{ward.locationText}"/>
                            </pf:column>
                            <pf:column headerText="Bettenanzahl der Station">
                                <pf:outputLabel value="#{ward.bedCount}"/>
                            </pf:column>
                            <pf:column headerText="Gültig von">
                                <pf:outputLabel value="#{ward.validFrom}">
                                    <f:convertDateTime type="date" pattern="dd.MM.yyyy" timeZone="Europe/Berlin"/>
                                </pf:outputLabel>
                            </pf:column>
                            <pf:column headerText="Gültig bis">
                                <pf:outputLabel value="#{ward.validToDisplayText}"/>
                            </pf:column>
                            <pf:column rendered="#{not structuralChangesEdit.readOnly}">
                                <pf:splitButton value="Aktionen">
                                    <pf:menuitem value="Stationsdaten ändern"
                                                 update="@form"
                                                 immediate="true"
                                                 action="#{structuralChangesEdit.newChangeWard(ward)}"/>
                                    <pf:menuitem value="Station temporär abmelden"
                                                 update="@form"
                                                 immediate="true"
                                                 action="#{structuralChangesEdit.closeWardTemp(ward)}"/>
                                    <pf:menuitem value="Station löschen"
                                                 update="@form"
                                                 immediate="true"
                                                 action="#{structuralChangesEdit.closeWard(ward)}"/>
                                </pf:splitButton>
                            </pf:column>
                        </pf:dataTable>
                    </div>
                    <div class="ui-g-12" jsf:rendered="#{not structuralChangesEdit.readOnly}">
                        <br/>

                        <h1>Weitere Aktionen</h1>

                        <br/>

                        <pf:commandButton value="neue Station hinzufügen"
                                          action="#{structuralChangesEdit.createNewWard()}"
                                          style="margin-left: 10px;"
                                          immediate="true"
                                          update="@(.ui-message) @form"/>

                    </div>
                </div>

                <div class="card" style="width: 100%"
                     jsf:rendered="#{structuralChangesEdit.getChangesBaseInformationsByType(StructuralChangesType.NEW).size() gt 0}">
                    <!-- Neue Station -->
                    <div class="ui-g-12">
                        <h1>Informationen zur neuen Station</h1>
                        <pf:dataTable id="tableNewWard"
                                      value="#{structuralChangesEdit.getChangesBaseInformationsByType(StructuralChangesType.NEW)}"
                                      tableStyle="width: auto;"
                                      rowStyleClass="#{baseInfo.structuralChangesMarker.name()}"
                                      var="baseInfo">
                            <pf:column class="colIcon" style="width: 20px;">
                                <inekIcon:DeleteIcon
                                        deleteFunction="#{structuralChangesEdit.changesBaseInformation(baseInfo)}"
                                        rendered="#{not structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                        updateElement="@form"/>
                                <pf:commandButton value=""
                                                  action="#{structuralChangesEdit.changeMarkerValue(baseInfo)}"
                                                  rendered="#{structuralChangesEdit.isInekUser()
                                                    and structuralChangesEdit.structuralChangesBaseInformation.statusId eq 10}"
                                                  immediate="true"
                                                  update=":change:tableNewWard"/>
                            </pf:column>
                            <pf:column headerText="Pflegesensitiver Bereich" style="width: 9em;">
                                <pf:selectOneMenu id="catNewArea"
                                                  value="#{baseInfo.wardsToChange.sensitiveAreaId}"
                                                  required="true"
                                                  disabled="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}">
                                    <f:selectItem itemLabel="#{msg.lblChooseEntryShort}" itemValue="#{0}"
                                                  noSelectionOption="true"/>
                                    <f:selectItems value="#{structuralChangesEdit.sensitiveAreas}"/>
                                    <pf:ajax update="catNewArea fabNew catNewAreaMsg :change:aggregatedTable"/>
                                </pf:selectOneMenu>
                                <pf:message id="catNewAreaMsg" for="catNewArea"/>
                            </pf:column>
                            <pf:column headerText="Fachabteilungs- nummer" style="width: 8em;">
                                <inekInput:InputTextValidator id="fabNew"
                                                              value="#{baseInfo.wardsToChange.fab}"
                                                              Style="width: calc(100% - 1em);"
                                                              require="#{structuralChangesEdit.fabRequired(baseInfo.wardsToChange)}"
                                                              readonly="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                                              validatorFunction="#{structuralChangesEdit.isFabValid}"
                                                              validatorMessage="Ungültige FAB"
                                                              updateComponents=":change:aggregatedTable"
                                                              maxlength="4"/>
                            </pf:column>
                            <pf:column headerText="Fachabteilungsname" style="width: 11em;">
                                <inekInput:InputText value="#{baseInfo.wardsToChange.deptName}"
                                                     require="true"
                                                     readonly="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                                     Style="width: calc(100% - 1em);"
                                                     updateComponents=":change:aggregatedTable"
                                                     requiredMessage="Bitte geben Sie den Fachabteilungsnamen aus Ihrem Haus ein"/>
                            </pf:column>
                            <pf:column headerText="Stationsbezeichnung" style="width: 11em;">
                                <inekInput:InputText value="#{baseInfo.wardsToChange.wardName}"
                                                     require="true"
                                                     readonly="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                                     Style="width: calc(100% - 1em);"
                                                     updateComponents=":change:aggregatedTable"
                                                     requiredMessage="Bitte geben Sie eine Stationsbezeichnung ein"/>
                            </pf:column>
                            <pf:column headerText="Standort nach § 21 KHEntgG"
                                       style="text-align: right; width: 7em;">
                                <inekInput:InputNumberValidator value="#{baseInfo.wardsToChange.locationP21}"
                                                                readonly="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                                                validatorFunction="#{structuralChangesEdit.isP21LocationCodeValid}"
                                                                validatorMessage="Ungültiger Standort nach § 21 KHEntgG für diese IK"
                                                                renderElement=":change:aggregatedTable"
                                                                Style="width: calc(100% - 1em);"/>

                            </pf:column>
                            <pf:column headerText="Standort(nummer) nach § 293 Abs. 6 SGB V" style="width: 9em;">
                                <inekInput:InputTextValidator value="#{baseInfo.wardsToChange.locationVz}"
                                                              Style="width: calc(100% - 1em);"
                                                              maxlength="100"
                                                              require="true"
                                                              requiredMessage="Bitte geben Sie die Standortnummer nach § 293 Abs. 6 SGB V an oder benennen Sie den Standort möglichst präzise."
                                                              readonly="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                                              updateComponents=":change:aggregatedTable"
                                                              validatorFunction="#{structuralChangesEdit.isVZLocationCodeValid}"
                                                              validatorMessage="In Ihrer Eingabe wurde eine Standortnummer erkannt. Sie ist jedoch für dieses IK ungültig."/>

                            </pf:column>
                            <pf:column headerText="Bettenanzahl der Station" style="text-align: right; width: 6em;">
                                <inekInput:InputNumber value="#{baseInfo.wardsToChange.beds}"
                                                       Style="width: calc(100% - 1em);"
                                                       readonly="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                                       renderElement=":change:aggregatedTable"
                                                       minValue="1"
                                                       maxValue="999"/>
                            </pf:column>
                            <pf:column headerText="Gültig ab" style="width: 6em;">
                                <pf:calendar id="newValidFrom"
                                             value="#{baseInfo.wardsToChange.validFrom}"
                                             required="true"
                                             requiredMessage="Bitte ein Datum angeben"
                                             locale="de"
                                             navigator="true"
                                             pattern="dd.MM.yyyy"
                                             mask="true"
                                             mindate="1.1.2018"
                                             disabled="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                             inputStyle="text-align: left;">
                                    <pf:ajax event="change" update=":change:aggregatedTable"/>
                                    <pf:ajax event="dateSelect" update=":change:aggregatedTable"/>
                                </pf:calendar>
                                <pf:message for="newValidFrom"/>
                            </pf:column>

                            <pf:column headerText="Anmerkung" style="min-width: 35em; max-width: 60em;">
                                <pf:inputTextarea id="commentNew"
                                                  value="#{baseInfo.wardsToChange.comment}"
                                                  readonly="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                                  required="true"
                                                  requiredMessage="Bitte geben Sie eine Anmerkung an"
                                                  maxlength="500"
                                                  style="width: calc(100% - 1em);"
                                                  rows="2">
                                    <pf:ajax update="commentNewMsg"/>
                                </pf:inputTextarea>
                                <pf:message id="commentNewMsg" for="commentNew"/>
                            </pf:column>F
                        </pf:dataTable>
                    </div>
                </div>

                <div class="card" style="width: 100%"
                     jsf:rendered="#{structuralChangesEdit.getChangesBaseInformationsByType(StructuralChangesType.CHANGE).size() gt 0}">
                    <!-- Stationsänderung -->
                    <div class="ui-g-12">
                        <h1>Stationsdaten ändern</h1>
                        <pf:dataTable id="tableChangeWard"
                                      value="#{structuralChangesEdit.getChangesBaseInformationsByType(StructuralChangesType.CHANGE)}"
                                      tableStyle="width: auto;"
                                      rowStyleClass="#{baseInfo.structuralChangesMarker.name()}"
                                      var="baseInfo">
                            <pf:column class="colIcon" style="width: 20px;">
                                <inekIcon:DeleteIcon
                                        deleteFunction="#{structuralChangesEdit.changesBaseInformation(baseInfo)}"
                                        rendered="#{not structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                        updateElement="@form"/>
                                <pf:commandButton value=""
                                                  action="#{structuralChangesEdit.changeMarkerValue(baseInfo)}"
                                                  rendered="#{structuralChangesEdit.isInekUser()
                                                    and structuralChangesEdit.structuralChangesBaseInformation.statusId eq 10}"
                                                  immediate="true"
                                                  styleClass="#{baseInfo.structuralChangesMarker.nextColor().name()}"
                                                  update=":change:tableChangeWard"/>
                            </pf:column>
                            <pf:column headerText="Pflegesensitiver Bereich" style="width: 9em;">
                                <pf:outputLabel value=" "/>
                                <pf:separator/>
                                <pf:outputLabel value="#{baseInfo.wardsToChange.deptWard.dept.sensitiveArea}"/>
                            </pf:column>
                            <pf:column headerText="Fachabteilungs- nummer" style="width: 8em;">
                                <pf:outputLabel value="#{baseInfo.wardsToChange.deptWard.fab}"/>
                                <pf:separator/>
                                <inekInput:InputTextValidator value="#{baseInfo.wardsToChange.fab}"
                                                              Style="width: calc(100% - 1em);"
                                                              require="#{structuralChangesEdit.fabRequired(baseInfo.wardsToChange)}"
                                                              readonly="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                                              updateComponents=":change:aggregatedTable"
                                                              validatorFunction="#{structuralChangesEdit.isFabValid}"
                                                              validatorMessage="Ungültige Fachabteilungsnummer"
                                                              maxlength="4"/>
                            </pf:column>
                            <pf:column headerText="Fachabteilungsname" style="width: 11em;">
                                <pf:outputLabel value="#{baseInfo.wardsToChange.deptWard.deptName}"/>
                                <pf:separator/>
                                <inekInput:InputText value="#{baseInfo.wardsToChange.deptName}"
                                                     require="true"
                                                     readonly="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                                     updateComponents=":change:aggregatedTable"
                                                     Style="width: calc(100% - 1em);"
                                                     requiredMessage="Bitte geben Sie den Fachabteilungsnamen aus Ihrem Haus ein"/>
                            </pf:column>
                            <pf:column headerText="Stationsbezeichnung" style="width: 11em;">
                                <pf:outputLabel value="#{baseInfo.wardsToChange.deptWard.wardName}"/>
                                <pf:separator/>
                                <inekInput:InputText value="#{baseInfo.wardsToChange.wardName}"
                                                     require="true"
                                                     readonly="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                                     updateComponents=":change:aggregatedTable"
                                                     Style="width: calc(100% - 1em);"
                                                     requiredMessage="Bitte geben Sie eine Stationsbezeichnung ein"/>
                            </pf:column>
                            <pf:column headerText="Standort nach § 21 KHEntgG"
                                       style="text-align: right; width: 7em;">
                                <pf:outputLabel
                                        value="#{baseInfo.wardsToChange.deptWard.locationCodeP21}"/>
                                <pf:separator/>
                                <inekInput:InputNumberValidator value="#{baseInfo.wardsToChange.locationP21}"
                                                                readonly="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                                                validatorFunction="#{structuralChangesEdit.isP21LocationCodeValid}"
                                                                validatorMessage="Ungültiger Standort nach § 21 KHEntgG für diese IK"
                                                                renderElement=":change:aggregatedTable"
                                                                Style="width: calc(100% - 1em);"/>
                            </pf:column>
                            <pf:column headerText="Standort(nummer) nach § 293 Abs. 6 SGB V" style="width: 9em;">
                                <pf:outputLabel
                                        value="#{baseInfo.wardsToChange.deptWard.locationText}"/>
                                <pf:separator/>
                                <inekInput:InputTextValidator value="#{baseInfo.wardsToChange.locationVz}"
                                                              Style="width: calc(100% - 1em);"
                                                              maxlength="100"
                                                              require="true"
                                                              updateComponents=":change:aggregatedTable"
                                                              requiredMessage="Bitte geben Sie die Standortnummer nach § 293 Abs. 6 SGB V an oder benennen Sie den Standort möglichst präzise."
                                                              readonly="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                                              validatorFunction="#{structuralChangesEdit.isVZLocationCodeValid}"
                                                              validatorMessage="In Ihrer Eingabe wurde eine Standortnummer erkannt. Sie ist jedoch für dieses IK ungültig."/>

                            </pf:column>
                            <pf:column headerText="Bettenanzahl der Station" style="text-align: right; width: 6em;">
                                <pf:outputLabel value="#{baseInfo.wardsToChange.deptWard.bedCount}"/>
                                <pf:separator/>
                                <inekInput:InputNumber value="#{baseInfo.wardsToChange.beds}"
                                                       Style="width: calc(100% - 1em);"
                                                       readonly="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                                       renderElement=":change:aggregatedTable"
                                                       minValue="1"
                                                       maxValue="999"/>
                            </pf:column>
                            <pf:column headerText="Änderung gültig ab" style="width: 6em;">
                                <pf:outputLabel value=" "/>
                                <pf:separator/>
                                <pf:calendar id="changeValidFrom"
                                             value="#{baseInfo.wardsToChange.validFrom}"
                                             style="width: calc(100% - 1em);"
                                             required="true"
                                             requiredMessage="Bitte ein Datum angeben"
                                             locale="de"
                                             navigator="true"
                                             pattern="dd.MM.yyyy"
                                             mask="true"
                                             mindate="1.1.2018"
                                             disabled="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}">
                                    <pf:ajax event="change" update=":change:aggregatedTable"/>
                                    <pf:ajax event="dateSelect" update=":change:aggregatedTable"/>
                                </pf:calendar>
                                <pf:message for="changeValidFrom"/>
                            </pf:column>
                            <pf:column headerText="Kategorie">
                                <pf:outputLabel value=" "/>
                                <pf:separator/>
                                <pf:selectOneMenu id="catNew"
                                                  value="#{baseInfo.structuralChangesDetailTypeId}"
                                                  required="true"
                                                  disabled="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}">
                                    <f:selectItem itemLabel="#{msg.lblChooseEntryShort}" itemValue="#{0}"
                                                  noSelectionOption="true"/>
                                    <f:selectItems value="#{structuralChangesEdit.changeReasons}"/>
                                </pf:selectOneMenu>
                                <pf:message for="catNew"/>
                            </pf:column>
                            <pf:column headerText="Anmerkung" style="min-width: 35em; max-width: 60em;">
                                <pf:inputTextarea id="commentChange"
                                                  value="#{baseInfo.wardsToChange.comment}"
                                                  readonly="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                                  required="true"
                                                  requiredMessage="Bitte geben Sie eine Anmerkung an"
                                                  maxlength="500"
                                                  style="width: calc(100% - 1em);"
                                                  rows="2">
                                    <pf:ajax update="commentChangeMsg"/>
                                </pf:inputTextarea>

                                <pf:message id="commentChangeMsg" for="commentChange"/>
                            </pf:column>
                        </pf:dataTable>
                    </div>
                </div>

                <!-- Stationsschließung -->
                <div class="card" style="width: 100%"
                     jsf:rendered="#{structuralChangesEdit.getChangesBaseInformationsByType(StructuralChangesType.CLOSE).size() gt 0}">
                    <div class="ui-g-12">
                        <h1>Station löschen</h1>
                        <pf:dataTable id="tableCloseWard"
                                      value="#{structuralChangesEdit.getChangesBaseInformationsByType(StructuralChangesType.CLOSE)}"
                                      tableStyle="width: auto;"
                                      rowStyleClass="#{baseInfo.structuralChangesMarker.name()}"
                                      var="baseInfo">
                            <pf:column class="colIcon" style="width: 20px;">
                                <inekIcon:DeleteIcon
                                        rendered="#{not structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                        deleteFunction="#{structuralChangesEdit.changesBaseInformation(baseInfo)}"
                                        updateElement="@form"/>
                                <pf:commandButton value=""
                                                  action="#{structuralChangesEdit.changeMarkerValue(baseInfo)}"
                                                  rendered="#{structuralChangesEdit.isInekUser()
                                                    and structuralChangesEdit.structuralChangesBaseInformation.statusId eq 10}"
                                                  immediate="true"
                                                  styleClass="#{baseInfo.structuralChangesMarker.nextColor().name()}"
                                                  update=":change:tableCloseWard"/>
                            </pf:column>
                            <pf:column headerText="Pflegesensitiver Bereich" style="width: 9em;">
                                <pf:outputLabel value="#{baseInfo.wardsToChange.deptWard.dept.sensitiveArea}"/>
                            </pf:column>
                            <pf:column headerText="Fachabteilungs- nummer" style="width: 8em;">
                                <pf:outputLabel value="#{baseInfo.wardsToChange.deptWard.fab}"/>
                            </pf:column>
                            <pf:column headerText="Fachabteilungsname">
                                <pf:outputLabel value="#{baseInfo.wardsToChange.deptWard.deptName}"/>
                            </pf:column>
                            <pf:column headerText="Stationsbezeichnung">
                                <pf:outputLabel value="#{baseInfo.wardsToChange.deptWard.wardName}"/>
                            </pf:column>
                            <pf:column headerText="Standort nach § 21 KHEntgG" style="width: 7em;">
                                <pf:outputLabel
                                        value="#{baseInfo.wardsToChange.deptWard.locationCodeP21}"/>
                            </pf:column>
                            <pf:column headerText="Standort(nummer) nach § 293 Abs. 6 SGB V" style="width: 9em;">
                                <pf:outputLabel
                                        value="#{baseInfo.wardsToChange.deptWard.locationText}"/>
                            </pf:column>
                            <pf:column headerText="Bettenanzahl der Station" style="width: 6em;">
                                <pf:outputLabel value="#{baseInfo.wardsToChange.deptWard.bedCount}"/>
                            </pf:column>
                            <pf:column headerText="Änderung gültig ab" style="width: 6em;">
                                <pf:calendar id="closeValidFrom"
                                             value="#{baseInfo.wardsToChange.validFrom}"
                                             required="true"
                                             requiredMessage="Bitte ein Datum angeben"
                                             locale="de"
                                             navigator="true"
                                             pattern="dd.MM.yyyy"
                                             mask="true"
                                             mindate="1.1.2018"
                                             disabled="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                             inputStyle="text-align: left;">
                                    <pf:ajax event="change" update=":change:aggregatedTable"/>
                                    <pf:ajax event="dateSelect" update=":change:aggregatedTable"/>
                                </pf:calendar>
                                <pf:message for="closeValidFrom"/>
                            </pf:column>

                            <pf:column headerText="Kategorie" style="width: 20em;">
                                <pf:selectOneMenu id="catDelete"
                                                  value="#{baseInfo.structuralChangesDetailTypeId}"
                                                  required="true"
                                                  disabled="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}">
                                    <f:selectItem itemLabel="#{msg.lblChooseEntryShort}" itemValue="#{0}"
                                                  noSelectionOption="true"/>
                                    <f:selectItems value="#{structuralChangesEdit.closeReasons}"/>
                                </pf:selectOneMenu>
                                <pf:message for="catDelete"/>
                            </pf:column>
                            <pf:column headerText="Anmerkung" style="min-width: 35em; max-width: 60em;">
                                <pf:inputTextarea id="commentclose"
                                                  value="#{baseInfo.wardsToChange.comment}"
                                                  readonly="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                                  required="true"
                                                  requiredMessage="Bitte geben Sie eine Anmerkung an"
                                                  maxlength="500"
                                                  style="width: calc(100% - 1em);"
                                                  rows="2">
                                    <pf:ajax update="commentcloseMsg"/>
                                </pf:inputTextarea>

                                <pf:message id="commentcloseMsg" for="commentclose"/>
                            </pf:column>
                        </pf:dataTable>
                    </div>
                </div>

                <!-- Station temp schliesen -->
                <div class="card" style="width: 100%"
                     jsf:rendered="#{structuralChangesEdit.getChangesBaseInformationsByType(StructuralChangesType.CLOSE_TEMP).size() gt 0}">
                    <div class="ui-g-12">
                        <h1>Station temporär abmelden</h1>
                        <pf:dataTable id="tableCloseTempWard"
                                      value="#{structuralChangesEdit.getChangesBaseInformationsByType(StructuralChangesType.CLOSE_TEMP)}"
                                      tableStyle="width: auto;"
                                      rowStyleClass="#{baseInfo.structuralChangesMarker.name()}"
                                      var="baseInfo">
                            <pf:column class="colIcon" style="width: 20px;">
                                <inekIcon:DeleteIcon
                                        rendered="#{not structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                        deleteFunction="#{structuralChangesEdit.changesBaseInformation(baseInfo)}"
                                        updateElement="@form"/>
                                <pf:commandButton value=""
                                                  action="#{structuralChangesEdit.changeMarkerValue(baseInfo)}"
                                                  rendered="#{structuralChangesEdit.isInekUser()
                                                    and structuralChangesEdit.structuralChangesBaseInformation.statusId eq 10}"
                                                  immediate="true"
                                                  styleClass="#{baseInfo.structuralChangesMarker.nextColor().name()}"
                                                  update=":change:tableCloseTempWard"/>
                            </pf:column>
                            <pf:column headerText="Pflegesensitiver Bereich" style="width: 9em;">
                                <pf:outputLabel value="#{baseInfo.wardsToChange.deptWard.dept.sensitiveArea}"/>
                            </pf:column>
                            <pf:column headerText="Fachabteilungs- nummer" style="width: 8em;">
                                <pf:outputLabel value="#{baseInfo.wardsToChange.deptWard.fab}"/>
                            </pf:column>
                            <pf:column headerText="Fachabteilungsname">
                                <pf:outputLabel value="#{baseInfo.wardsToChange.deptWard.deptName}"/>
                            </pf:column>
                            <pf:column headerText="Stationsbezeichnung">
                                <pf:outputLabel value="#{baseInfo.wardsToChange.deptWard.wardName}"/>
                            </pf:column>
                            <pf:column headerText="Standort nach § 21 KHEntgG" style="width: 7em;">
                                <pf:outputLabel
                                        value="#{baseInfo.wardsToChange.deptWard.locationCodeP21}"/>
                            </pf:column>
                            <pf:column headerText="Standort(nummer) nach § 293 Abs. 6 SGB V" style="width: 9em;">
                                <pf:outputLabel
                                        value="#{baseInfo.wardsToChange.deptWard.locationText}"/>
                            </pf:column>
                            <pf:column headerText="Bettenanzahl der Station" style="width: 6em;">
                                <pf:outputLabel value="#{baseInfo.wardsToChange.deptWard.bedCount}"/>
                            </pf:column>
                            <pf:column headerText="Änderung gültig ab" style="width: 6em;">
                                <pf:calendar id="closeTmpValidFrom"
                                             value="#{baseInfo.wardsToChange.validFrom}"
                                             required="true"
                                             requiredMessage="Bitte ein Datum angeben"
                                             locale="de"
                                             navigator="true"
                                             pattern="dd.MM.yyyy"
                                             mask="true"
                                             mindate="1.1.2018"
                                             disabled="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                             inputStyle="text-align: left;">
                                    <pf:ajax event="change" update=":change:aggregatedTable dateValidTo"/>
                                    <pf:ajax event="dateSelect" update=":change:aggregatedTable dateValidTo"/>
                                </pf:calendar>
                                <pf:message for="closeTmpValidFrom"/>
                            </pf:column>

                            <pf:column headerText="Änderung gültig bis" style="width: 6em;">
                                <pf:calendar id="dateValidTo"
                                             value="#{baseInfo.wardsToChange.validTo}"
                                             mindate="#{baseInfo.wardsToChange.validFrom}"
                                             required="true"
                                             requiredMessage="Bitte ein Datum angeben"
                                             locale="de"
                                             navigator="true"
                                             pattern="dd.MM.yyyy"
                                             mask="true"
                                             disabled="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                             inputStyle="text-align: left;">
                                    <pf:ajax event="change" update=":change:aggregatedTable"/>
                                    <pf:ajax event="dateSelect" update=":change:aggregatedTable"/>
                                </pf:calendar>
                                <pf:message for="dateValidTo"/>
                            </pf:column>

                            <pf:column headerText="Kategorie" style="width: 20em;">
                                <pf:selectOneMenu id="catCloseTmp"
                                                  value="#{baseInfo.structuralChangesDetailTypeId}"
                                                  required="true"
                                                  disabled="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}">
                                    <f:selectItem itemLabel="#{msg.lblChooseEntryShort}" itemValue="#{0}"
                                                  noSelectionOption="true"/>
                                    <f:selectItems value="#{structuralChangesEdit.closeTmpReasons}"/>
                                </pf:selectOneMenu>
                                <pf:message for="catCloseTmp"/>
                            </pf:column>
                            <pf:column headerText="Anmerkung" style="min-width: 35em; max-width: 60em;">
                                <pf:inputTextarea id="commentcloseTmp"
                                                  value="#{baseInfo.wardsToChange.comment}"
                                                  readonly="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                                  required="true"
                                                  requiredMessage="Bitte geben Sie eine Anmerkung an"
                                                  maxlength="500"
                                                  style="width: calc(100% - 1em);"
                                                  rows="2">
                                    <pf:ajax update="commentcloseTmpMsg"/>
                                </pf:inputTextarea>

                                <pf:message id="commentcloseTmpMsg" for="commentcloseTmp"/>
                            </pf:column>
                        </pf:dataTable>
                    </div>
                </div>

                <div class="ui-g-12" jsf:id="aggregatedTable">
                    <h1>Zusammengefasste Stationsübersicht inklusive Umbenennung und strukturellen Änderungen</h1>

                    <pf:dataTable value="#{structuralChangesEdit.aggregatedWards}"
                                  tableStyle="width: 100%;"
                                  emptyMessage="Es konnten keine Aggregate erstellt werden"
                                  var="aggregate">
                        <pf:column headerText="Gültig von" style="width: 120px;">
                            <h:outputText value="#{aggregate.validFrom}">
                                <f:convertDateTime pattern="dd.MM.yyyy"/>
                            </h:outputText>
                        </pf:column>
                        <pf:column headerText="Gültig bis" style="width: 120px;">
                            <h:outputText value="#{aggregate.validTo}" rendered="#{aggregate.validTo != null}">
                                <f:convertDateTime pattern="dd.MM.yyyy"/>
                            </h:outputText>
                            <h:outputText value="unbegrenzt" rendered="#{aggregate.validTo == null}"/>
                        </pf:column>
                        <pf:column headerText="Pflegesensitiver Bereich" style="width: 120px;">
                            <pf:outputLabel value="#{aggregate.sensitiveAreas}"/>
                        </pf:column>
                        <pf:column headerText="Fachabteilungsnr.">
                            <pf:outputLabel value="#{aggregate.fabs}"/>
                        </pf:column>
                        <pf:column headerText="Fachabteilungsname">
                            <pf:outputLabel value="#{aggregate.deptNames}"/>
                        </pf:column>di
                        <pf:column headerText="Stationsbezeichnung">
                            <pf:outputLabel value="#{aggregate.wardName}"/>
                        </pf:column>
                        <pf:column headerText="Standort nach § 21 KHEntgG">
                            <pf:outputLabel value="#{aggregate.locationCode21}"/>
                        </pf:column>
                        <pf:column headerText="Standortnummer nach § 293 Abs. 6 SGB V (77xxxx000)">
                            <pf:outputLabel value="#{aggregate.locationText}"/>
                        </pf:column>
                        <pf:column headerText="Bettenanzahl der Station">
                            <pf:outputLabel
                                    value="#{aggregate.differentBedCount ? 'unterschiedlich' : aggregate.beds }"/>
                        </pf:column>
                    </pf:dataTable>
                </div>


                <div class="card" style="width: 100%" id="correction"
                     jsf:rendered="#{structuralChangesEdit.isInekUser() and structuralChangesEdit.structuralChangesBaseInformation.statusId eq 10
                     or structuralChangesEdit.structuralChangesBaseInformation.statusId eq 3 and not empty structuralChangesEdit.conversations}">

                    <h1>Dialog mit dem InEK</h1>
                    <div class="ui-g-12">
                        <pf:dataTable value="#{structuralChangesEdit.conversations}" var="conversation"
                                      rendered="#{not empty structuralChangesEdit.conversations}"
                                      style="width: 100%">
                            <pf:column headerText="Benutzer" style="width: 8.33333333%; box-sizing: border-box;">
                                <pf:outputLabel value="#{conversation.inek ? 'InEK' : 'Krankenhaus'}"/>
                            </pf:column>
                            <pf:column headerText="Nachricht">
                                <pf:outputLabel value="#{conversation.message}"/>
                            </pf:column>
                        </pf:dataTable>
                    </div>
                    <br/>
                    <div class="ui-g-1" style="padding-left: 1em">
                        <h:outputLabel value="Bemerkung InEK"
                                       rendered="#{structuralChangesEdit.isInekUser() and structuralChangesEdit.structuralChangesBaseInformation.statusId eq 10}"/>
                        <h:outputLabel value="Antwort"
                                       rendered="#{structuralChangesEdit.structuralChangesBaseInformation.statusId eq 3 and not empty structuralChangesEdit.conversations}"/>
                    </div>
                    <div class="ui-g-11">
                        <h:inputTextarea rows="5" cols="100" id="correctionText"
                                         value="#{structuralChangesEdit.conversation.message}">
                            <f:ajax event="keyup" render=":change:correctionRequest"/>
                        </h:inputTextarea>
                    </div>

                </div>

                <div class="card" style="width: 100%" jsf:id="buttons">
                    <div class="ui-g-12">
                        <pf:commandButton value="Datensatz ändern"
                                          action="#{structuralChangesEdit.change()}"
                                          rendered="#{structuralChangesEdit.changeAllowed()}"
                                          immediate="true"
                                          style="margin-left: 10px;"
                                          update="@(.ui-message) @form"/>

                        <pf:commandButton value="Speichern ohne Senden"
                                          action="#{structuralChangesEdit.save()}"
                                          immediate="true"
                                          style="margin-left: 10px;"
                                          rendered="#{not structuralChangesEdit.readOnly}"
                                          update="@(.ui-message) @form"/>

                        <pf:commandButton value="Änderungsmeldung ans InEK senden"
                                          action="#{structuralChangesEdit.send()}"
                                          styleClass="green-button"
                                          style="margin-left: 10px;"
                                          icon="fa fa-arrow-right"
                                          iconPos="right"
                                          rendered="#{not structuralChangesEdit.readOnly}"
                                          update="@(.ui-message) @form"/>

                        <pf:commandButton value="Änderungen akzeptieren"
                                          rendered="#{structuralChangesEdit.isInekUser() and structuralChangesEdit.structuralChangesBaseInformation.statusId eq 10}"
                                          action="#{structuralChangesEdit.acceptChanges}"
                                          update="@(.ui-message) @form">
                            <pf:confirm header="Änderungen akzeptieren"
                                        message="Hierdurch werden alle Umbenenungen und strukturelle Änderungen übernommen. Fortfahren?"/>
                        </pf:commandButton>

                        <div jsf:id="correctionRequest" style="display: inline;">
                            <pf:commandButton value="Korrektur anfordern"
                                              rendered="#{structuralChangesEdit.isInekUser()
                                                and structuralChangesEdit.structuralChangesBaseInformation.statusId eq 10
                                                and not empty structuralChangesEdit.conversation.message}"
                                              action="#{structuralChangesEdit.requestCorrection}"
                                              update="@(.ui-message) @form"/>
                        </div>
                    </div>
                </div>
                <h:messages globalOnly="false" showSummary="true" styleClass="GLOBAL_MESSAGE"/>
            </div>
        </h:form>
    </ui:define>
</ui:composition>

