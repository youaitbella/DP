<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html [<!ENTITY nbsp "&#160;">]>

<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/WEB-INF/template.xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:jsf="http://xmlns.jcp.org/jsf"
                xmlns:pf="http://primefaces.org/ui"
                xmlns:inekIk="http://xmlns.jcp.org/jsf/composite/components/Other"
                xmlns:inekInput="http://xmlns.jcp.org/jsf/composite/components/Input"
                xmlns:inekIcon="http://xmlns.jcp.org/jsf/composite/components/Icons"
                xmlns:f="http://java.sun.com/jsf/core">

    <ui:define name="title">Umbenennung oder strukturelle Veränderungen (§ 5 Abs. 4 PpUGV)</ui:define>

    <ui:define name="content">

        <style>
            .ui-datatable-odd {
                background: #d9dfe6 !important;
            }

            .ui-datatable-even {
                background: #F2F5F9;
            }
        </style>

        <div style="margin-top: 10px;">
            <pf:commandButton value="HiddenButton"
                              style="display: none"
                              tabindex="0"
                              immediate="true"/>

            <pf:commandButton value="Zurück zur Übersicht"
                              icon="fa fa-arrow-left"
                              action="#{structuralChangesEdit.navigateToSummary()}"
                              immediate="true"/>
        </div>

        <pf:dialog widgetVar="wardSelection"
                   header="Bitte wählen Sie die betreffenden Stationen aus"
                   modal="true"
                   height="550px"
                   width="900px"
                   closable="true"
                   resizable="true">
            <h:form>
                <pf:dataTable value="#{structuralChangesEdit.wards}"
                              tableStyle="width: 100%"
                              emptyMessage="Keine Daten vorhanden"
                              var="ward"
                              selection="#{structuralChangesEdit.selectedWards}"
                              rowKey="#{ward.id}"
                              id="wardTableForSelection">
                    <pf:column selectionMode="multiple" style="width:16px; text-align:center"/>
                    <pf:column headerText="Pflegesensitiver Bereich" style="width: 100px;">
                        <pf:outputLabel value="#{ward.dept.sensitiveArea}"/>
                    </pf:column>
                    <pf:column headerText="Fachabteilungsnummer" style="width: 50px;">
                        <pf:outputLabel value="#{ward.fab}"/>
                    </pf:column>
                    <pf:column headerText="Fachabteilungsname" style="width: 150px;">
                        <pf:outputLabel value="#{ward.deptName}"/>
                    </pf:column>
                    <pf:column headerText="Stationsbezeichnung" style="width: 100px;">
                        <pf:outputLabel value="#{ward.wardName}"/>
                    </pf:column>
                    <pf:column headerText="Standort nach § 21 KHEntgG" style="width: 50px;">
                        <pf:outputLabel value="#{ward.locationCodeP21}"/>
                    </pf:column>
                    <pf:column headerText="Standort(nummer) nach § 293 Abs. 6 SGB V" style="width: 50px;">
                        <pf:outputLabel value="#{ward.locationText}"/>
                    </pf:column>
                    <pf:column headerText="Bettenanzahl der Station" style="width: 50px;">
                        <pf:outputLabel value="#{ward.bedCount}"/>
                    </pf:column>
                    <pf:column headerText="Gültig von" style="width: 100px;">
                        <pf:outputLabel value="#{ward.validFrom}">
                            <f:convertDateTime type="date" pattern="dd.MM.yyyy" timeZone="Europe/Berlin"/>
                        </pf:outputLabel>
                    </pf:column>
                    <pf:column headerText="Gültig bis" style="width: 100px;">
                        <pf:outputLabel value="#{ward.validToDisplayText}"/>
                    </pf:column>
                </pf:dataTable>

                <div id="buttons"
                     style="position: absolute !important; bottom: 10px !important; vertical-align: bottom !important;">
                    <pf:button value="Abbrechen"
                               styleClass="red-button"
                               tabindex="0"
                               style="position: relative;"
                               onclick="PF('wardSelection').hide(); return false;"/>

                    <pf:commandButton value="Auswahl übernehmen"
                                      action="#{structuralChangesEdit.createNewWardFromSelectedWards()}"
                                      style="margin-left: 10px;"
                                      oncomplete="PF('wardSelection').hide();"
                                      update="@(.ui-message) :change"/>
                </div>
            </h:form>
        </pf:dialog>

        <h:form id="change">

            <pf:importEnum type="org.inek.dataportal.care.enums.StructuralChangesType"
                           var="StructuralChangesType"
                           allSuffix="ALL_ENUM_VALUES"/>

            <div class="ui-g">
                <div class="card" style="width: 100%">
                    <div class="ui-g-12">
                        <inekIk:MultiIk_V2 label="#{msg.lblIkShort}"
                                           required="true"
                                           value="#{structuralChangesEdit.structuralChangesBaseInformation.ik}"
                                           ikList="#{structuralChangesEdit.iks}"
                                           readonly="#{not structuralChangesEdit.changeIkAllowed}"
                                           listener="#{structuralChangesEdit.ikChanged()}"
                                           isFixed="#{structuralChangesEdit.structuralChangesBaseInformation.id gt 0}"
                                           updateElement="@form"/>

                    </div>
                </div>
            </div>

            <div class="ui-g">
                <div class="card" style="width: 100%" jsf:rendered="#{not structuralChangesEdit.readOnly}">
                    <div class="ui-g-12">
                        <h1>Meldung von Umbenennungen oder strukturellen Veränderungen (§ 5 Abs. 4 PpUGV)</h1>

                        <div style="text-align: justify; border: 1px solid #ffa727; padding: 10px;">
                            <br/>
                            Änderungen im Sinne des § 5 Abs. 4 PpUGV (ersatzloser Wegfall einer mitzuteilenden Fachabteilung oder Station oder eines pflegesensitiven Bereichs; Benennung von Nachfolgeeinheiten von Stationen oder mitzuteilenden Fachabteilungen (Umbenennungen oder strukturelle Veränderungen)) geben Sie diesem Bereich an.
                            Nachfolgend werden in der Stationsübersicht alle Stationen angezeigt, welche Sie im Rahmen der Mitteilung gemäß § 5 Abs. 3 abschließend an das InEK übermittelt haben.
                            <br/>
                            <br/>
                            Sie können Änderungen im Sinne des § 5 Abs. 4 PpUGV wie folgt erfassen:
                            Änderungen, die bereits benannte Stationen betreffen, können Sie jeweils in der letzten Spalte unter dem Button „Aktionen“ vornehmen und entweder die „Stationsdaten ändern“, die „Station temporär abmelden“ oder die „Station löschen“. Unter der Überschrift „Weitere Aktionen“ können Sie zudem eine „neue Station hinzufügen“.
                            <br/>
                            <br/>
                            Bei einem Fehleintrag können Sie die hinzugefügte Zeile mit dem „Papierkorb“-Button wieder löschen.
                            <br/>
                            <br/>
                            Sie können Ihre Eingaben jederzeit speichern ohne diese direkt an das InEK zu übermitteln. So können Sie schrittweise arbeiten und erst nach Beendigung der Eingabe die Daten an das InEK übermitteln (Button „Meldung abschließend ans InEK senden“). Gespeicherte Meldungen finden Sie auf der Übersichtsseite unter dem Reiter „In Erfassung“. Sie können dort Ihre Änderung zu einem späteren Zeitpunkt erneut öffnen, weiter bearbeiten und abschließend an das InEK zu übermitteln (Button „Änderungsmeldung ans InEK senden“). Nach erfolgreicher Übermittlung erhalten Sie eine Bestätigung per E-Mail über den erfolgreichen Dateneingang im InEK. Es folgt ein technischer Freigabeprozess durch das InEK. Nach Abschluss der Prüfung werden Sie per E-Mail darüber informiert.
                            <br/>
                            <br/>
                            Bei Fragen konsultieren Sie bitte den Text der Rechtsverordnung sowie die auf unserer Internetseite bereitgestellte
                            <a href="https://www.g-drg.de/Pflegepersonaluntergrenzen_2020/Umsetzung_der_Verordnung_zur_Festlegung_von_Pflegepersonaluntergrenzen_in_pflegesensitiven_Bereichen_in_Krankenhaeusern_PpUGV_fuer_das_Jahr_2020/FAQ_PpUGV_2020"
                               target="_blank">FAQ-Liste</a>. Bei darüber hinaus gehenden Fragestellungen können Sie sich gerne an das InEK wenden (per E-Mail:
                            <a href="mailto:PPUGV-Umsetzung@inek-drg.de">PPUGV-Umsetzung@inek-drg.de</a> bzw. per Telefon: (02241) 93 82 500).
                        </div>

                        <br/>

                        <div style="text-align: justify; border: 1px solid #ffa727; padding: 10px;">
                            <pf:fieldset legend="Ausfüllhinweise"
                                         style="border: none"
                                         toggleable="true"
                                         toggleSpeed="500"
                                         collapsed="true">
                                <p>Möchten Sie eine Nachfolgeeinheit einer Station (aufgrund von Umbenennung oder struktureller Änderung) benennen, nutzen Sie bitte den Button „Stationsdaten ändern“ in der Zeile der entsprechenden Station. Dort geben Sie die Daten der neuen Station ein und benennen die Kategorie entsprechend der durchgeführten Änderung. Die ursprüngliche genannte Station wird damit zum Datum ihrer Gültigkeitsangabe ungültig / “abgemeldet“.</p>
                                <p>Möchten Sie Nachfolgeeinheiten einer Fachabteilung (aufgrund von Umbenennung oder struktureller Änderung) benennen, nutzen Sie bitte den Button „Stationsdaten ändern“ in der Zeile der entsprechenden Station(en) mit diesem FAB-Schlüssel. Dort geben Sie in den neuen Tabellenzeilen die neuen Fachabteilungsschlüssel ein und benennen die Kategorie entsprechend der durchgeführten Änderung. Sie können zudem das Datum angeben ab wann diese Änderung gültig ist.</p>
                                <p>Möchten Sie mehrere Stationen zu einer neuen oder bestehenden Station zusammenfassen (aufgrund von Umbenennung oder struktureller Änderung) nutzen Sie bitte bei den entsprechenden Stationen den Button „Stationsdaten ändern“. Bei diesen Stationen können Sie entweder die Daten einer bestehenden Station eintragen (identische Stationsnamen sind zu verwenden), zu welcher die Stationen zusammengefasst werden oder eine neue Station eintragen. Sie können zudem das Datum angeben ab wann diese Änderung gültig ist.</p>
                                <p>Möchten Sie den ersatzlosen Wegfall einer Fachabteilung anzeigen (z.B. da Ihr Krankenhaus diesen Bereich nicht weiter führt), nutzen Sie bitte den Button „Station löschen“ und benennen die Kategorie entsprechend der durchgeführten Änderung. Sie können zudem das Datum angeben ab wann diese Änderung gültig ist.</p>
                                <p>Möchten Sie den ersatzloser Wegfall einer Station (z.B. wegen Schließung der Station) mitteilen, benutzen Sie bitte den Button „Station löschen“, nennen das Datum der Schließung und benennen die Kategorie entsprechend der durchgeführten Änderung. Sie können zudem das Datum angeben ab wann diese Änderung gültig ist.</p>
                                <p>Soll eine Station einem pflegesensitiven Bereich nicht mehr zugeordnet werden, da dieser ersatzlos wegfällt nutzen Sie bitte den Button „Station löschen“ in der Zeile der entsprechenden Station an und benennen die Kategorie entsprechend der durchgeführten Änderung. Sie können zudem das Datum angeben ab wann diese Änderung gültig ist.</p>
                                <p>Soll eine Station temporär geschlossen werden, nutzen Sie bitte den Button „Station temporär abmelden“ und nennen das Datum der Schließung und der Wiedereröffnung und benennen die Kategorie entsprechend der durchgeführten Änderung. Sie können zudem das Datum angeben ab wann diese Änderung gültig ist.</p>
                                <p>Möchten Sie eine neue Station hinzufügen, die keinen „Vorgänger“ hat, nutzen Sie bitte den Button
                                    „neue Station hinzufügen“ und geben die entsprechenden Daten an.
                                </p>
                            </pf:fieldset>
                        </div>

                        <h1>Stationsübersicht</h1>

                        <pf:dataTable value="#{structuralChangesEdit.wards}"
                                      tableStyle="width: auto;"
                                      emptyMessage="Keine Daten vorhanden"
                                      var="ward"
                                      id="wardTable">
                            <pf:column headerText="Pflegesensitiver Bereich">
                                <pf:outputLabel value="#{ward.dept.sensitiveArea}"/>
                            </pf:column>
                            <pf:column headerText="Fachabteilungsnummer">
                                <pf:outputLabel value="#{ward.fab}"/>
                            </pf:column>
                            <pf:column headerText="Fachabteilungsname">
                                <pf:outputLabel value="#{ward.deptName}"/>
                            </pf:column>
                            <pf:column headerText="Stationsbezeichnung">
                                <pf:outputLabel value="#{ward.wardName}"/>
                            </pf:column>
                            <pf:column headerText="Standort nach § 21 KHEntgG">
                                <pf:outputLabel value="#{ward.locationCodeP21}"/>
                            </pf:column>
                            <pf:column headerText="Standort(nummer) nach § 293 Abs. 6 SGB V">
                                <pf:outputLabel value="#{ward.locationText}"/>
                            </pf:column>
                            <pf:column headerText="Bettenanzahl der Station">
                                <pf:outputLabel value="#{ward.bedCount}"/>
                            </pf:column>
                            <pf:column headerText="Gültig von">
                                <pf:outputLabel value="#{ward.validFrom}">
                                    <f:convertDateTime type="date" pattern="dd.MM.yyyy" timeZone="Europe/Berlin"/>
                                </pf:outputLabel>
                            </pf:column>
                            <pf:column headerText="Gültig bis">
                                <pf:outputLabel value="#{ward.validToDisplayText}"/>
                            </pf:column>
                            <pf:column>
                                <pf:splitButton value="Aktionen">
                                    <pf:menuitem value="Stationsdaten ändern"
                                                 update="@form"
                                                 immediate="true"
                                                 action="#{structuralChangesEdit.newChangeWard(ward)}"/>
                                    <pf:menuitem value="Station temporär abmelden"
                                                 update="@form"
                                                 immediate="true"
                                                 action="#{structuralChangesEdit.closeWardTemp(ward)}"/>
                                    <pf:menuitem value="Station löschen"
                                                 update="@form"
                                                 immediate="true"
                                                 action="#{structuralChangesEdit.closeWard(ward)}"/>
                                </pf:splitButton>
                            </pf:column>
                        </pf:dataTable>
                    </div>
                    <div class="ui-g-12">
                        <br/>

                        <h1>Weitere Aktionen</h1>

                        <br/>

                        <pf:commandButton value="neue Station hinzufügen"
                                          action="#{structuralChangesEdit.createNewWard()}"
                                          style="margin-left: 10px;"
                                          immediate="true"
                                          update="@(.ui-message) @form"/>

                        <pf:button value="bestehende Stationen zu einer neuen Station zusammenfassen"
                                   style="margin-left: 10px;"
                                   rendered="false"
                                   onclick="PF('wardSelection').show(); return false;"/>


                        <pf:commandButton value="bestehende Stationen zusammenfassen"
                                          action="#{structuralChangesEdit.createNewWard()}"
                                          style="margin-left: 10px;"
                                          rendered="false"
                                          immediate="true"
                                          update="@(.ui-message) @form"/>

                    </div>
                </div>
                <div class="card" style="width: 100%"
                     jsf:rendered="#{structuralChangesEdit.getChangesBaseInformationsByType(StructuralChangesType.NEW).size() gt 0}">
                    <!-- Neue Station -->
                    <div class="ui-g-12">
                        <h1>Informationen zur neuen Station</h1>
                        <pf:dataTable id="tableNewWard"
                                      value="#{structuralChangesEdit.getChangesBaseInformationsByType(StructuralChangesType.NEW)}"
                                      tableStyle="width: auto;"
                                      var="baseInfo">
                            <pf:column class="colIcon" style="width: 20px;">
                                <inekIcon:DeleteIcon
                                        deleteFunction="#{structuralChangesEdit.changesBaseInformation(baseInfo)}"
                                        rendered="#{not structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                        updateElement="@form"/>
                            </pf:column>
                            <pf:column headerText="Pflegesensitiver Bereich">
                                <pf:selectOneMenu value="#{baseInfo.wardsToChange.sensitiveAreaId}"
                                                  required="true"
                                                  disabled="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}">
                                    <f:selectItem itemLabel="#{msg.lblChooseEntryShort}" itemValue="#{0}"
                                                  noSelectionOption="true"/>
                                    <f:selectItems value="#{structuralChangesEdit.sensitiveAreas}"/>
                                    <pf:ajax update="fabNew"/>
                                </pf:selectOneMenu>
                            </pf:column>
                            <pf:column headerText="Fachabteilungsnummer">
                                <inekInput:InputTextValidator id="fabNew"
                                                              value="#{baseInfo.wardsToChange.fab}"
                                                              Style="width: 95%;"
                                                              require="#{structuralChangesEdit.fabRequired(baseInfo.wardsToChange)}"
                                                              readonly="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                                              validatorFunction="#{structuralChangesEdit.isFabValid}"
                                                              validatorMessage="Ungültige FAB"
                                                              maxlength="4"/>
                            </pf:column>
                            <pf:column headerText="Fachabteilungsname">
                                <inekInput:InputText value="#{baseInfo.wardsToChange.deptName}"
                                                     require="true"
                                                     readonly="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                                     Style="width: 95%;"
                                                     requiredMessage="Bitte geben Sie den Fachabteilungsnamen aus Ihrem Haus ein"/>
                            </pf:column>
                            <pf:column headerText="Stationsbezeichnung">
                                <inekInput:InputText value="#{baseInfo.wardsToChange.wardName}"
                                                     require="true"
                                                     readonly="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                                     Style="width: 95%;"
                                                     requiredMessage="Bitte geben Sie eine Stationsbezeichnung ein"/>
                            </pf:column>
                            <pf:column headerText="Standort nach § 21 KHEntgG" style="text-align: right">
                                <inekInput:InputNumberValidator value="#{baseInfo.wardsToChange.locationP21}"
                                                                readonly="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                                                validatorFunction="#{structuralChangesEdit.isP21LocationCodeValid}"
                                                                validatorMessage="Ungültiger Standort nach § 21 KHEntgG für diese IK"
                                                                Style="width: 95%;"/>

                            </pf:column>
                            <pf:column headerText="Standort(nummer) nach § 293 Abs. 6 SGB V" style="text-align: right">
                                <ui:remove>
                                    <inekInput:InputNumberValidator value="#{baseInfo.wardsToChange.locationVz}"
                                                                    Style="width: 95%;"
                                                                    readonly="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                                                    validatorFunction="#{structuralChangesEdit.isVZLocationCodeValid}"
                                                                    validatorMessage="Ungültiger Standort für dieses IK"
                                                                    thousendSeperator=""/>
                                </ui:remove>

                                <inekInput:InputTextValidator value="#{baseInfo.wardsToChange.locationVz}"
                                                              Style="width: 95%;"
                                                              maxlength="100"
                                                              readonly="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                                              validatorFunction="#{structuralChangesEdit.isVZLocationCodeValid}"
                                                              validatorMessage="In Ihrer Eingabe wurde eine Standortnummer erkannt. Sie ist jedoch für dieses IK ungültig."/>

                            </pf:column>
                            <pf:column headerText="Bettenanzahl der Station" style="text-align: right">
                                <inekInput:InputNumber value="#{baseInfo.wardsToChange.beds}"
                                                       Style="width: 95%;"
                                                       readonly="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                                       minValue="1"
                                                       maxValue="999"/>
                            </pf:column>
                            <pf:column headerText="Gültig ab">
                                <pf:calendar value="#{baseInfo.wardsToChange.validFrom}"
                                             required="true"
                                             requiredMessage="Bitte ein Datum angeben"
                                             locale="de"
                                             navigator="true"
                                             pattern="dd.MM.yyyy"
                                             mask="true"
                                             mindate="1.1.2018"
                                             disabled="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                             inputStyle="text-align: right;"/>
                            </pf:column>

                            <pf:column headerText="Anmerkung">
                                <pf:inputTextarea id="commentNew"
                                                  value="#{baseInfo.wardsToChange.comment}"
                                                  readonly="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                                  required="true"
                                                  requiredMessage="Bitte geben Sie eine Anmerkung an"
                                                  maxlength="500"
                                                  style="width: 95%"
                                                  rows="2">
                                    <pf:ajax update="commentNewMsg"/>
                                </pf:inputTextarea>

                                <pf:message id="commentNewMsg" for="commentNew"/>
                            </pf:column>F
                        </pf:dataTable>
                    </div>
                </div>

                <div class="card" style="width: 100%"
                     jsf:rendered="#{structuralChangesEdit.getChangesBaseInformationsByType(StructuralChangesType.CHANGE).size() gt 0}">
                    <!-- Stationsänderung -->
                    <div class="ui-g-12">
                        <h1>Stationsdaten ändern</h1>
                        <pf:dataTable id="tableChangeWard"
                                      value="#{structuralChangesEdit.getChangesBaseInformationsByType(StructuralChangesType.CHANGE)}"
                                      tableStyle="width: auto;"
                                      var="baseInfo">
                            <pf:column class="colIcon" style="width: 20px;">
                                <inekIcon:DeleteIcon
                                        deleteFunction="#{structuralChangesEdit.changesBaseInformation(baseInfo)}"
                                        rendered="#{not structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                        updateElement="@form"/>
                            </pf:column>
                            <pf:column headerText="Pflegesensitiver Bereich">
                                <pf:outputLabel value=" "/>
                                <pf:separator/>
                                <pf:outputLabel value="#{baseInfo.wardsToChange.deptWard.dept.sensitiveArea}"/>
                            </pf:column>
                            <pf:column headerText="Fachabteilungsnummer">
                                <pf:outputLabel value="#{baseInfo.wardsToChange.deptWard.fab}"/>
                                <pf:separator/>
                                <inekInput:InputTextValidator value="#{baseInfo.wardsToChange.fab}"
                                                              Style="width: 95%;"
                                                              require="#{structuralChangesEdit.fabRequired(baseInfo.wardsToChange)}"
                                                              readonly="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                                              validatorFunction="#{structuralChangesEdit.isFabValid}"
                                                              validatorMessage="Ungültige Fachabteilungsnummer"
                                                              maxlength="4"/>
                            </pf:column>
                            <pf:column headerText="Fachabteilungsname">
                                <pf:outputLabel value="#{baseInfo.wardsToChange.deptWard.deptName}"/>
                                <pf:separator/>
                                <inekInput:InputText value="#{baseInfo.wardsToChange.deptName}"
                                                     require="true"
                                                     readonly="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                                     Style="width: 95%;"
                                                     requiredMessage="Bitte geben Sie den Fachabteilungsnamen aus Ihrem Haus ein"/>
                            </pf:column>
                            <pf:column headerText="Stationsbezeichnung">
                                <pf:outputLabel value="#{baseInfo.wardsToChange.deptWard.wardName}"/>
                                <pf:separator/>
                                <inekInput:InputText value="#{baseInfo.wardsToChange.wardName}"
                                                     require="true"
                                                     readonly="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                                     Style="width: 95%;"
                                                     requiredMessage="Bitte geben Sie eine Stationsbezeichnung ein"/>
                            </pf:column>
                            <pf:column headerText="Standort nach § 21 KHEntgG" style="text-align: right">
                                <pf:outputLabel
                                        value="#{baseInfo.wardsToChange.deptWard.locationCodeP21}"/>
                                <pf:separator/>
                                <inekInput:InputNumberValidator value="#{baseInfo.wardsToChange.locationP21}"
                                                                readonly="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                                                validatorFunction="#{structuralChangesEdit.isP21LocationCodeValid}"
                                                                validatorMessage="Ungültiger Standort nach § 21 KHEntgG für diese IK"
                                                                Style="width: 95%;"/>
                            </pf:column>
                            <pf:column headerText="Standort(nummer) nach § 293 Abs. 6 SGB V">
                                <pf:outputLabel
                                        value="#{baseInfo.wardsToChange.deptWard.locationCodeVz}"/>
                                <pf:separator/>
                                <ui:remove>
                                    <inekInput:InputNumberValidator value="#{baseInfo.wardsToChange.locationVz}"
                                                                    Style="width: 95%;"
                                                                    readonly="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                                                    validatorFunction="#{structuralChangesEdit.isVZLocationCodeValid}"
                                                                    validatorMessage="Ungültiger Standort für dieses IK"
                                                                    thousendSeperator=""/>

                                </ui:remove>
                                <inekInput:InputTextValidator value="#{baseInfo.wardsToChange.locationVz}"
                                                              Style="width: 95%;"
                                                              maxlength="100"
                                                              readonly="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                                              validatorFunction="#{structuralChangesEdit.isVZLocationCodeValid}"
                                                              validatorMessage="In Ihrer Eingabe wurde eine Standortnummer erkannt. Sie ist jedoch für dieses IK ungültig."/>

                            </pf:column>
                            <pf:column headerText="Bettenanzahl der Station" style="text-align: right">
                                <pf:outputLabel value="#{baseInfo.wardsToChange.deptWard.bedCount}"/>
                                <pf:separator/>
                                <inekInput:InputNumber value="#{baseInfo.wardsToChange.beds}"
                                                       Style="width: 95%;"
                                                       readonly="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                                       minValue="1"
                                                       maxValue="999"/>
                            </pf:column>
                            <pf:column headerText="Änderung gültig ab">
                                <pf:outputLabel value=" "/>
                                <pf:separator/>
                                <pf:calendar value="#{baseInfo.wardsToChange.validFrom}"
                                             required="true"
                                             requiredMessage="Bitte ein Datum angeben"
                                             locale="de"
                                             navigator="true"
                                             pattern="dd.MM.yyyy"
                                             mask="true"
                                             mindate="1.1.2018"
                                             disabled="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                             inputStyle="text-align: right;"/>
                            </pf:column>
                            <pf:column headerText="Kategorie">
                                <pf:outputLabel value=" "/>
                                <pf:separator/>
                                <pf:selectOneMenu id="catNew"
                                                  value="#{baseInfo.structuralChangesDetailTypeId}"
                                                  required="true"
                                                  disabled="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}">
                                    <f:selectItem itemLabel="#{msg.lblChooseEntryShort}" itemValue="#{0}"
                                                  noSelectionOption="true"/>
                                    <f:selectItems value="#{structuralChangesEdit.changeReasons}"/>
                                </pf:selectOneMenu>
                                <pf:message for="catNew"/>
                            </pf:column>
                            <pf:column headerText="Anmerkung" style="width: 200px">
                                <pf:inputTextarea id="commentChange"
                                                  value="#{baseInfo.wardsToChange.comment}"
                                                  readonly="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                                  required="true"
                                                  requiredMessage="Bitte geben Sie eine Anmerkung an"
                                                  maxlength="500"
                                                  style="width: 95%"
                                                  rows="2">
                                    <pf:ajax update="commentChangeMsg"/>
                                </pf:inputTextarea>

                                <pf:message id="commentChangeMsg" for="commentChange"/>
                            </pf:column>
                        </pf:dataTable>
                    </div>
                </div>

                <!-- Stationsschließung -->
                <div class="card" style="width: 100%"
                     jsf:rendered="#{structuralChangesEdit.getChangesBaseInformationsByType(StructuralChangesType.CLOSE).size() gt 0}">
                    <div class="ui-g-12">
                        <h1>Station löschen</h1>
                        <pf:dataTable id="tableCloseWard"
                                      value="#{structuralChangesEdit.getChangesBaseInformationsByType(StructuralChangesType.CLOSE)}"
                                      tableStyle="width: auto;"
                                      var="baseInfo">
                            <pf:column class="colIcon" style="width: 20px;">
                                <inekIcon:DeleteIcon
                                        rendered="#{not structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                        deleteFunction="#{structuralChangesEdit.changesBaseInformation(baseInfo)}"
                                        updateElement="@form"/>
                            </pf:column>
                            <pf:column headerText="Pflegesensitiver Bereich">
                                <pf:outputLabel value="#{baseInfo.wardsToChange.deptWard.dept.sensitiveArea}"/>
                            </pf:column>
                            <pf:column headerText="Fachabteilungsnummer">
                                <pf:outputLabel value="#{baseInfo.wardsToChange.deptWard.fab}"/>
                            </pf:column>
                            <pf:column headerText="Fachabteilungsname">
                                <pf:outputLabel value="#{baseInfo.wardsToChange.deptWard.deptName}"/>
                            </pf:column>
                            <pf:column headerText="Stationsbezeichnung">
                                <pf:outputLabel value="#{baseInfo.wardsToChange.deptWard.wardName}"/>
                            </pf:column>
                            <pf:column headerText="Standort nach § 21 KHEntgG">
                                <pf:outputLabel
                                        value="#{baseInfo.wardsToChange.deptWard.locationCodeP21}"/>
                            </pf:column>
                            <pf:column headerText="Standort(nummer) nach § 293 Abs. 6 SGB V">
                                <pf:outputLabel
                                        value="#{baseInfo.wardsToChange.deptWard.locationText}"/>
                            </pf:column>
                            <pf:column headerText="Bettenanzahl der Station">
                                <pf:outputLabel value="#{baseInfo.wardsToChange.deptWard.bedCount}"/>
                            </pf:column>
                            <pf:column headerText="Änderung gültig ab">
                                <pf:calendar value="#{baseInfo.wardsToChange.validFrom}"
                                             required="true"
                                             requiredMessage="Bitte ein Datum angeben"
                                             locale="de"
                                             navigator="true"
                                             pattern="dd.MM.yyyy"
                                             mask="true"
                                             mindate="1.1.2018"
                                             disabled="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                             inputStyle="text-align: right;"/>
                            </pf:column>

                            <pf:column headerText="Kategorie">
                                <pf:selectOneMenu id="catDelete"
                                                  value="#{baseInfo.structuralChangesDetailTypeId}"
                                                  required="true"
                                                  disabled="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}">
                                    <f:selectItem itemLabel="#{msg.lblChooseEntryShort}" itemValue="#{0}"
                                                  noSelectionOption="true"/>
                                    <f:selectItems value="#{structuralChangesEdit.closeReasons}"/>
                                </pf:selectOneMenu>
                                <pf:message for="catDelete"/>
                            </pf:column>
                            <pf:column headerText="Anmerkung">
                                <pf:inputTextarea id="commentclose"
                                                  value="#{baseInfo.wardsToChange.comment}"
                                                  readonly="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                                  required="true"
                                                  requiredMessage="Bitte geben Sie eine Anmerkung an"
                                                  maxlength="500"
                                                  style="width: 95%"
                                                  rows="2">
                                    <pf:ajax update="commentcloseMsg"/>
                                </pf:inputTextarea>

                                <pf:message id="commentcloseMsg" for="commentclose"/>
                            </pf:column>
                        </pf:dataTable>
                    </div>
                </div>

                <!-- Station Temp schliesen -->
                <div class="card" style="width: 100%"
                     jsf:rendered="#{structuralChangesEdit.getChangesBaseInformationsByType(StructuralChangesType.CLOSE_TEMP).size() gt 0}">
                    <div class="ui-g-12">
                        <h1>Station temporär abmelden</h1>
                        <pf:dataTable id="tableCloseTempWard"
                                      value="#{structuralChangesEdit.getChangesBaseInformationsByType(StructuralChangesType.CLOSE_TEMP)}"
                                      tableStyle="width: auto;"
                                      var="baseInfo">
                            <pf:column class="colIcon" style="width: 20px;">
                                <inekIcon:DeleteIcon
                                        rendered="#{not structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                        deleteFunction="#{structuralChangesEdit.changesBaseInformation(baseInfo)}"
                                        updateElement="@form"/>
                            </pf:column>
                            <pf:column headerText="Pflegesensitiver Bereich">
                                <pf:outputLabel value="#{baseInfo.wardsToChange.deptWard.dept.sensitiveArea}"/>
                            </pf:column>
                            <pf:column headerText="Fachabteilungsnummer">
                                <pf:outputLabel value="#{baseInfo.wardsToChange.deptWard.fab}"/>
                            </pf:column>
                            <pf:column headerText="Fachabteilungsname">
                                <pf:outputLabel value="#{baseInfo.wardsToChange.deptWard.deptName}"/>
                            </pf:column>
                            <pf:column headerText="Stationsbezeichnung">
                                <pf:outputLabel value="#{baseInfo.wardsToChange.deptWard.wardName}"/>
                            </pf:column>
                            <pf:column headerText="Standort nach § 21 KHEntgG">
                                <pf:outputLabel
                                        value="#{baseInfo.wardsToChange.deptWard.locationCodeP21}"/>
                            </pf:column>
                            <pf:column headerText="Standort(nummer) nach § 293 Abs. 6 SGB V">
                                <pf:outputLabel
                                        value="#{baseInfo.wardsToChange.deptWard.locationText}"/>
                            </pf:column>
                            <pf:column headerText="Bettenanzahl der Station">
                                <pf:outputLabel value="#{baseInfo.wardsToChange.deptWard.bedCount}"/>
                            </pf:column>
                            <pf:column headerText="Änderung gültig ab">
                                <pf:calendar value="#{baseInfo.wardsToChange.validFrom}"
                                             required="true"
                                             requiredMessage="Bitte ein Datum angeben"
                                             locale="de"
                                             navigator="true"
                                             pattern="dd.MM.yyyy"
                                             mask="true"
                                             mindate="1.1.2018"
                                             disabled="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                             inputStyle="text-align: right;">
                                    <pf:ajax event="dateSelect" update="dateValidTo"/>
                                </pf:calendar>
                            </pf:column>

                            <pf:column headerText="Änderung gültig bis">
                                <pf:calendar id="dateValidTo"
                                             value="#{baseInfo.wardsToChange.validTo}"
                                             mindate="#{baseInfo.wardsToChange.validFrom}"
                                             required="true"
                                             requiredMessage="Bitte ein Datum angeben"
                                             locale="de"
                                             navigator="true"
                                             pattern="dd.MM.yyyy"
                                             mask="true"
                                             disabled="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                             inputStyle="text-align: right;"/>
                            </pf:column>

                            <pf:column headerText="Kategorie">
                                <pf:selectOneMenu id="catCloseTmp"
                                                  value="#{baseInfo.structuralChangesDetailTypeId}"
                                                  required="true"
                                                  disabled="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}">
                                    <f:selectItem itemLabel="#{msg.lblChooseEntryShort}" itemValue="#{0}"
                                                  noSelectionOption="true"/>
                                    <f:selectItems value="#{structuralChangesEdit.closeTmpReasons}"/>
                                </pf:selectOneMenu>
                                <pf:message for="catCloseTmp"/>
                            </pf:column>
                            <pf:column headerText="Anmerkung">
                                <pf:inputTextarea id="commentcloseTmp"
                                                  value="#{baseInfo.wardsToChange.comment}"
                                                  readonly="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                                  required="true"
                                                  requiredMessage="Bitte geben Sie eine Anmerkung an"
                                                  maxlength="500"
                                                  style="width: 95%"
                                                  rows="2">
                                    <pf:ajax update="commentcloseTmpMsg"/>
                                </pf:inputTextarea>

                                <pf:message id="commentcloseTmpMsg" for="commentcloseTmp"/>
                            </pf:column>
                        </pf:dataTable>
                    </div>
                </div>

                <!-- Zusammenlegung -->
                <div class="card" style="width: 100%"
                     jsf:rendered="#{structuralChangesEdit.getChangesBaseInformationsByType(StructuralChangesType.COMBINE_WITH_NEW).size() gt 0}">
                    <div class="ui-g-12">
                        <h1>bestehende Stationen zu einer neuen Station zusammenfassen</h1>

                        <pf:repeat
                                value="#{structuralChangesEdit.getChangesBaseInformationsByType(StructuralChangesType.COMBINE_WITH_NEW)}"
                                var="baseInfo">

                            <h2>Bestehende Stationen:</h2>

                            <br/>

                            <pf:dataTable value="#{baseInfo.structuralChangesWards}"
                                          emptyMessage="Keine Daten vorhanden"
                                          tableStyle="width: auto;"
                                          var="structuralChangesWard">
                                <pf:column headerText="Pflegesensitiver Bereich" style="width: 100px;">
                                    <pf:outputLabel value="#{structuralChangesWard.deptWard.dept.sensitiveArea}"/>
                                </pf:column>
                                <pf:column headerText="Fachabteilungsnummer" style="width: 50px;">
                                    <pf:outputLabel value="#{structuralChangesWard.deptWard.fab}"/>
                                </pf:column>
                                <pf:column headerText="Fachabteilungsname" style="width: 150px;">
                                    <pf:outputLabel value="#{structuralChangesWard.deptWard.deptName}"/>
                                </pf:column>
                                <pf:column headerText="Stationsbezeichnung" style="width: 100px;">
                                    <pf:outputLabel value="#{structuralChangesWard.deptWard.wardName}"/>
                                </pf:column>
                                <pf:column headerText="Standort nach § 21 KHEntgG" style="width: 50px;">
                                    <pf:outputLabel value="#{structuralChangesWard.deptWard.locationCodeP21}"/>
                                </pf:column>
                                <pf:column headerText="Standort(nummer) nach § 293 Abs. 6 SGB V" style="width: 50px;">
                                    <pf:outputLabel value="#{structuralChangesWard.deptWard.locationText}"/>
                                </pf:column>
                                <pf:column headerText="Bettenanzahl der Station" style="width: 50px;">
                                    <pf:outputLabel value="#{structuralChangesWard.deptWard.bedCount}"/>
                                </pf:column>
                                <pf:column headerText="Gültig von" style="width: 100px;">
                                    <pf:outputLabel value="#{structuralChangesWard.deptWard.validFrom}">
                                        <f:convertDateTime type="date" pattern="dd.MM.yyyy" timeZone="Europe/Berlin"/>
                                    </pf:outputLabel>
                                </pf:column>
                                <pf:column headerText="Gültig bis" style="width: 100px;">
                                    <pf:outputLabel value="#{structuralChangesWard.deptWard.validToDisplayText}"/>
                                </pf:column>
                            </pf:dataTable>

                            <h2>Neue Station:</h2>

                            <br/>

                            <pf:panelGrid>
                                <f:facet name="header">
                                    <pf:row>
                                        <pf:column> </pf:column>
                                        <pf:column>Pflegesensitiver Bereich</pf:column>
                                        <pf:column>Fachabteilungsnummer</pf:column>
                                        <pf:column>Fachabteilungsname</pf:column>
                                        <pf:column>Stationsbezeichnung</pf:column>
                                        <pf:column>Standort nach § 21 KHEntgG</pf:column>
                                        <pf:column>Standort(nummer) nach § 293 Abs. 6 SGB V</pf:column>
                                        <pf:column>Bettenanzahl der Station</pf:column>
                                        <pf:column>Gültig ab</pf:column>
                                        <pf:column>Anmerkung</pf:column>
                                    </pf:row>

                                </f:facet>

                                <pf:row>
                                    <pf:column class="colIcon" style="width: 20px;">
                                        <inekIcon:DeleteIcon
                                                rendered="#{not structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                                deleteFunction="#{structuralChangesEdit.changesBaseInformation(baseInfo)}"
                                                updateElement="@form"/>
                                    </pf:column>
                                    <pf:column>
                                        <pf:selectOneMenu value="#{baseInfo.wardsToChange.sensitiveAreaId}"
                                                          disabled="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}">
                                            <f:selectItems value="#{structuralChangesEdit.sensitiveAreas}"/>
                                        </pf:selectOneMenu>
                                    </pf:column>
                                    <pf:column headerText="Fachabteilungsnummer">
                                        <inekInput:InputTextValidator value="#{baseInfo.wardsToChange.fab}"
                                                                      Style="width: 95%;"
                                                                      require="true"
                                                                      readonly="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                                                      validatorFunction="#{structuralChangesEdit.isFabValid}"
                                                                      validatorMessage="Ungültige Fachabteilungsnummer"
                                                                      maxlength="4"/>
                                    </pf:column>
                                    <pf:column headerText="Fachabteilungsname">
                                        <inekInput:InputText value="#{baseInfo.wardsToChange.deptName}"
                                                             require="true"
                                                             readonly="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                                             Style="width: 95%;"
                                                             requiredMessage="Bitte geben Sie den Fachabteilungsnamen aus Ihrem Haus ein"/>
                                    </pf:column>
                                    <pf:column headerText="Stationsbezeichnung">
                                        <pf:inputText value="#{baseInfo.wardsToChange.wardName}"
                                                      readonly="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                                      require="true"/>
                                    </pf:column>
                                    <pf:column headerText="Standort nach § 21 KHEntgG" style="text-align: right">
                                        <inekInput:InputNumberValidator value="#{baseInfo.wardsToChange.locationP21}"
                                                                        readonly="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                                                        validatorFunction="#{structuralChangesEdit.isP21LocationCodeValid}"
                                                                        validatorMessage="Ungültiger Standort nach § 21 KHEntgG für diese IK"
                                                                        Style="width: 95%;"/>

                                    </pf:column>
                                    <pf:column headerText="Standort(nummer) nach § 293 Abs. 6 SGB V"
                                               style="text-align: right">
                                        <ui:remove>
                                            <inekInput:InputNumberValidator value="#{baseInfo.wardsToChange.locationVz}"
                                                                            Style="width: 95%;"
                                                                            readonly="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                                                            validatorFunction="#{structuralChangesEdit.isVZLocationCodeValid}"
                                                                            validatorMessage="Ungültiger Standort für dieses IK"
                                                                            thousendSeperator=""/>
                                        </ui:remove>

                                        <pf:inputText value="#{baseInfo.wardsToChange.locationVz}"
                                                      style="width: 95%;"
                                                      readonly="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"/>

                                    </pf:column>
                                    <pf:column headerText="Bettenanzahl der Station" style="text-align: right">
                                        <inekInput:InputNumber value="#{baseInfo.wardsToChange.beds}"
                                                               readonly="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                                               Style="width: 95%;"
                                                               minValue="1"
                                                               maxValue="999"/>
                                    </pf:column>
                                    <pf:column headerText="Gültig ab">
                                        <pf:calendar value="#{baseInfo.wardsToChange.validFrom}"
                                                     required="true"
                                                     requiredMessage="Bitte ein Datum angeben"
                                                     locale="de"
                                                     navigator="true"
                                                     pattern="dd.MM.yyyy"
                                                     mask="true"
                                                     mindate="1.1.2018"
                                                     disabled="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                                     inputStyle="text-align: right;"/>
                                    </pf:column>
                                    <pf:column headerText="Anmerkung">
                                        <inekInput:InputTextValidator value="#{baseInfo.wardsToChange.comment}"
                                                                      Style="width: 95%;"
                                                                      readonly="#{structuralChangesEdit.structuralChangesIsReadOnly(baseInfo)}"
                                                                      rendered="true"
                                                                      maxlength="500"
                                                                      validatorFunction="#{structuralChangesEdit.isCommentValid}"
                                                                      validatorMessage="Kommentar zu kurz(Mindestens 20 Zeichen)"/>
                                    </pf:column>
                                </pf:row>
                            </pf:panelGrid>

                        </pf:repeat>
                    </div>
                </div>
                <div class="card" style="width: 100%">
                    <div class="ui-g-12">
                        <pf:commandButton value="Datensatz ändern"
                                          action="#{structuralChangesEdit.change()}"
                                          rendered="#{structuralChangesEdit.changeAllowed()}"
                                          immediate="true"
                                          style="margin-left: 10px;"
                                          update="@(.ui-message) @form"/>

                        <pf:commandButton value="Speichern ohne Senden"
                                          action="#{structuralChangesEdit.save()}"
                                          style="margin-left: 10px;"
                                          rendered="#{not structuralChangesEdit.readOnly}"
                                          update="@(.ui-message) @form"/>

                        <pf:commandButton value="Änderungsmeldung ans InEK senden"
                                          action="#{structuralChangesEdit.send()}"
                                          styleClass="green-button"
                                          style="margin-left: 10px;"
                                          icon="fa fa-arrow-right"
                                          iconPos="right"
                                          rendered="#{not structuralChangesEdit.readOnly}"
                                          update="@(.ui-message) @form"/>
                    </div>
                </div>
            </div>


        </h:form>
    </ui:define>

</ui:composition>

