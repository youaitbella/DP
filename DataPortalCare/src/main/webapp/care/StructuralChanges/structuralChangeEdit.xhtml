<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html [<!ENTITY nbsp "&#160;">]>

<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/WEB-INF/template.xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:jsf="http://xmlns.jcp.org/jsf"
                xmlns:pf="http://primefaces.org/ui"
                xmlns:inekIcon="http://xmlns.jcp.org/jsf/composite/components/Icons"
                xmlns:f="http://java.sun.com/jsf/core"
>

    <ui:define name="content">
        <h:form id="change">
            <div class="ui-g">
                <div class="card">
                    <div class="ui-g-12">
                        <h1>Meldung struktureller Veränderungen</h1>

                        <pf:dataTable value="#{structuralChangesEdit.wards}"
                                      tableStyle="width: auto;"
                                      emptyMessage="Keine Daten vorhanden"
                                      var="ward"
                                      id="wardTable">
                            <pf:column headerText="Sensitiver Bereich">
                                <pf:outputLabel value="#{ward.dept.sensitiveArea}"/>
                            </pf:column>
                            <pf:column headerText="FAB">
                                <pf:outputLabel value="#{ward.fab}"/>
                            </pf:column>
                            <pf:column headerText="FAB-Name">
                                <pf:outputLabel value="#{ward.deptName}"/>
                            </pf:column>
                            <pf:column headerText="Station">
                                <pf:outputLabel value="#{ward.wardName}"/>
                            </pf:column>
                            <pf:column headerText="Standort P21">
                                <pf:outputLabel value="#{ward.locationCodeP21}"/>
                            </pf:column>
                            <pf:column headerText="Standort VZ">
                                <pf:outputLabel value="#{ward.locationCodeVz}"/>
                            </pf:column>
                            <pf:column headerText="Betten">
                                <pf:outputLabel value="#{ward.bedCount}"/>
                            </pf:column>
                            <pf:column headerText="Gültig von">
                                <pf:outputLabel value="#{ward.validFrom}">
                                    <f:convertDateTime type="date" pattern="dd.MM.yyyy" timeZone="Europe/Berlin"/>
                                </pf:outputLabel>
                            </pf:column>
                            <pf:column headerText="Gültig bis">
                                <pf:outputLabel value="#{ward.validTo}">
                                    <f:convertDateTime type="date" pattern="dd.MM.yyyy" timeZone="Europe/Berlin"/>
                                </pf:outputLabel>
                            </pf:column>
                            <pf:column>
                                <pf:commandButton value="Neue Gültigkeit hinzufügen"
                                                  icon="fa fa-plus"
                                                  onclick="PF('validityInfo').show();"/>
                                <pf:dialog header="Gültigkeit von" widgetVar="validityInfo" modal="true" height="100">
                                    <pf:inputText value="#{structuralChangesEdit.validityFrom}"/>

                                    <pf:commandButton value="Ok"
                                                      action="#{structuralChangesEdit.newValidity(ward)}"
                                                      update=":change:test" process="@this"
                                                      oncomplete="PF('validityInfo').hide()"/>
                                </pf:dialog>
                            </pf:column>
                        </pf:dataTable>

                        <div jsf:id="test">
                            <pf:dataTable value="#{structuralChangesEdit.wards}"
                                          tableStyle="width: auto;"
                                          emptyMessage="Keine Daten vorhanden"
                                          var="ward"
                                          id="wardChangeTable">
                                <pf:column>
                                    <pf:outputLabel value="#{ward.dept.sensitiveArea}"/>
                                </pf:column>
                                <pf:column>
                                    <pf:outputLabel value="#{ward.fab}"/>
                                </pf:column>
                                <pf:column>
                                    <pf:outputLabel value="#{ward.deptName}"/>
                                </pf:column>
                                <pf:column>
                                    <pf:outputLabel value="#{ward.wardName}"/>
                                </pf:column>
                                <pf:column>
                                    <pf:outputLabel value="#{ward.locationCodeP21}"/>
                                </pf:column>
                                <pf:column>
                                    <pf:outputLabel value="#{ward.locationCodeVz}"/>
                                </pf:column>
                                <pf:column>
                                    <pf:outputLabel value="#{ward.bedCount}"/>
                                </pf:column>
                                <pf:column>
                                    <pf:outputLabel value="#{ward.validFrom}">
                                        <f:convertDateTime type="date" pattern="dd.MM.yyyy" timeZone="Europe/Berlin"/>
                                    </pf:outputLabel>
                                </pf:column>
                                <pf:column>
                                    <pf:outputLabel value="#{ward.validTo}">
                                        <f:convertDateTime type="date" pattern="dd.MM.yyyy" timeZone="Europe/Berlin"/>
                                    </pf:outputLabel>
                                </pf:column>

                            </pf:dataTable>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="ui-g-12">
                        <h1>Stationsdaten ändern</h1>

                        <pf:dataTable value="#{structuralChangesEdit.changesBaseInformations}"
                                      tableStyle="width: auto;"
                                      var="baseInfo">
                            <pf:column class="colIcon" style="width: 20px;">
                                <inekIcon:DeleteIcon
                                        deleteFunction="#{structuralChangesEdit.changesBaseInformation(baseInfo)}"
                                        updateElement="@form"/>
                            </pf:column>
                            <pf:column headerText="Sensitiver Bereich">
                                <ui:remove>
                                    <pf:outputLabel value="#{ward.dept.sensitiveArea}"/>
                                </ui:remove>
                            </pf:column>
                            <pf:column headerText="FAB">
                                <pf:outputLabel value="#{baseInfo.wardsToChange.mapVersion.deptWard.fab}"/>
                                <pf:separator/>
                                <pf:inputText id="inputFabChange"
                                              value="#{baseInfo.wardsToChange.fab}">
                                    <pf:ajax event="blur" update="inputFabChange_m"/>
                                </pf:inputText>
                                <pf:message id="inputFabChange_m" for="inputFabChange"/>
                            </pf:column>
                            <pf:column headerText="FAB-Name">
                                <pf:outputLabel value="#{baseInfo.wardsToChange.mapVersion.deptWard.deptName}"/>
                                <pf:separator/>
                                <pf:inputText value="#{baseInfo.wardsToChange.deptName}"/>
                            </pf:column>
                            <pf:column headerText="Station">
                                <pf:outputLabel value="#{baseInfo.wardsToChange.mapVersion.deptWard.stationName}"/>
                                <pf:separator/>
                                <pf:inputText value="#{baseInfo.wardsToChange.wardName}"/>
                            </pf:column>
                            <pf:column headerText="Standort P21">
                                <pf:outputLabel
                                        value="#{baseInfo.wardsToChange.mapVersion.deptWard.locationCodeP21}"/>
                                <pf:separator/>
                                <pf:inputNumber value="#{baseInfo.wardsToChange.locationP21}"/>
                            </pf:column>
                            <pf:column headerText="Standort VZ">
                                <pf:outputLabel
                                        value="#{baseInfo.wardsToChange.mapVersion.deptWard.locationCodeVz}"/>
                                <pf:separator/>
                                <pf:inputNumber value="#{baseInfo.wardsToChange.locationVz}"/>
                            </pf:column>
                            <pf:column headerText="Betten">
                                <pf:outputLabel value="#{baseInfo.wardsToChange.mapVersion.deptWard.bedCount}"/>
                                <pf:separator/>
                                <pf:inputText value="#{baseInfo.wardsToChange.beds}"/>
                            </pf:column>
                            <pf:column headerText="Gültig von">
                                <pf:calendar value="#{baseInfo.wardsToChange.mapVersion.deptWard.validFrom}"
                                             disabled="true"
                                             pattern="dd.MM.yyyy"
                                             mask="true"
                                             inputStyle="text-align: right;"/>
                                <pf:separator/>
                                <pf:calendar value="#{baseInfo.wardsToChange.validFrom}"
                                             required="true"
                                             requiredMessage="Bitte ein Datum angeben"
                                             locale="de"
                                             navigator="true"
                                             pattern="dd.MM.yyyy"
                                             mask="true"
                                             inputStyle="text-align: right;"/>
                            </pf:column>
                            <pf:column headerText="Gültig bis">
                                <pf:calendar value="#{baseInfo.wardsToChange.mapVersion.deptWard.validTo}"
                                             disabled="true"
                                             pattern="dd.MM.yyyy"
                                             mask="true"
                                             inputStyle="text-align: right;"/>
                                <pf:separator/>
                                <pf:calendar value="#{baseInfo.wardsToChange.validTo}"
                                             required="true"
                                             requiredMessage="Bitte ein Datum angeben"
                                             locale="de"
                                             navigator="true"
                                             pattern="dd.MM.yyyy"
                                             mask="true"
                                             inputStyle="text-align: right;"/>
                            </pf:column>
                        </pf:dataTable>
                    </div>
                </div>
            </div>

            <pf:commandButton value="Änderungsmeldung ans InEK senden"
                              action="#{structuralChangesEdit.send()}"
                              styleClass="green-button"
                              style="margin-left: 10px;"
                              icon="fa fa-arrow-right"
                              iconPos="right"
                              update="@(.ui-message) @form"/>

        </h:form>
    </ui:define>

</ui:composition>

