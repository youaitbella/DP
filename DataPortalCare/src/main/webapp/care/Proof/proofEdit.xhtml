<?xml version='1.0' encoding='UTF-8' ?>

<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:f="http://xmlns.jcp.org/jsf/core"
                template="/WEB-INF/template.xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:inekIk="http://xmlns.jcp.org/jsf/composite/components/Other"
                xmlns:pf="http://primefaces.org/ui">


    <ui:define name="title">Nachweisvereinbarung</ui:define>

    <ui:define name="content">

        <h:form id="form">
            <div style="margin-top: 10px;">
                <pf:commandButton value="Zurück zur Übersicht"
                                  icon="fa fa-arrow-left"
                                  action="#{sessionController.navigate(sessionTools.pages.CareProofSummary)}"
                                  immediate="true" />

                <pf:button target="blank"
                           value="Hilfe?"
                           icon="fa fa-info"
                           href="https://www.g-drg.de/Umsetzung_der_Verordnung_zur_Festlegung_von_Pflegepersonaluntergrenzen_in_pflegesensitiven_Bereichen_in_Krankenhaeusern_PpUGV/FAQ" />
            </div>

            <div class="ui-g">
                <div class="card">
                    <div class="ui-g-12">
                        <pf:wizard flowListener="#{proofEdit.onFlowProcess}"
                                   backLabel="Zurück"
                                   nextLabel="Weiter"
                                   rendered="#{proofEdit.proofRegulationBaseInformation.id lt 0}">
                            <pf:tab id="ik" title="IK">
                                <pf:panel header="IK Auswahl">
                                    <inekIk:MultiIk_V2 label="#{msg.lblIkShort}"
                                                       value="#{proofEdit.proofRegulationBaseInformation.ik}"
                                                       ikList="#{proofEdit.validIks}"
                                                       listener="#{proofEdit.ikChanged()}"
                                                       updateElement="form" />
                                </pf:panel>
                            </pf:tab>
                            <pf:tab id="year" title="Jahr">
                                <pf:panel header="Auswahl des Jahres">
                                    <h:panelGrid columns="2" style="margin-bottom:10px" cellpadding="5">
                                        <pf:outputLabel for="selectYear" value="Jahr:" />

                                        <pf:selectOneMenu id="selectYear"
                                                          title="Jahr"
                                                          required="true"
                                                          requiredMessage="Bitte ein Jahr auswählen"
                                                          value="#{proofEdit.proofRegulationBaseInformation.year}">
                                            <f:selectItem
                                                    rendered="#{proofEdit.proofRegulationBaseInformation.year eq 0}"
                                                    itemLabel="#{msg.lblChooseEntryShort}" itemValue="#{0}"
                                                    noSelectionOption="true" />
                                            <f:selectItems value="#{proofEdit.validYears}" />
                                            <pf:ajax event="change" listener="#{proofEdit.validYearsChanged()}"
                                                     update="selectQuarter msgselectYear" />
                                        </pf:selectOneMenu>
                                    </h:panelGrid>
                                    <pf:message for="selectYear" id="msgselectYear" />
                                </pf:panel>
                            </pf:tab>
                            <pf:tab id="quarter" title="Quartal">
                                <pf:panel header="Quartal Auswahl">
                                    <h:panelGrid columns="2" style="margin-bottom:10px" cellpadding="5">
                                        <pf:outputLabel for="selectQuarter" value="Jahr:" />

                                        <pf:selectOneMenu id="selectQuarter"
                                                          title="Quartal"
                                                          required="true"
                                                          requiredMessage="Bitte ein Quartal auswählen"
                                                          value="#{proofEdit.proofRegulationBaseInformation.quarter}">
                                            <f:selectItem
                                                    rendered="#{proofEdit.proofRegulationBaseInformation.quarter eq 0}"
                                                    itemLabel="#{msg.lblChooseEntryShort}" itemValue="#{0}"
                                                    noSelectionOption="true" />
                                            <f:selectItems value="#{proofEdit.validQuarters}" />
                                        </pf:selectOneMenu>
                                    </h:panelGrid>
                                    <pf:message for="selectQuarter" id="msgselectQuarter" />

                                    <pf:commandButton value="Daten erfassen"
                                                      action="#{proofEdit.firstSave()}"
                                                      process="@this"
                                                      style="margin-left: 10px;"
                                                      update="@form" />
                                </pf:panel>
                            </pf:tab>
                        </pf:wizard>
                    </div>
                </div>
            </div>

            <div class="ui-g">
                <div class="card">
                    <div class="ui-g-12">
                        <ui:include src="proof.xhtml" />
                    </div>
                </div>
            </div>

            <div class="ui-g">
                <div class="card">
                    <div class="ui-g-12">
                        <pf:commandButton value="Datensatz ändern"
                                          action="#{proofEdit.change()}"
                                          rendered="#{proofEdit.changeAllowed()}"
                                          style="margin-left: 10px;"
                                          update="@(.ui-message) @form" />
                        <pf:commandButton value="Speichern ohne Senden"
                                          action="#{proofEdit.save()}"
                                          rendered="#{!proofEdit.isReadOnly}"
                                          style="margin-left: 10px;"
                                          update="@(.ui-message) @form" />

                        <pf:commandButton value="Meldung abschließend ans InEK senden"
                                          action="#{proofEdit.send()}"
                                          rendered="#{!proofEdit.isReadOnly and proofEdit.sendAllowed()}"
                                          styleClass="green-button"
                                          style="margin-left: 10px;"
                                          icon="fa fa-arrow-right"
                                          iconPos="right"
                                          update="@(.ui-message) @form" />
                    </div>
                </div>
            </div>
        </h:form>

    </ui:define>

</ui:composition>

