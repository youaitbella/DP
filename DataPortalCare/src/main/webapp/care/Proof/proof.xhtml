<?xml version='1.0' encoding='UTF-8' ?>

<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:inekInput="http://xmlns.jcp.org/jsf/composite/components/Input"
                xmlns:inekOutput="http://xmlns.jcp.org/jsf/composite/components/Output"
                xmlns:pf="http://primefaces.org/ui">

    <pf:dialog header="Für welche Station wollen Sie eine Ausnahme eintragen?"
               widgetVar="dlgStationSelection"
               modal="true"
               width="800px">
        <pf:repeat value="#{proofEdit.proofsForExceptionFact}" var="proof">

            <div class="ui-g">
                <div class="ui-g-10">
                    <pf:outputLabel value="#{proof.proofRegulationStation.sensitiveArea.name}" />
                    <pf:outputLabel value="#{proof.proofRegulationStation.fabNumber}" />
                    <pf:outputLabel value="#{proof.proofRegulationStation.fabName}" />
                    <pf:outputLabel value="#{proof.proofRegulationStation.stationName}" />
                    <pf:outputLabel value="#{proof.proofRegulationStation.locationCode}" />
                    <pf:outputLabel value="#{proof.month.name}" />
                    <pf:outputLabel value="#{proof.shift.name}" />
                </div>
                <div class="ui-g-2">
                    <pf:commandButton value="Auswählen"
                                      action="#{proofEdit.addNewException(proof)}"
                                      update="@form" />
                </div>
            </div>

        </pf:repeat>

    </pf:dialog>

    <pf:dataTable id="proofTable"
                  value="#{proofEdit.proofRegulationBaseInformation.proofs}"
                  rows="50"
                  paginator="true"
                  rowsPerPageTemplate="25,50,100,300"
                  tableStyle="table-layout: auto"
                  emptyMessage="Keine Einträge vorhanden"
                  var="proof"
                  sortBy="#{proof.proofRegulationStation.sensitiveArea.name}"
                  expandableRowGroups="true">

        <pf:column groupRow="true" headerText="pflegesensitiver Bereich">
            <pf:outputLabel value="#{proof.proofRegulationStation.sensitiveArea.name}" />
        </pf:column>
        <pf:column groupRow="true" headerText="FAB Schlüssel">
            <pf:outputLabel value="#{proof.proofRegulationStation.fabNumber}" />
        </pf:column>
        <pf:column groupRow="true" headerText="Fachabteilung">
            <pf:outputLabel value="#{proof.proofRegulationStation.fabName}" />
        </pf:column>
        <pf:column groupRow="true" headerText="Station">
            <pf:outputLabel value="#{proof.proofRegulationStation.stationName}" />
        </pf:column>
        <pf:column headerText="Standort">
            <pf:outputLabel value="#{proof.proofRegulationStation.locationCode}" />
        </pf:column>
        <pf:column groupRow="true" headerText="Monat">
            <pf:outputLabel value="#{proof.month.name}" />
        </pf:column>
        <pf:column headerText="Schicht">
            <pf:outputLabel value="#{proof.shift.name}" />
        </pf:column>
        <pf:column headerText="Anzahl Schichten (Summe)">
            <inekInput:InputNumber value="#{proof.countShift}"
                                   Style="width: 96%;"
                                   minValue="0"
                                   maxValue="31"
                                   require="true"
                                   requiredMessage="Bitte die Anzahl der Schichten angeben"
                                   readonly="#{proofEdit.isReadOnly}" />
        </pf:column>
        <pf:column headerText="durchschnittliche Pflegepersonalausstattung Pflegefachkräfte">
            <pf:inputNumber id="proofNurseId"
                            value="#{proof.nurse}"
                            style="width: 96%;"
                            decimalPlaces="2"
                            minValue="0"
                            require="true"
                            requiredMessage="Bitte geben Sie einen Wert ein"
                            inputStyle="width: 100%; text-align: right"
                            readonly="#{proofEdit.isReadOnly}">
                <pf:ajax event="change"
                         update="proofTable"
                         immediate="true" />
            </pf:inputNumber>
            <pf:message for="proofNurseId" />
        </pf:column>
        <pf:column headerText="durchschnittliche Pflegepersonalausstattung Pflegehilfskräfte">
            <pf:inputNumber id="proofHelpNurseId"
                            value="#{proof.helpNurse}"
                            style="width: 96%;"
                            decimalPlaces="2"
                            minValue="0"
                            require="true"
                            requiredMessage="Bitte geben Sie einen Wert ein"
                            inputStyle="width: 100%; text-align: right"
                            readonly="#{proofEdit.isReadOnly}">
                <pf:ajax event="change"
                         update="proofTable"
                         immediate="true" />
            </pf:inputNumber>
            <pf:message for="proofHelpNurseId" />
        </pf:column>
        <pf:column headerText="durchschnittliche Patientenbelegung">
            <pf:inputNumber id="proofPatientOccupancy"
                            value="#{proof.patientOccupancy}"
                            style="width: 96%;"
                            decimalPlaces="2"
                            minValue="0"
                            require="true"
                            requiredMessage="Bitte geben Sie einen Wert ein"
                            inputStyle="width: 100%; text-align: right"
                            readonly="#{proofEdit.isReadOnly}">
                <pf:ajax event="change"
                         update="proofTable"
                         immediate="true" />
            </pf:inputNumber>
            <pf:message for="proofPatientOccupancy" />
        </pf:column>
        <pf:column headerText="Anzahl Schichten, in denen die PPUG im Monat nicht eingehalten wurde">
            <inekInput:InputNumber value="#{proof.countShiftNotRespected}"
                                   Style="width: 96%;"
                                   minValue="0"
                                   require="true"
                                   requiredMessage="Bitte geben Sie einen Wert ein"
                                   readonly="#{proofEdit.isReadOnly}" />
        </pf:column>
        <pf:column headerText="rechnerische Anzahl Patienten je Pflegekraft">
            <inekOutput:OutputNumber id="patientPerNurseId"
                                     colorRed="#{proofEdit.calculatePatientPerNurse(proof) gt proof.ppug}"
                                     value="#{proofEdit.calculatePatientPerNurse(proof)}"
                                     decimalPlaces="2" />
        </pf:column>
        <pf:column headerText="Anzahl Pflegehilfskräfte anrechenbar für PPUG">
            <inekOutput:OutputNumber id="countHelpeNurseChargeableId"
                                     value="#{proofEdit.calculateCountHelpeNurseChargeable(proof)}"
                                     decimalPlaces="2" />
        </pf:column>
    </pf:dataTable>

    <h1>Ausnahmetatbestände</h1>

    <pf:dataTable id="exceptionsFactsTable"
                  value="#{proofEdit.exceptionsFacts}"
                  tableStyle="width: auto;"
                  emptyMessage="Keine Einträge vorhanden"
                  var="exceptionFact"
                  rendered="#{proofEdit.exceptionsFacts.size() gt 0}"
                  xmlns:inekIcon="http://xmlns.jcp.org/jsf/composite/components/Icons">

        <pf:column style="width: 20px;">
                <inekIcon:DeleteIcon
                        deleteFunction="#{proofEdit.deleteExceptionsFact(exceptionFact)}"
                        show="#{proofEdit.exceptionsFacts.size() gt 0}"
                        showConfirmDialog="true"
                        updateElement="exceptionsFactsTable" />
        </pf:column>

        <pf:column headerText="pflegesensitiver Bereich">
            <pf:outputLabel value="#{exceptionFact.proof.proofRegulationStation.sensitiveArea.name}" />
        </pf:column>
        <pf:column headerText="FAB Schlüssel">
            <pf:outputLabel value="#{exceptionFact.proof.proofRegulationStation.fabNumber}" />
        </pf:column>
        <pf:column headerText="Fachabteilung">
            <pf:outputLabel value="#{exceptionFact.proof.proofRegulationStation.fabName}" />
        </pf:column>
        <pf:column headerText="Station">
            <pf:outputLabel value="#{exceptionFact.proof.proofRegulationStation.stationName}" />
        </pf:column>
        <pf:column headerText="Standort">
            <pf:outputLabel value="#{exceptionFact.proof.proofRegulationStation.locationCode}" />
        </pf:column>
        <pf:column headerText="Monat">
            <pf:outputLabel value="#{exceptionFact.proof.month.name}" />
        </pf:column>
        <pf:column headerText="Schicht">
            <pf:outputLabel value="#{exceptionFact.proof.shift.name}" />
        </pf:column>
        <pf:column headerText="Ausnahmetatbestand">
            <pf:selectOneMenu id="selectExeption"
                              title="Ausnahmetatbestand"
                              required="true"
                              requiredMessage="Bitte einen Ausnahmetatbestand auswählen"
                              disabled="#{proofEdit.isReadOnly}"
                              value="#{exceptionFact.exceptionFactId}">
                <f:selectItem
                        itemLabel="#{msg.lblChooseEntryShort}" itemValue="#{0}"
                        noSelectionOption="true" />
                <f:selectItem itemValue="#{1}" itemLabel="Ausnahme Nr. 1" />
                <f:selectItem itemValue="#{2}" itemLabel="Ausnahme Nr. 2" />
                <pf:ajax event="change" />
            </pf:selectOneMenu>
        </pf:column>
        <pf:column headerText="Erläuterung">
            <pf:inputTextarea value="#{exceptionFact.statement}"
                              rows="2"
                              style="min-width: 300px;"
                              readonly="#{proofEdit.isReadOnly}" />
        </pf:column>
    </pf:dataTable>

    <pf:commandButton value="Neuen Ausnahmetatbestand hinzufügen"
                      onclick="PF('dlgStationSelection').show();"
                      immediate="false"
                      rendered="#{!proofEdit.isReadOnly}"
                      style="margin-top: 10px;"
                      icon="fa fa-plus"
                      update="exceptionsFactsTable" />

</ui:composition>

