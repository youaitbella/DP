<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html [<!ENTITY nbsp "&#160;">]>

<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:pf="http://primefaces.org/ui"
                xmlns:inekIk="http://xmlns.jcp.org/jsf/composite/components/Other"
                xmlns:inekInput="http://xmlns.jcp.org/jsf/composite/components/Input"
                xmlns:inekIcon="http://xmlns.jcp.org/jsf/composite/components/Icons"
                xmlns:jsf="http://xmlns.jcp.org/jsf">


    <pf:dialog header="Fachabteilungsauswahl"
               widgetVar="dlgFabSelection"
               modal="true"
               width="800px">
        <h:outputText value="Für welche Fachabteilung wollen Sie eine Änderung eintragen?" />

        <br />

        <pf:repeat value="#{deptEdit.deptBaseInformation.depts}" var="dept">

            <div class="ui-g">
                <div class="ui-g-10">
                    <pf:outputLabel rendered="#{dept.deptArea ne 3}" value="#{dept.deptNumber} - #{dept.deptName}" />
                    <pf:outputLabel rendered="#{dept.deptArea eq 3}" value="#{dept.sensitiveArea}" />
                </div>
                <div class="ui-g-2">
                    <pf:commandButton value="Auswählen"
                                      action="#{deptEdit.addNewDeptAfterTargetYear(dept)}"
                                      update="@form" />
                </div>
            </div>

        </pf:repeat>

    </pf:dialog>

    <style>

        /* InfoBox */

        .inekInfoBox {
            width: 100%;
            text-align: center;
            margin-top: 5px;
            margin-bottom: 5px;
            padding-top: 5px;
            padding-bottom: 5px;
            background-color: #267747;
            position: relative;
            color: white;
            font-size: 1.2em;
        }

        .inekInfoBox:before {
            content: "\f05a";
            font-family: FontAwesome;
        }

    </style>

    <div class="ui-g">
        <div class="card">
            <div class="ui-g-12">
                <inekIk:MultiIk_V2 label="#{msg.lblIkShort}"
                                   required="true"
                                   value="#{deptEdit.deptBaseInformation.ik}"
                                   ikList="#{deptEdit.validIks}"
                                   readonly="#{deptEdit.isReadOnly}"
                                   listener="#{deptEdit.ikChanged()}"
                                   isFixed="#{deptEdit.deptBaseInformation.id gt 0}"
                                   updateElement="form" />

            </div>

            <div class="ui-g-12">
                <h1>Umsetzung der Verordnung zur Festlegung von Pflegepersonaluntergrenzen in pflegesensitiven Bereichen in Krankenhäusern (PpUGV)</h1>
                <div style="text-align: justify; border: 1px solid #ffa727; padding: 10px;">
                    <br />
                    Die nach § 5 PpUGV geforderten Angaben Ihres Krankenhauses können Sie in diesem Bereich des InEK-Datenportals eintragen und an das InEK übermitteln. Zur Vereinfachung der Dateneingabe haben wir Ihnen die Eingabefelder bereits mit den in unserem Schreiben übermittelten, identifizierten pflegesensitiven Bereiche Ihres Krankenhauses vor befüllt. Lediglich die Informationen nach § 5 Abs. 3 PpUGV, die aus den §-21-Datensätzen nicht abgeleitet werden können, sind von Ihnen zu ergänzen. Sie können Ihre Eingaben jederzeit speichern ohne diese direkt an das InEK zu übermitteln. Über die Speicherung der Daten erhalten Sie eine Informationsmail. So können Sie schrittweise arbeiten und erst nach Beendigung der Eingabe die Daten an das InEK übermitteln (Button „Meldung abschließend ans InEK senden“). Nach erfolgreicher Übermittlung erhalten Sie eine Bestätigungsmail über den erfolgreichen Dateneingang im InEK.
                    <br />
                    <br />
                    Nach erfolgreicher Übermittlung an das InEK können Sie die übermittelten Daten in eine Excel-Tabelle exportieren und an die örtlichen Vertragsparteien nach § 11 KHEntgG weiterleiten (§ 5 Abs. 3 PpUGV). Eine erneute Erfassung der Daten zur Weiterleitung an die örtlichen Vertragsparteien ist also nicht erforderlich.
                    <br />
                    <br />
                    Bitte geben Sie die Namen der Fachabteilungen und Stationen möglichst nachvollziehbar ein. Verwenden Sie neben ggf. intern verwendeten Kurzbezeichnung („Station G1“) auch Klartexte zur besseren Nachvollziehbarkeit („Station G1 – Innere Medizin, Schwerpunkt Geriatrie“).
                    <br />
                    <br />
                    Bitte geben Sie in der Spalte „Fachabteilung“ den in Ihrem Krankenhaus verwendeten Namen der Fachabteilung an. Nach § 5 Abs. 3 PpUGV sind Angaben für sämtliche zu diesen Fachabteilungen gehörenden Stationen einzutragen. Wenn Ihr Krankenhaus über mehrere Standorte verfügt, sind die Angaben Standortbezogen vorzunehmen. Zu jedem Eintrag ist zunächst nur eine Datenzeile auf Stationsebene eingeblendet. Mit dem +-Button können Sie die Anzahl der einzugebenden Zeilen bedarfsweise erhöhen.
                    <br />
                    <br />
                    Bei einem Fehleintrag können Sie die Zeile mit dem „Papierkorb“-Button wieder löschen.
                    <br />
                    <br />
                    Bei Fragen konsultieren Sie bitte den Text der Rechtsverordnung sowie die auf unserer Internetseite bereitgestellte
                    <a href="https://www.g-drg.de/Umsetzung_der_Verordnung_zur_Festlegung_von_Pflegepersonaluntergrenzen_in_pflegesensitiven_Bereichen_in_Krankenhaeusern_PpUGV/FAQ" target="_blank">FAQ-Liste</a>. Bei darüber hinaus gehenden Fragestellungen können Sie sich gerne an das InEK wenden (per E-Mail:
                    <a href="mailto:PPUGV-Umsetzung@inek-drg.de">PPUGV-Umsetzung@inek-drg.de</a> bzw. per Telefon: (02241) 93 82 500).
                </div>

                <div style="text-align: justify; border: 1px solid #ffa727; padding: 10px;">
                    <br />
                    <b>Ausfüllhinweise:</b>
                    <p>Alle Angaben beziehen sich auf die Situation in Ihrem Krankenhaus im Datenjahr 2017. Bei Änderungen im Sinne des § 5 Abs. 4 PpUGV (ersatzloser Wegfall, Umbenennung, strukturelle Veränderungen) geben Sie diese bitte im entsprechenden Bereich am unteren Ende des Datenportals an.</p>
                    <p>Wenn in Ihrem Krankenhaus die Fachabteilung einen Namen verwendet, der von der Namensgebung im Schlüsselverzeichnis zur Datenübermittlung nach § 301 SGB V abweicht, tragen Sie diesen Namen bitte in der Spalte "Fachabteilungsnamen" ein.</p>
                    <p>Bitte geben Sie die Namen aller Stationen an, die dieser Fachabteilung zugeordnet sind. Bitte verwenden Sie unbedingt einen neben einer von Ihnen verwendeten Kurzbezeichnung auch einen Klarnamen. Verfügt Ihr Krankenhaus über mehrere Standorte, sind die Angaben standortdifferenziert vorzunehmen.</p>
                </div>

            </div>

            <div style="margin-top: 20px;" class="ui-g-12" jsf:rendered="#{deptEdit.getDeptsByArea(1).size() gt 0}">
                <h1>Angaben zu § 3 Abs. 3 Satz 2 Nr. 1 PpUGV (ausgewiesene Fachabteilung)</h1>
                <pf:repeat value="#{deptEdit.getDeptsByArea(1)}" var="dept">
                    <h3>Stationsangaben für pflegesensitiver Bereich #{dept.sensitiveArea}: Fachabteilung #{dept.deptNumber} #{dept.deptName}</h3>
                    <div class="inekInfoBox" jsf:rendered="#{!dept.required}">
                        Keine Angabe erforderlich
                    </div>
                    <pf:dataTable id="depTable"
                                  value="#{dept.deptStations}"
                                  emptyMessage="Keine Einträge vorhanden"
                                  var="station">
                        <pf:column class="colIcon" style="width: 20px;" rendered="#{!deptEdit.isReadOnly}">
                            <inekIcon:DeleteIcon deleteFunction="#{deptEdit.deleteStationFromDept(dept, station)}"
                                                 updateElement="form" />
                        </pf:column>
                        <pf:column headerText="Fachabteilungsname">
                            <inekInput:InputText value="#{station.deptName}"
                                                 require="true"
                                                 Style="width: 100%;"
                                                 requiredMessage="Bitte geben Sie den Fachabteilungsnamen aus Ihrem Haus ein"
                                                 readonly="#{deptEdit.isReadOnly}" />
                        </pf:column>
                        <pf:column headerText="Stationsbezeichnung">
                            <inekInput:InputText value="#{station.stationName}"
                                                 require="true"
                                                 Style="width: 100%;"
                                                 requiredMessage="Bitte geben Sie einen aussagekräftigen Stationsnamen an"
                                                 readonly="#{deptEdit.isReadOnly}" />
                        </pf:column>
                        <pf:column headerText="Standort" style="width: 100px;">
                            <inekInput:InputText value="#{station.locationCode}"
                                                 Style="width: 100%;"
                                                 readonly="#{deptEdit.isReadOnly}" />
                        </pf:column>
                    </pf:dataTable>

                    <pf:commandButton value="Station hinzufügen"
                                      actionListener="#{deptEdit.addNewStation(dept)}"
                                      process="@this"
                                      immediate="false"
                                      rendered="#{!deptEdit.isReadOnly}"
                                      style="margin-top: 10px;"
                                      icon="fa fa-plus"
                                      update="depTable" />

                </pf:repeat>

            </div>

            <br />

            <div style="margin-top: 20px;" class="ui-g-12" jsf:rendered="#{deptEdit.getDeptsByArea(2).size() gt 0}">

                <h1>Angaben zu § 3 Abs. 2 3 Satz Nr. 2 PpUGV (Indikatoren - DRGs)</h1>

                <pf:repeat value="#{deptEdit.getDeptsByArea(2)}" var="dept">
                    <h3>Stationsangaben für pflegesensitiver Bereich #{dept.sensitiveArea}: Fachabteilung #{dept.deptNumber} #{dept.deptName}</h3>
                    <div class="inekInfoBox" jsf:rendered="#{!dept.required}">
                        Keine Angabe erforderlich
                    </div>
                    <pf:dataTable id="depTable"
                                  value="#{dept.deptStations}"
                                  emptyMessage="Keine Einträge vorhanden"
                                  var="station">
                        <pf:column style="width: 20px;" rendered="#{!deptEdit.isReadOnly}">
                            <inekIcon:DeleteIcon deleteFunction="#{deptEdit.deleteStationFromDept(dept, station)}"
                                                 updateElement="form" />
                        </pf:column>
                        <pf:column headerText="Fachabteilungsname">
                            <inekInput:InputText value="#{station.deptName}"
                                                 require="true"
                                                 Style="width: 100%;"
                                                 requiredMessage="Bitte geben Sie den Fachabteilungsnamen aus Ihrem Haus ein"
                                                 readonly="#{deptEdit.isReadOnly}" />
                        </pf:column>
                        <pf:column headerText="Stationsbezeichnung">
                            <inekInput:InputText value="#{station.stationName}"
                                                 Style="width: 100%;"
                                                 require="true"
                                                 requiredMessage="Bitte geben Sie einen aussagekräftigen Stationsnamen an"
                                                 readonly="#{deptEdit.isReadOnly}"
                                                 updateComponents="form" />
                        </pf:column>
                        <pf:column headerText="Standort" style="width: 100px;">
                            <inekInput:InputText value="#{station.locationCode}"
                                                 Style="width: 100%;"
                                                 readonly="#{deptEdit.isReadOnly}" />
                        </pf:column>
                    </pf:dataTable>

                    <pf:commandButton value="Station hinzufügen"
                                      actionListener="#{deptEdit.addNewStation(dept)}"
                                      process="@this"
                                      immediate="false"
                                      rendered="#{!deptEdit.isReadOnly}"
                                      style="margin-top: 10px;"
                                      icon="fa fa-plus"
                                      update="depTable" />
                </pf:repeat>

            </div>

            <br />

            <div style="margin-top: 20px;" class="ui-g-12" jsf:rendered="#{deptEdit.getDeptsByArea(3).size() gt 0}">

                <h1>Angaben zu § 3 Abs. 4 PpUGV (OPS-Liste Intensivmedizin)</h1>

                <div style="text-align: justify; border: 1px solid #ffa727; padding: 10px;">
                    Für den pflegesensitiven Bereich Intensivmedizin sind Angaben für alle Stationen, auf denen Betten als intensivmedizinische Behandlungseinheiten aufgestellt worden sind, einzutragen. Dies gilt unabhängig davon, ob für das einzelne (individuelle) Intensivbett die Voraussetzungen für die Kodierung der intensivmedizinischen OPS-Kodes (8-980.* und 8-98f.*) erfüllt sind.
                </div>

                <pf:repeat value="#{deptEdit.getDeptsByArea(3)}" var="dept">
                    <h3>Stationsangaben für pflegeintensiven Bereich #{dept.sensitiveArea}</h3>
                    <div class="inekInfoBox" jsf:rendered="#{!dept.required}">
                        Keine Angabe erforderlich
                    </div>
                    <pf:dataTable id="depTable"
                                  value="#{dept.deptStations}"
                                  emptyMessage="Keine Einträge vorhanden"
                                  var="station">
                        <pf:column class="colIcon" style="width: 20px;" rendered="#{!deptEdit.isReadOnly}">
                            <inekIcon:DeleteIcon deleteFunction="#{deptEdit.deleteStationFromDept(dept, station)}"
                                                 updateElement="form" />
                        </pf:column>
                        <pf:column headerText="Fachabteilungsnr." style="width: 120px;">
                            <inekInput:InputText value="#{station.deptNumber}"
                                                 Style="width: 100%;"
                                                 maxlength="4"
                                                 readonly="#{deptEdit.isReadOnly}" />
                        </pf:column>
                        <pf:column headerText="Fachabteilungsname">
                            <inekInput:InputText value="#{station.deptName}"
                                                 require="true"
                                                 Style="width: 100%;"
                                                 requiredMessage="Bitte geben Sie den Fachabteilungsnamen aus Ihrem Haus ein"
                                                 readonly="#{deptEdit.isReadOnly}" />
                        </pf:column>
                        <pf:column headerText="Stationsbezeichnung">
                            <inekInput:InputText value="#{station.stationName}"
                                                 Style="width: 100%;"
                                                 require="true"
                                                 requiredMessage="Bitte geben Sie einen aussagekräftigen Stationsnamen an"
                                                 readonly="#{deptEdit.isReadOnly}"
                                                 updateComponents="form" />
                        </pf:column>
                        <pf:column headerText="Standort" style="width: 100px;">
                            <inekInput:InputText value="#{station.locationCode}"
                                                 Style="width: 100%;"
                                                 readonly="#{deptEdit.isReadOnly}" />
                        </pf:column>
                    </pf:dataTable>

                    <pf:commandButton value="Station hinzufügen"
                                      actionListener="#{deptEdit.addNewStation(dept)}"
                                      process="@this"
                                      immediate="false"
                                      rendered="#{!deptEdit.isReadOnly}"
                                      style="margin-top: 10px;"
                                      icon="fa fa-plus"
                                      update="depTable" />
                </pf:repeat>
            </div>

            <br />

            <div style="margin-top: 20px;" class="ui-g-12" jsf:rendered="#{deptEdit.deptBaseInformation.ik > 0}">

                <h1>Umbenennung oder strukturelle Veränderungen (§ 5 Abs. 4 PpUGV)</h1>

                <pf:dataTable id="depTableAfterTargetYear"
                              value="#{deptEdit.stationsAfterTargetYear}"
                              emptyMessage="Noch keine Einträge vorhanden"
                              var="deptAfterTargetYear">

                    <pf:columnGroup type="header">
                        <pf:row>
                            <pf:column style="width: 20px;" headerText="" />
                            <pf:column colspan="4" headerText="2017" style="border-right-width:5px;" />
                            <pf:column colspan="6" headerText="Nach 2017" />
                        </pf:row>
                        <pf:row>
                            <pf:column style="width: 20px;" headerText="" />
                            <pf:column headerText="Fachabteilung" />
                            <pf:column headerText="Fachabteilung gem. KH" />
                            <pf:column headerText="Station" />
                            <pf:column headerText="Standort" style="border-right-width:5px;" />
                            <pf:column headerText="PS Bereich" />
                            <pf:column headerText="FAB - Nummer" />
                            <pf:column headerText="FAB Name" />
                            <pf:column headerText="Station" />
                            <pf:column headerText="Standort" />
                            <pf:column headerText="Anmerkung" />
                        </pf:row>

                    </pf:columnGroup>
                    <pf:column class="colIcon" style="width: 20px;">
                        <inekIcon:DeleteIcon deleteFunction="#{deptEdit.deleteDeptAfterTargetYear(deptAfterTargetYear)}"
                                             show="#{!deptEdit.isReadOnly}"
                                             updateElement="form" />
                    </pf:column>
                    <pf:column headerText="Fachabteilung">
                        <pf:outputLabel
                                value="#{deptAfterTargetYear.dept.deptNumber} - #{deptAfterTargetYear.dept.deptName}" />
                    </pf:column>
                    <pf:column headerText="Fachabteilung gem. KH">
                        <inekInput:InputText value="#{deptAfterTargetYear.deptNameHospital}"
                                             require="true"
                                             Style="width: 100%;"
                                             requiredMessage="Bitte geben Sie den Fachabteilungsnamen an"
                                             readonly="#{deptEdit.isReadOnly}" />
                    </pf:column>
                    <pf:column headerText="Station">
                        <inekInput:InputText value="#{deptAfterTargetYear.stationNameTargetYear}"
                                             require="true"
                                             Style="width: 100%;"
                                             requiredMessage="Bitte geben Sie die Station an"
                                             readonly="#{deptEdit.isReadOnly}" />
                    </pf:column>
                    <pf:column headerText="Standort" style="border-right-width:5px;">
                        <inekInput:InputText value="#{deptAfterTargetYear.locationCodeTargetYear}"
                                             Style="width: 100%;"
                                             readonly="#{deptEdit.isReadOnly}" />
                    </pf:column>
                    <pf:column headerText="PS Bereich">
                        <inekInput:InputText value="#{deptAfterTargetYear.sensitiveArea}"
                                             Style="width: 100%;"
                                             readonly="#{deptEdit.isReadOnly}" />
                    </pf:column>
                    <pf:column headerText="FAB - Nummer">
                        <inekInput:InputText value="#{deptAfterTargetYear.deptNumber}"
                                             maxlength="4"
                                             Style="width: 100%;"
                                             readonly="#{deptEdit.isReadOnly}" />
                    </pf:column>
                    <pf:column headerText="FAB Name">
                        <inekInput:InputText value="#{deptAfterTargetYear.deptName}"
                                             Style="width: 100%;"
                                             readonly="#{deptEdit.isReadOnly}" />
                    </pf:column>
                    <pf:column headerText="Station">
                        <inekInput:InputText value="#{deptAfterTargetYear.stationName}"
                                             Style="width: 100%;"
                                             readonly="#{deptEdit.isReadOnly}" />
                    </pf:column>
                    <pf:column headerText="Standort">
                        <inekInput:InputText value="#{deptAfterTargetYear.locationCode}"
                                             Style="width: 100%;"
                                             readonly="#{deptEdit.isReadOnly}" />
                    </pf:column>
                    <pf:column headerText="Anmerkung">
                        <pf:inputTextarea value="#{deptAfterTargetYear.comment}"
                                          rows="1"
                                          style="width: 100%;"
                                          readonly="#{deptEdit.isReadOnly}" />
                    </pf:column>
                </pf:dataTable>

                <pf:commandButton value="Neuen Eintrag"
                                  onclick="PF('dlgFabSelection').show();"
                                  immediate="false"
                                  rendered="#{!deptEdit.isReadOnly}"
                                  style="margin-top: 10px;"
                                  icon="fa fa-plus"
                                  update="depTableAfterTargetYear" />
            </div>
        </div>
    </div>

</ui:composition>

