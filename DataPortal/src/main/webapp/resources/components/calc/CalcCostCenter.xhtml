<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html [<!ENTITY nbsp "&#160;">]>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:cc="http://xmlns.jcp.org/jsf/composite"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:cb="http://inek.org/dataportal/clientbehaviour"
      xmlns:inek="http://xmlns.jcp.org/jsf/composite/components"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

    <!-- INTERFACE -->
    <cc:interface>
        <cc:attribute name="costCenterId"/>
    </cc:interface>

    <!-- IMPLEMENTATION -->
    <cc:implementation>
        <h:dataTable value="#{editCalcBasicsDrg.calcBasics.costCenters.stream().filter(c -> c.costCenterId == cc.attrs.costCenterId).toList()}" var="item"
                     columnClasses="colIcon, col14, colValue, col14 number, col14 number, colValue, colValue, col14 number, col14 number" rowClasses="row1, row2">

            <h:column>
                <f:facet name="header"><h:outputText value=""/></f:facet>
                <h:commandLink action="#{editCalcBasicsDrg.deleteCostCenter(item)}" immediate="true" rendered="#{!editCalcBasicsDrg.readOnly}">
                    <h:graphicImage alt="#{msg.btnDelete}" name="Icon/small/delete.png" title="#{msg.btnDelete}" value=""/>
                    <cb:confirmDelete/>
                </h:commandLink>
            </h:column>

            <h:column>
                <f:facet name="header"><h:outputLabel value="Nummer" title="Nummer der Kostenstelle"/></f:facet>
                <inek:InputTextWithMessage value="#{item.costCenterNumber}" readonly="#{editCalcBasicsDrg.readOnly}"/>
            </h:column>

            <h:column>
                <f:facet name="header">Name der Kostenstelle</f:facet>
                <inek:InputTextWithMessage value="#{item.costCenterText}" readonly="#{editCalcBasicsDrg.readOnly}"/>
            </h:column>

            <h:column>
                <f:facet name="header">Kostenvolumen</f:facet>
                <inek:InputNumberWithMessage value="#{item.amount}" renderElement="result" readonly="#{editCalcBasicsDrg.readOnly}"/>
            </h:column>

            <h:column>
                <f:facet name="header">Anzahl der zugeordneten Vollkräfte des Ärztlichen Dienstes zur Kostenstelle</f:facet>
                <inek:InputNumberWithMessage value="#{item.fullVigorCnt}" readonly="#{editCalcBasicsDrg.readOnly}"/>
            </h:column>

            <h:column>
                <f:facet name="header">Leistungsschlüssel</f:facet>
                <inek:InputTextWithMessage value="#{item.serviceKey}" readonly="#{editCalcBasicsDrg.readOnly}"/>
            </h:column>

            <h:column>
                <f:facet name="header">Beschreibung, falls Leistungsschlüssel abweichend vom Kalkulationshandbuch, Version 4.0</f:facet>
                <inek:InputTextWithMessage value="#{item.serviceKeyDescription}" readonly="#{editCalcBasicsDrg.readOnly}"/>
            </h:column>

            <h:column>
                <f:facet name="header">Summe der Leistungseinheiten</f:facet>
                <inek:InputNumberWithMessage value="#{item.serviceSum}" renderElement="@form" readonly="#{editCalcBasicsDrg.readOnly}"/>
            </h:column>

            <h:column>
                <f:facet name="header">Kostensatz je LE</f:facet>
                <h:panelGroup id="result">
                    <inek:InputNumberWithMessage value="#{item.amount / item.serviceSum}" disabled="true" pattern="#,##0.00"/>
                </h:panelGroup>
            </h:column>

        </h:dataTable>

        <h:panelGroup rendered="#{!editCalcBasicsDrg.readOnly}" class="inputPart">
            <h:commandLink id="addButton" styleClass="addButton" value="#{msg.btnAddEntry}"
                           rendered="#{!editCalcBasicsDrg.readOnly}">
                <f:ajax event="click" render="@form :logout:remaining" listener="#{editCalcBasicsDrg.addCostCenter(cc.attrs.costCenterId)}"/>
            </h:commandLink>

            <div class="uploadFile inlineBlock marginLeft05">
                <h:inputFile styleClass="hiddenFile" id="file" value="#{editCalcBasicsDrg.file}" title="#{msg.btnUploadMessage}" onclick="document.getElementById('wrapper').style.cursor = 'progress';" >
                    <f:ajax listener="#{editCalcBasicsDrg.uploadNotices()}" render="@all"/>
                </h:inputFile>
                <div class="fakeFile">
                    <h:outputLabel styleClass="button" value="#{msg.btnUploadMessage}"/>
                </div>
                <h:commandLink rendered="#{editCalcBasicsDrg.importMessage.length() gt 0}" 
                               styleClass="button"
                               value="#{msg.btnJournal} &nbsp; #{editCalcBasicsDrg.showJournal ? '↑' : '↓'}" immediate="true"
                               action="#{editCalcBasicsDrg.toggleJournal}">
                    <f:ajax event="blur" render="@form :logout:remaining"/>
                </h:commandLink>
            </div>
            <h:inputTextarea rendered="#{editCalcBasicsDrg.importMessage.length() gt 0 and editCalcBasicsDrg.showJournal}" 
                             value="#{editCalcBasicsDrg.importMessage}"
                             readonly="true"
                             styleClass="element100 #{editCalcBasicsDrg.importMessage.length() > 500 ? 'areaHugh' : 'areaWideHigh'}"/>
        </h:panelGroup>
    </cc:implementation>
</html>