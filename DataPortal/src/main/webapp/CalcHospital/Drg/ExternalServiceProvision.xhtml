<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html [<!ENTITY nbsp "&#160;">]>

<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:cb="http://inek.org/dataportal/clientbehaviour"
                xmlns:inek="http://xmlns.jcp.org/jsf/composite/components"
                xmlns:calc="http://xmlns.jcp.org/jsf/composite/components/calc"
                xmlns:jsf="http://xmlns.jcp.org/jsf">

    <h2>#{msg.TopicCalcExternalServiceProvision}</h2>

    #{msg.hintExternalServiceProvision}

    <h:dataTable id="table"
                 value="#{editCalcBasicsDrg.calcBasics.serviceProvisions}" 
                 var ="item"
                 width="100%"
                 columnClasses="colIcon, col20em, colValue, colValue, colValue, col05em number, col05em number, col05em number"
                 rowClasses="row1, row2">

        <h:column>
            <f:facet name="header"><h:outputText value=""/></f:facet>
            <h:commandLink action="#{editCalcBasicsDrg.deleteServiceProvision(item)}" immediate="true" rendered="#{item.serviceProvisionType.firstYear eq 1900 and !editCalcBasicsDrg.readOnly}">
                <h:graphicImage alt="#{msg.btnDelete}" name="Icon/small/delete.png" title="#{msg.btnDelete}" value=""/>
                <cb:confirmDelete/>
            </h:commandLink>
        </h:column>

        <h:column>
            <f:facet name="header">Bereich</f:facet>
            <h:outputLabel styleClass="label" value="#{item.serviceProvisionType.text}" rendered="#{item.serviceProvisionTypeId ge 0}"/>
            <inek:InputTextWithMessage styleClassComponent="element100" 
                                       styleClass="element100" 
                                       value="#{item.domain}" 
                                       required="true"
                                       rendered="#{item.serviceProvisionTypeId lt 0}"/>
        </h:column>

        <h:column>
            <f:facet name="header">Erbringungsart</f:facet>
            <h:selectOneMenu id="externalProvision"
                             required="true"
                             requiredMessage="#{msg.msgValueNeeded}"
                             disabled="#{item.serviceProvisionTypeId lt 0 and empty item.domain}"
                             value="#{item.providedTypeId}" 
                             hideNoSelectionOption="true" >
                <f:selectItem itemLabel="#{msg.lblChooseEntryShort}" itemValue="#{-1}" noSelectionOption="true"/>
                <f:selectItem itemLabel="#{msg.itemNotProvided}" itemValue="#{0}"/>
                <f:selectItem itemLabel="#{msg.itemNotExternalProvided}" itemValue="#{1}"/>
                <f:selectItem itemLabel="#{msg.itemExternalProvided}" itemValue="#{2}"/>
                <f:selectItem itemLabel="#{msg.itemPartialExternalProvided}" itemValue="#{3}"/>
                <f:ajax event="change" render="@form :logout:remaining msgLevel"/>
            </h:selectOneMenu>
        </h:column>

        <h:column>
            <f:facet name="header">Fremdvergebene Teilbereiche</f:facet>
            <inek:InputTextWithMessage id="partition" 
                                       value="#{item.partitionExternalAssignment}" 
                                       required="#{item.providedTypeId eq 3}"
                                       styleClass="inputwide" 
                                       disabled="#{item.providedTypeId ne 3}"/>
        </h:column>

        <h:column>
            <f:facet name="header">Anmerkungen</f:facet>
            <inek:InputTextWithMessage value="#{item.note}" 
                                       readonly="#{item.serviceProvisionTypeId lt 0 and empty item.domain}"
                                       styleClass="inputwide"/>
        </h:column>

        <h:column>
            <f:facet name="header">Kosten- volumen #{editCalcBasicsDrg.calcBasics.dataYear}</f:facet>
            <inek:InputNumberWithMessage value="#{item.amount}" 
                                         styleClassComponent="col05em" 
                                         readonly="#{item.serviceProvisionTypeId lt 0 and empty item.domain}"
                                         renderElement="@form" 
                                         required="#{item.providedTypeId gt 0}"/>
        </h:column>

        <h:column>
            <f:facet name="header">Kosten- volumen #{editCalcBasicsDrg.calcBasics.dataYear - 1}</f:facet>
            <inek:InputNumberWithMessage value="#{editCalcBasicsDrg.priorProvisionAmount(item)}" disabled="true" styleClassComponent="col05em"/>
        </h:column>

        <h:column>
            <f:facet name="header">Abw.</f:facet>
            <inek:InputNumberWithMessage value="#{editCalcBasicsDrg.calcPercentualDiff(editCalcBasicsDrg.priorProvisionAmount(item), item.amount)}" disabled="true" styleClassComponent="col05em"/>
        </h:column>

    </h:dataTable>

    <h:commandLink id="addButton" styleClass="addButton inputPart" value="#{msg.btnAddEntry}"
                   rendered="#{!editCalcBasicsDrg.readOnly}">
        <f:ajax event="click" render="@form :logout:remaining" listener="#{editCalcBasicsDrg.addServiceProvision}"/>
    </h:commandLink>


</ui:composition>

