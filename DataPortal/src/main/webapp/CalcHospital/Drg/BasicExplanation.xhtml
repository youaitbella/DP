<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html [<!ENTITY nbsp "&#160;">]>

<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:inek="http://xmlns.jcp.org/jsf/composite/components"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:cb="http://inek.org/dataportal/clientbehaviour">

    <h2>Erklärung zur Kalkulationsgrundlage</h2>

    <table cellspacing="6">
        <thead>
        <th>Bezeichnung</th>
        <th>#{editCalcBasicsDrg.calcBasics.dataYear-1}</th>
        <th>#{editCalcBasicsDrg.calcBasics.dataYear}</th>
        <th>Abweichung</th>
        </thead>
        <tr>
            <td>
                <span class="label">Summe kalkulationsrelevanter Kosten (EUR)</span>
            </td>
            <td>
        <inek:InputNumberWithMessage styleClass="inputwide"
                                     value="#{editCalcBasicsDrg.priorCalcBasics.sumCalcCost}" 
                                     disabled="true"
                                     id="pSumCalcCost"
                                     />
        </td>
        <td>
        <inek:InputNumberWithMessage styleClass="inputwide"
                                     value="#{editCalcBasicsDrg.calcBasics.sumCalcCost}" 
                                     required="true" 
                                     id="sumCalcCosts"
                                     renderElement="@this pDiffSumCalcCost :logout:remaining"
                                     />
        </td>
        <td>
        <h:panelGroup id="pDiffSumCalcCost">
            <inek:InputNumberWithMessage styleClass="inputwide"
                                         value="#{editCalcBasicsDrg.calcPercentualDiff(editCalcBasicsDrg.priorCalcBasics.sumCalcCost, editCalcBasicsDrg.calcBasics.sumCalcCost)}" 
                                         disabled="true"
                                         />
        </h:panelGroup>
        </td>
        </tr>
        <tr>
            <td>
                <span class="label">Anzahl kalkulationsrelevanter Fälle</span>
            </td>
            <td>
            </td>
            <td>
            </td>
            <td>
            </td>
        </tr>
        <tr>
            <td>
                <span class="label">Fälle vollstationär</span>
            </td>
            <td>
        <inek:InputNumberWithMessage styleClass="inputwide"
                                     value="#{editCalcBasicsDrg.priorCalcBasics.caseInStationCnt}" 
                                     id="pCaseInstationCount"
                                     disabled="true"
                                     />
        </td>
        <td>
        <inek:InputNumberWithMessage styleClass="inputwide"
                                     value="#{editCalcBasicsDrg.calcBasics.caseInStationCnt}" 
                                     required="true" 
                                     id="fullCases"
                                     renderElement="@this pDiffCaseInstationCount :logout:remaining"
                                     />
        </td>
        <td>
        <h:panelGroup id="pDiffCaseInstationCount">
            <inek:InputNumberWithMessage styleClass="inputwide"
                                         value="#{editCalcBasicsDrg.calcPercentualDiff(editCalcBasicsDrg.priorCalcBasics.caseInStationCnt, editCalcBasicsDrg.calcBasics.caseInStationCnt)}" 
                                         disabled="true"
                                         />
        </h:panelGroup>
        </td>
        </tr>
        <tr>
            <td>
                <span class="label">Fälle teilstationär</span>
            </td>
            <td>
        <inek:InputNumberWithMessage styleClass="inputwide"
                                     value="#{editCalcBasicsDrg.priorCalcBasics.casePartialStationCnt}"
                                     disabled="true"
                                     />
        </td>
        <td>
        <inek:InputNumberWithMessage styleClass="inputwide"
                                     value="#{editCalcBasicsDrg.calcBasics.casePartialStationCnt}" 
                                     required="true" 
                                     id="halfCases"
                                     renderElement="@this pDiffPartialStationCount :logout:remaining"
                                     />
        </td>
        <td>
        <h:panelGroup id="pDiffPartialStationCount">
            <inek:InputNumberWithMessage styleClass="inputwide"
                                         value="#{editCalcBasicsDrg.calcPercentualDiff(editCalcBasicsDrg.priorCalcBasics.casePartialStationCnt, editCalcBasicsDrg.calcBasics.casePartialStationCnt)}"
                                         disabled="true"
                                         />
        </h:panelGroup>
        </td>
        </tr>
        <tr>
            <td>
                <span class="label">Berechnungstage teilstationär</span>
            </td>
            <td>
        <inek:InputNumberWithMessage styleClass="inputwide"
                                     value="#{editCalcBasicsDrg.priorCalcBasics.daysPartialStation}"
                                     id="pHalfCalcDays"
                                     disabled="true"
                                     />
        </td>
        <td>
        <inek:InputNumberWithMessage styleClass="inputwide"
                                     value="#{editCalcBasicsDrg.calcBasics.daysPartialStation}"
                                     required="true" 
                                     id="halfCalcDays"
                                     renderElement="@this pDiffHalfCalcDays :logout:remaining"
                                     />
        </td>
        <td>
        <h:panelGroup id="pDiffHalfCalcDays">
            <inek:InputNumberWithMessage styleClass="inputwide"
                                         value="#{editCalcBasicsDrg.calcPercentualDiff(editCalcBasicsDrg.priorCalcBasics.daysPartialStation, editCalcBasicsDrg.calcBasics.daysPartialStation)}"
                                         disabled="true"
                                         />
        </h:panelGroup>
        </td>
        </tr>
        <tr>
            <td>
                <span class="label">Begleitpersonen</span>
            </td>
            <td>
        <inek:InputNumberWithMessage styleClass="inputwide"
                                     value="#{editCalcBasicsDrg.priorCalcBasics.patientEscort}"
                                     disabled="true"
                                     id="pPatientEscort"
                                     />
        </td>
        <td>
        <inek:InputNumberWithMessage styleClass="inputwide"
                                     value="#{editCalcBasicsDrg.calcBasics.patientEscort}"
                                     required="true" 
                                     id="companions"
                                     renderElement="@this pPatientEscort pDiffPatientEscort :logout:remaining"
                                     />
        </td>
        <td>
        <h:panelGroup id="pDiffPatientEscort">
            <inek:InputNumberWithMessage styleClass="inputwide"
                                         value="#{editCalcBasicsDrg.calcPercentualDiff(editCalcBasicsDrg.priorCalcBasics.patientEscort, editCalcBasicsDrg.calcBasics.patientEscort)}"
                                         disabled="true"
                                         />
        </h:panelGroup>
        </td>
        </tr>
        <tr>
            <td>
                <span class="label">rein vorstationär</span>
            </td>
            <td>
        <inek:InputNumberWithMessage styleClass="inputwide"
                                     value="#{editCalcBasicsDrg.priorCalcBasics.preStation}"
                                     disabled="true"
                                     />
        </td>
        <td>
        <inek:InputNumberWithMessage styleClass="inputwide"
                                     value="#{editCalcBasicsDrg.calcBasics.preStation}"
                                     required="true" 
                                     id="onlyStationary"
                                     renderElement="@this pDiffPreStation :logout:remaining"
                                     />
        </td>
        <td>
        <h:panelGroup id="pDiffPreStation">
            <inek:InputNumberWithMessage styleClass="inputwide"
                                         value="#{editCalcBasicsDrg.calcPercentualDiff(editCalcBasicsDrg.priorCalcBasics.preStation, editCalcBasicsDrg.calcBasics.preStation)}"
                                         disabled="true"
                                         />
        </h:panelGroup>
        </td>
        </tr>
        <tr>
            <td>
                <span class="label">Betten (DRG-Bereich)</span>
            </td>
            <td>
        <inek:InputNumberWithMessage styleClass="inputwide"
                                     value="#{editCalcBasicsDrg.priorCalcBasics.beds}"
                                     disabled="true"
                                     />
        </td>
        <td>
        <inek:InputNumberWithMessage styleClass="inputwide"
                                     value="#{editCalcBasicsDrg.calcBasics.beds}"
                                     required="true" 
                                     renderElement="@this pDiffBeds :logout:remaining"
                                     />
        </td>
        <td>
        <h:panelGroup id="pDiffBeds">
            <inek:InputNumberWithMessage styleClass="inputwide"
                                         value="#{editCalcBasicsDrg.calcPercentualDiff(editCalcBasicsDrg.priorCalcBasics.beds, editCalcBasicsDrg.calcBasics.beds)}"
                                         disabled="true"
                                         />
        </h:panelGroup>
        </td>
        </tr>
        <tr>
            <td>
                <span class="label">Anzahl teilstationäre Plätze (DRG-Bereich)</span>
            </td>
            <td>
        <inek:InputNumberWithMessage styleClass="inputwide"
                                     value="#{editCalcBasicsDrg.priorCalcBasics.partialCnt}"
                                     disabled="true"
                                     />
        </td>
        <td>
        <inek:InputNumberWithMessage styleClass="inputwide"
                                     value="#{editCalcBasicsDrg.calcBasics.partialCnt}"
                                     required="true" 
                                     renderElement="@this pDiffPartialCnt :logout:remaining"
                                     />
        </td>
        <td>
        <inek:InputNumberWithMessage styleClass="inputwide"
                                     value="#{editCalcBasicsDrg.calcPercentualDiff(editCalcBasicsDrg.priorCalcBasics.partialCnt, editCalcBasicsDrg.calcBasics.partialCnt)}"
                                     disabled="true"
                                     />
        </td>
        </tr>
        <tbody>

        </tbody>
    </table>

    <h2>Entlassender Standort</h2>

    <div class="inputPart">
        <h:outputLabel styleClass="label" value="Anzahl Standorte:" /> &nbsp;
        <h:inputText styleClass="inputshort" value="#{editCalcBasicsDrg.calcBasics.locationCnt}" required="true">
            <f:ajax event="blur" render="@this :logout:remaining"/>
        </h:inputText>
    </div>

    <div class="inputPart">
        <inek:BooleanRadioButton label="Liegt ein nach Standorten differenzierter Versorgungsauftrag vor:"  
                                 renderElement="@this :logout:remaining" value="#{editCalcBasicsDrg.calcBasics.difLocationSupply}" labelStyle="label"/>
    </div>

    <h:dataTable  headerClass="list-header" id="exitLocation"
                  value="#{editCalcBasicsDrg.calcBasics.locations}" var="item" width="70%" rowClasses="row1, row2" 
                  columnClasses="colIcon, col90, colShort"
                  rendered="true"
                  >

        <h:column>
            <f:facet name="header">
                <h:outputText value=""/>
            </f:facet>
            <h:commandLink styleClass="colIcon">
                <h:graphicImage alt="#{msg.btnDelete}" name="Icon/small/delete.png" title="#{msg.btnDelete}" value=""/>
                <f:ajax event="click" render="@form :logout:remaining" listener="#{editCalcBasicsDrg.deleteLocation(item)}"/>
                <cb:confirmDelete/>
            </h:commandLink>
        </h:column>

        <h:column>
            <f:facet name="header">
                <h:outputText value="Entlassender Standort"/><br/>
                <h:outputText value="(aussagekräftiger Name)"/>
            </f:facet>
            <h:inputText value="#{item.location}" styleClass="inputwide" required="true">
                <f:ajax render="@this :logout:remaining"/>
            </h:inputText>
        </h:column>

        <h:column>
            <f:facet name="header">
                <h:outputText value="Nummer"/>
            </f:facet>
            <h:inputText value="#{item.locationNo}" styleClass="inputwide" required="true">
                <f:ajax render="@this :logout:remaining"/>
            </h:inputText>
        </h:column>

    </h:dataTable>

    <h:commandLink id="addButtonLocation" styleClass="addButton inputPart" value="#{msg.btnAddEntry}">
        <f:ajax event="click" render="@form :logout:remaining" listener="#{editCalcBasicsDrg.addLocation()}"/>
    </h:commandLink>

    <h2>Besondere Einrichtungen (BE)</h2>

    <div class="inputPart">
        <inek:BooleanRadioButton label="Besteht für das Krankenhaus (bzw. eine Fachabteilung) eine Vereinbarung einer/mehrerer Besonderen(r) Einrichtung(en) nach den Regelungen der VBE 2016:"  
                                 renderElement="@this :logout:remaining" value="#{editCalcBasicsDrg.calcBasics.specialUnit}" labelStyle="label"/>
    </div>

    <h:dataTable  headerClass="list-header" id="special"
                  value="#{editCalcBasicsDrg.calcBasics.specialUnits}" var="item" width="70%" rowClasses="row1, row2" 
                  columnClasses="colIcon, col03, col03, col03"
                  rendered="true"
                  >

        <h:column>
            <f:facet name="header">
                <h:outputText value=""/>
            </f:facet>
            <h:commandLink styleClass="colIcon">
                <h:graphicImage alt="#{msg.btnDelete}" name="Icon/small/delete.png" title="#{msg.btnDelete}" value=""/>
                <f:ajax event="click" render="@form :logout:remaining" listener="#{editCalcBasicsDrg.deleteSpecialUnit(item)}"/>
            </h:commandLink>
        </h:column>

        <h:column>
            <f:facet name="header">
                <h:outputText value="Art der BE"/><br/>
            </f:facet>
            <h:inputText value="#{item.type}" styleClass="inputwide" required="true">
                <f:ajax render="@this :logout:remaining"/>
            </h:inputText>
        </h:column>

        <h:column>
            <f:facet name="header">
                <h:outputText value="Fallzahl"/>
            </f:facet>
            <inek:InputNumberWithMessage value="#{item.caseCnt}" styleClass="inputwide" required="true" renderElement="@this :logout:remaining" />
        </h:column>

        <h:column>
            <f:facet name="header">
                <h:outputText value="Kostenvolumen"/>
            </f:facet>
            <inek:InputNumberWithMessage value="#{item.cost}" styleClass="inputwide" required="true" renderElement="@this :logout:remaining" />
        </h:column>

    </h:dataTable>

    <h:commandLink id="addButtonSpecial" styleClass="addButton inputPart" value="#{msg.btnAddEntry}">
        <f:ajax event="click" render="@form :logout:remaining" listener="#{editCalcBasicsDrg.addSpecialUnit()}"/>
    </h:commandLink>

    <h2>Zentren und Schwerpunkte gem. § 2 Abs. 2 Satz 2 Nr. 4 KHEntgG</h2>

    <div class="inputPart">
        <inek:BooleanRadioButton label="Besteht eine gesondert vereinbarte Vergütung für Zentren und Schwerpunkte gem. § 2 Abs. 2 Satz 2 Nr. 4 KHEntgG:"  
                                 renderElement="@this :logout:remaining" value="#{editCalcBasicsDrg.calcBasics.centralFocus}" labelStyle="label"/>
    </div>

    <h:dataTable  headerClass="list-header" id="centre"
                  value="#{editCalcBasicsDrg.calcBasics.centralFocuses}" var="item" width="100%" rowClasses="row1, row2" 
                  columnClasses="colIcon, col03, col03, col03, col03, col03, col03, col03"
                  rendered="true"
                  >

        <h:column>
            <f:facet name="header">
                <h:outputText value=""/>
            </f:facet>
            <h:commandLink styleClass="colIcon">
                <h:graphicImage alt="#{msg.btnDelete}" name="Icon/small/delete.png" title="#{msg.btnDelete}" value=""/>
                <f:ajax event="click" render="@form :logout:remaining" listener="#{editCalcBasicsDrg.deleteCentralFocus(item)}" />
            </h:commandLink>
        </h:column>

        <h:column>
            <f:facet name="header">
                <h:outputText value="Zentrums- bzw. Schwerpunktbezeichnung"/><br/>
                <h:outputText value="(aussagekräftiger Name)"/>
            </f:facet>
            <h:inputText value="#{item.text}" styleClass="inputwide" required="true">
                <f:ajax render="@this :logout:remaining"/>
            </h:inputText>
        </h:column>

        <h:column>
            <f:facet name="header">
                <h:outputText value="Fallzahl"/>
            </f:facet>
            <inek:InputNumberWithMessage value="#{item.caseCnt}" styleClass="inputwide" required="true" renderElement="@this :logout:remaining" />
        </h:column>

        <h:column>
            <f:facet name="header">
                <h:outputText value="Personalkosten"/>
            </f:facet>
            <inek:InputNumberWithMessage value="#{item.personalCost}" styleClass="inputwide" required="true" renderElement="@this :logout:remaining" isInt="false"/>
        </h:column>

        <h:column>
            <f:facet name="header">
                <h:outputText value="Sachkosten"/>
            </f:facet>
            <inek:InputNumberWithMessage value="#{item.materialcost}" styleClass="inputwide" required="true" renderElement="@this :logout:remaining"/>
        </h:column>

        <h:column>
            <f:facet name="header">
                <h:outputText value="Infrastrukturkosten"/>
            </f:facet>
            <inek:InputNumberWithMessage value="#{item.infraCost}" styleClass="inputwide" required="true" renderElement="@this :logout:remaining"/>
        </h:column>

        <h:column>
            <f:facet name="header">
                <h:outputText value="Vereinbartes Entgelt je Fall"/>
            </f:facet>
            <inek:InputNumberWithMessage value="#{item.remunerationAmount}" styleClass="inputwide" required="true" renderElement="@this :logout:remaining" isInt="false"/>
        </h:column>

        <h:column>
            <f:facet name="header">
                <h:outputText value="Entgeltschlüssel"/>
            </f:facet>
            <h:inputText value="#{item.remunerationKey}" styleClass="inputwide" required="true">
                <f:ajax render="@this :logout:remaining"/>
            </h:inputText>
        </h:column>

    </h:dataTable>

    <h:commandLink id="addButtonCentre" styleClass="addButton inputPart" value="#{msg.btnAddEntry}">
        <f:ajax event="click" render="@form :logout:remaining" listener="#{editCalcBasicsDrg.addCentralFocus()}"/>
    </h:commandLink>

    <br/><br/>

    <ui:repeat value="#{editCalcBasicsDrg.calcBasics.delimitationFacts}" var="x" varStatus="status">

        <div class="inputPart">
            <h:outputLabel value="#{x.contentText.text}" styleClass="blockElement" style="width: calc(100% - 22em);"/> &nbsp;
            <h:selectBooleanCheckbox styleClass="blockElement" style="width: 2em;" value="#{x.used}" >
                <f:ajax event="change" render="@form :logout:remaining delimit-content" />
            </h:selectBooleanCheckbox>
            <h:outputLabel value="#{editCalcBasicsDrg.calcBasics.dataYear - 1}" styleClass="blockElement" style="width: 6em;" rendered="#{x.used and x.requireInputs}"/>
            <h:outputLabel value="#{editCalcBasicsDrg.calcBasics.dataYear}" styleClass="blockElement" style="width: 6em;" rendered="#{x.used and x.requireInputs}"/>
            <h:outputLabel value="#{msg.lblDevitation}" styleClass="blockElement" style="width: 6em;" rendered="#{x.used and x.requireInputs}"/>
        </div>

        <h:dataTable value="#{editCalcBasicsDrg.delimitationFactsSubTitles}" 
                     rendered="#{x.used}"
                     var="data" 
                     width="100%"
                     rowClasses="row1, row2"
                     columnClasses="colValue, col05em number, col05em number, col05em number"
                     styleClass="marginTop">

            <h:column>
                <h:outputLabel rendered="#{x.requireInputs}" value="#{data}"/>
            </h:column>

            <h:column rendered="#{x.used and x.requireInputs}">
                <inek:InputNumberWithMessage rendered="#{data eq 'Personalkosten'}" value="#{editCalcBasicsDrg.getPriorDelimitationFact(x.contentTextId).personalCost}" styleClass="col06em" disabled="true"/>
                <inek:InputNumberWithMessage rendered="#{data eq 'Sachkosten'}" value="#{editCalcBasicsDrg.getPriorDelimitationFact(x.contentTextId).materialCost}" styleClass="col06em" disabled="true"/>
                <inek:InputNumberWithMessage rendered="#{data eq 'Infrastrukturkosten'}" value="#{editCalcBasicsDrg.getPriorDelimitationFact(x.contentTextId).infraCost}" styleClass="col06em" disabled="true"/>
            </h:column>

            <h:column rendered="#{x.used and x.requireInputs}">
                <inek:InputNumberWithMessage id="data-personal" rendered="#{data eq 'Personalkosten'}" value="#{x.personalCost}"
                                             styleClass="col06em" required="true" renderElement="@this diff-personal :logout:remaining"
                                             disabled="#{x.contentText.text eq 'Investitionskosten'}"/>
                <inek:InputNumberWithMessage id="data-material" rendered="#{data eq 'Sachkosten'}" value="#{x.materialCost}"
                                             styleClass="col06em" required="true" renderElement="@this diff-material :logout:remaining"
                                             />
                <inek:InputNumberWithMessage id="data-infra" rendered="#{data eq 'Infrastrukturkosten'}" value="#{x.infraCost}"
                                             styleClass="col06em" required="true" renderElement="@this diff-infra :logout:remaining"
                                             disabled="#{x.contentText.text eq 'Investitionskosten'}"/>
                <h:message for="data" id="msgData" styleClass="errorMessage"/>
            </h:column>

            <h:column rendered="#{x.used and x.requireInputs}">
                <h:panelGrid id="diff-personal" style="margin: 0; padding : 0;">
                    <inek:InputNumberWithMessage rendered="#{data eq 'Personalkosten'}" value="#{editCalcBasicsDrg.calcPercentualDiff(editCalcBasicsDrg.getPriorDelimitationFact(x.contentTextId).personalCost, x.personalCost)}"
                                                 styleClass="col06em"
                                                 disabled="true"/>
                </h:panelGrid>
                <h:panelGrid id="diff-material" style="margin: 0; padding : 0;">
                    <inek:InputNumberWithMessage rendered="#{data eq 'Sachkosten'}" value="#{editCalcBasicsDrg.calcPercentualDiff(editCalcBasicsDrg.getPriorDelimitationFact(x.contentTextId).materialCost, x.materialCost)}"
                                                 styleClass="col06em"
                                                 disabled="true"/>
                </h:panelGrid>
                <h:panelGrid id="diff-infra" style="margin: 0; padding : 0;">
                    <inek:InputNumberWithMessage rendered="#{data eq 'Infrastrukturkosten'}" value="#{editCalcBasicsDrg.calcPercentualDiff(editCalcBasicsDrg.getPriorDelimitationFact(x.contentTextId).infraCost, x.infraCost)}"
                                                 styleClass="col06em"
                                                 disabled="true"/>
                </h:panelGrid>
            </h:column>
        </h:dataTable>
    </ui:repeat>

</ui:composition>

