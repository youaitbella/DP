<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html [<!ENTITY nbsp "&#160;">]>

<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:cb="http://inek.org/dataportal/clientbehaviour"
                xmlns:inek="http://xmlns.jcp.org/jsf/composite/components/common"
                xmlns:jsf="http://xmlns.jcp.org/jsf">

    <h2 title="#{msg.titleMaternityRoom}">#{msg.TopicCalcMaternityRoom}</h2>

    <inek:LabeledCheckbox label="#{msg.lblHasGynecology}" 
                          styleClassLabel="label60"
                          value="#{editCalcBasicsDrg.calcBasics.gynecology}">
            <f:ajax event="clientChange"  
                    render="@form :script"
                    listener="#{sessionController.hideData(editCalcBasicsDrg.calcBasics.gynecology or editCalcBasicsDrg.calcBasics.obstetrical)}"/>
    </inek:LabeledCheckbox>
    <inek:LabeledCheckbox label="#{msg.lblHasObstetrical}" 
                          styleClassLabel="label60"
                          value="#{editCalcBasicsDrg.calcBasics.obstetrical}">
            <f:ajax event="clientChange"  
                    render="@form :script"
                    listener="#{sessionController.hideData(editCalcBasicsDrg.calcBasics.gynecology or editCalcBasicsDrg.calcBasics.obstetrical)}"/>
    </inek:LabeledCheckbox>

    <div jsf:id="maternity" jsf:rendered="#{editCalcBasicsDrg.calcBasics.gynecology 
                                            || editCalcBasicsDrg.calcBasics.obstetrical}">
        <h2>Erbrachte Leistungen</h2>

        <h:outputLabel styleClass="label50" value=" "/>
        <h:outputLabel styleClass="label15 number" value="#{editCalcBasicsDrg.calcBasics.dataYear}"/>
        <h:outputLabel styleClass="label15 number" value="#{editCalcBasicsDrg.calcBasics.dataYear - 1}"/>
        <h:outputLabel styleClass="label15 number" value="Abweichung"/>
        
        <br/>
        <h:outputLabel styleClass="label50" value="Summe der Aufenthaltszeit der Patientin im Kreißsaal in Stunden (ausschließlich für vollstationäre Patientinnen)"/>
        <h:inputText styleClass="element15" id="deliveryRoomHours" value="#{editCalcBasicsDrg.calcBasics.deliveryRoomHours}" required="true">
            <f:ajax event="blur" render="@this lblDiffDeliveryRoomHours :logout:remaining" />
            <f:convertNumber/>
        </h:inputText>        
        <h:outputLabel styleClass="label15 number" value="#{editCalcBasicsDrg.priorCalcBasics.deliveryRoomHours}">
            <f:convertNumber/>
        </h:outputLabel>
        <h:outputLabel styleClass="label15 number" id="lblDiffDeliveryRoomHours" value="#{editCalcBasicsDrg.calcBasics.deliveryRoomHours - editCalcBasicsDrg.priorCalcBasics.deliveryRoomHours}">
            <f:convertNumber/>
        </h:outputLabel>

        <br/>
        <h:outputLabel styleClass="label50"  value="davon für vorgeburtliche Kreißsaalaufenthalte"/>

        <h:inputText styleClass="element15" id="preBirthHabitationCnt" value="#{editCalcBasicsDrg.calcBasics.deliveryRoomPreBirthHabitationCnt}" required="true">
            <f:ajax event="blur" render="@this lblDiffPreBirthHabitantCnt :maternity:txtStructure :logout:remaining" />
        </h:inputText>
        <h:outputLabel styleClass="label15 number" id="lblPreBirthHabitantCnt" value="#{editCalcBasicsDrg.priorCalcBasics.deliveryRoomPreBirthHabitationCnt}"/>
        <h:outputLabel styleClass="label15 number" id="lblDiffPreBirthHabitantCnt" value="#{editCalcBasicsDrg.calcBasics.deliveryRoomPreBirthHabitationCnt - editCalcBasicsDrg.priorCalcBasics.deliveryRoomPreBirthHabitationCnt}"/>

        <br/>
        <h:outputLabel styleClass="label50"  value="Anzahl vollstationär geborener Kinder"/>
        <h:inputText styleClass="element15" id="instationBirthCnt" value="#{editCalcBasicsDrg.calcBasics.deliveryRoomInstationBirthCnt}" required="true">
            <f:ajax event="blur" render="@this lblDiffInstationBirthCnt :logout:remaining" />
        </h:inputText>
        <h:outputLabel styleClass="label15 number" value="#{editCalcBasicsDrg.priorCalcBasics.deliveryRoomInstationBirthCnt}"/>
        <h:outputLabel styleClass="label15 number" id="lblDiffInstationBirthCnt" value="#{editCalcBasicsDrg.calcBasics.deliveryRoomInstationBirthCnt - editCalcBasicsDrg.priorCalcBasics.deliveryRoomInstationBirthCnt}"/>
        
        <br/>
        <h:outputLabel styleClass="label50" value="Bei vorgeburtlichen Fällen fielen im Datenjahr 2016 keine 'Aufenthaltszeiten der Patientin im Kreißsaal' an:"/>
        <h:selectBooleanCheckbox value="#{editCalcBasicsDrg.calcBasics.noDeliveryRoomHabitation}">
            <f:ajax event="change" render="@this :logout:remaining" />
        </h:selectBooleanCheckbox>
        
        <br/>
        <h:outputLabel styleClass="label" value="Bitte erläutern Sie (kurz) die Organisationsstrukturen in diesem Bereich:"></h:outputLabel>
        <h:inputTextarea id="txtStructure" styleClass="areaWideHigh" value="#{editCalcBasicsDrg.calcBasics.deliveryRoomOrganizationalStructure}" 
                         rendered="#{editCalcBasicsDrg.calcBasics.deliveryRoomPreBirthHabitationCnt == 0}" >
            <f:ajax event="blur" render="@this :logout:remaining" />
        </h:inputTextarea>

        <h2>Kostenstellen der erbrachten Leistungen #{editCalcBasicsDrg.calcBasics.dataYear}</h2>

        <h:dataTable id="tblObstretics"
                     value="#{editCalcBasicsDrg.calcBasics.obstetricsGynecologies}" 
                     var ="obstretic"
                     width="100%"
                     columnClasses="colIcon, col20em, col05 number, col05em number, col05em number, col05em number, col05em number, col05em number, col05em number"
                     rowClasses="row1, row2">

            <h:column id="colDeleteId">
                <f:facet name="header">
                    <h:outputText value=""/>
                </f:facet>
                <h:commandLink action="#{editCalcBasicsDrg.deleteObstreticsGynecology(obstretic)}" immediate="true" rendered="true">
                    <h:graphicImage alt="#{msg.btnDelete}" name="Icon/small/delete.png" title="#{msg.btnDelete}" value=""/>
                    <cb:confirmDelete/>
                </h:commandLink>
            </h:column>

            <h:column>
                <f:facet name="header">Kostenstelle</f:facet>
                <!--h:outputLabel styleClass="label" value="# {obstretic.costCenterText}" rendered="true"/-->
                <inek:InputTextWithMessage styleClassComponent="element100" styleClass="element100" 
                                           value="#{obstretic.costCenterText}" rendered="true"/>
            </h:column>

            <h:column>
                <f:facet name="header">Kostenstellengruppe</f:facet>
                <h:selectOneMenu id="externalProvision"
                                 required="true"
                                 requiredMessage="#{msg.msgValueNeeded}"
                                 value="#{obstretic.costTypeId}" 
                                 hideNoSelectionOption="true" 
                                 styleClass="inputshort">
                    <f:selectItem itemLabel="1" itemValue="#{1}"/>
                    <f:selectItem itemLabel="4" itemValue="#{4}"/>
                    <f:selectItem itemLabel="6" itemValue="#{6}"/>
                    <f:selectItem itemLabel="11" itemValue="#{11}"/>
                    <f:selectItem itemLabel="12" itemValue="#{12}"/>
                    <f:selectItem itemLabel="13" itemValue="#{13}"/>
                    <f:ajax event="change" render="@form :logout:remaining msgLevel"/>
                </h:selectOneMenu>
            </h:column>

            <h:column>
                <f:facet name="header">Ärztlicher Dienst</f:facet>
                <inek:InputIntegerWithMessage id="partition" value="#{obstretic.medicalServiceCnt}" styleClass="col05em number" />
            </h:column>

            <h:column>
                <f:facet name="header">davon Belegärzte</f:facet>
                <inek:InputIntegerWithMessage value="#{obstretic.attendingDoctorCnt}" styleClass="col05em number"/>
            </h:column>

            <h:column>
                <f:facet name="header">Pflegedienst</f:facet>
                <inek:InputIntegerWithMessage value="#{obstretic.nursingServiceCnt}" styleClass="col05em number" />
            </h:column>

            <h:column>
                <f:facet name="header">Funktionsdienst (ohne Hebammen)</f:facet>
                <inek:InputIntegerWithMessage value="#{obstretic.functionalServiceCnt}" styleClass="col05em number"/>
            </h:column>

            <h:column>
                <f:facet name="header">Hebammen</f:facet>
                <inek:InputIntegerWithMessage value="#{obstretic.midwifeCnt}" styleClass="col05em number"/>
            </h:column>

            <h:column>
                <f:facet name="header">davon Beleg-Hebammen</f:facet>
                <inek:InputIntegerWithMessage value="#{obstretic.attendingMidwifeCnt}" styleClass="col05em number"/>
            </h:column>

        </h:dataTable>

        <h:commandLink id="addButton" styleClass="addButton inputPart" value="#{msg.btnAddEntry}"
                       rendered="#{!editCalcBasicsDrg.readOnly}">
            <f:ajax event="click" render="@form :logout:remaining" listener="#{editCalcBasicsDrg.addObstreticsGynecology()}"/>
        </h:commandLink>


        <h2>Kostenstellen der erbrachten Leistungen #{editCalcBasicsDrg.calcBasics.dataYear - 1}</h2>

        <h:dataTable id="tblPrevObstretics"
                     value="#{editCalcBasicsDrg.priorCalcBasics.obstetricsGynecologies}" 
                     var ="prevObstretic"
                     width="100%"
                     columnClasses="col20em, col05 number, col05em number, col05em number, col05em number, col05em number, col05em number, col05em number"
                     rowClasses="row1, row2">

            <h:column>
                <f:facet name="header">Kostenstelle</f:facet>
                <inek:InputTextWithMessage styleClassComponent="element100" styleClass="element100" 
                                           value="#{prevObstretic.costCenterText}" rendered="true" disabled="true"/>
            </h:column>

            <h:column>
                <f:facet name="header">Kostenstellengruppe</f:facet>
                <h:selectOneMenu id="externalProvision"
                                 required="true"
                                 requiredMessage="#{msg.msgValueNeeded}"
                                 value="#{prevObstretic.costTypeId}" 
                                 hideNoSelectionOption="true"
                                 styleClass="inputshort"
                                 disabled="true"
                                 >
                    <f:selectItem itemLabel="1" itemValue="#{1}"/>
                    <f:selectItem itemLabel="4" itemValue="#{4}"/>
                    <f:selectItem itemLabel="6" itemValue="#{6}"/>
                    <f:selectItem itemLabel="11" itemValue="#{11}"/>
                    <f:selectItem itemLabel="12" itemValue="#{12}"/>
                    <f:selectItem itemLabel="13" itemValue="#{13}"/>
                    <f:ajax event="change" render="@form :logout:remaining msgLevel"/>
                </h:selectOneMenu>
            </h:column>

            <h:column>
                <f:facet name="header">Ärztlicher Dienst</f:facet>
                <inek:InputIntegerWithMessage id="partition" value="#{prevObstretic.medicalServiceCnt}" styleClass="col05em number" disabled="true"/>
            </h:column>

            <h:column>
                <f:facet name="header">davon Belegärzte</f:facet>
                <inek:InputIntegerWithMessage value="#{prevObstretic.attendingDoctorCnt}" styleClass="col05em number" disabled="true"/>
            </h:column>

            <h:column>
                <f:facet name="header">Pflegedienst</f:facet>
                <inek:InputIntegerWithMessage value="#{prevObstretic.nursingServiceCnt}" styleClass="col05em number" disabled="true"/>
            </h:column>

            <h:column>
                <f:facet name="header">Funktionsdienst (ohne Hebammen)</f:facet>
                <inek:InputIntegerWithMessage value="#{prevObstretic.functionalServiceCnt}" styleClass="col05em number" disabled="true"/>
            </h:column>

            <h:column>
                <f:facet name="header">Hebammen</f:facet>
                <inek:InputIntegerWithMessage value="#{prevObstretic.midwifeCnt}" styleClass="col05em number" disabled="true"/>
            </h:column>

            <h:column>
                <f:facet name="header">davon Beleg-Hebammen</f:facet>
                <inek:InputIntegerWithMessage value="#{prevObstretic.attendingMidwifeCnt}" styleClass="col05em number" disabled="true"/>
            </h:column>

        </h:dataTable>
        
        <h:panelGroup rendered="#{editCalcBasicsDrg.calcBasics.dataYear > 2016 and editCalcBasicsDrg.calcBasics.obstetrical}">
            <h2>#{msg.lblTopMaternityService} #{editCalcBasicsDrg.calcBasics.dataYear}</h2>

            <h:dataTable value="#{editCalcBasicsDrg.calcBasics.kstTop.stream().filter(i -> i.ktCostCenterId == 6).toList()}" var="item">
                <h:column>
                    <f:facet name="header">#{msg.lblNotation}</f:facet>
                    <inek:InputTextWithMessage value="#{item.text}"/>
                </h:column>
                <h:column>
                    <f:facet name="header">#{msg.lblCaseCount}</f:facet>
                    <inek:InputTextWithMessage value="#{item.caseCount}"/>
                </h:column>
                <h:column>
                    <f:facet name="header">#{msg.lblRevenueVolume}</f:facet>
                    <inek:InputTextWithMessage value="#{item.delimitationAmount}"/>
                </h:column>
                <h:column>
                    <f:facet name="header">#{msg.lblMarkedOfCostVolume}</f:facet>
                    <inek:InputTextWithMessage value="#{item.amount}"/>
                </h:column>
            </h:dataTable>

            <h:panelGroup rendered="#{editCalcBasicsDrg.priorCalcBasics.kstTop.stream().filter(i -> i.ktCostCenterId == 6).count() > 0}">
                <h2>#{msg.lblTopMaternityService} #{editCalcBasicsDrg.calcBasics.dataYear - 1}</h2>

                <h:dataTable value="#{editCalcBasicsDrg.priorCalcBasics.kstTop.stream().filter(i -> i.ktCostCenterId == 6).toList()}" var="item">
                    <h:column>
                        <f:facet name="header">#{msg.lblNotation}</f:facet>
                        <h:inputText value="#{item.text}" disabled="true"/>
                    </h:column>
                    <h:column>
                        <f:facet name="header">#{msg.lblCaseCount}</f:facet>
                        <h:inputText value="#{item.caseCount}" disabled="true"/>
                    </h:column>
                    <h:column>
                        <f:facet name="header">#{msg.lblRevenueVolume}</f:facet>
                        <h:inputText value="#{item.delimitationAmount}" disabled="true"/>
                    </h:column>
                    <h:column>
                        <f:facet name="header">#{msg.lblMarkedOfCostVolume}</f:facet>
                        <h:inputText value="#{item.amount}" disabled="true"/>
                    </h:column>
                </h:dataTable>
            </h:panelGroup>
        </h:panelGroup>
        
        
        <h2>TOP 5 ambulante geburtshilfliche Leistungen</h2>

        <h3>#{editCalcBasicsDrg.calcBasics.dataYear}</h3>

        <h:dataTable value="#{editCalcBasicsDrg.calcBasics.kstTop.stream().filter(i -> i.ktCostCenterId == 6).toList()}" var="item"
                     columnClasses="colValue, col14, col14, col14" rowClasses="row1, row2">
            <h:column>
                <f:facet name="header">#{msg.lblNotation}</f:facet>
                <inek:InputTextWithMessage value="#{item.text}" required="#{!item.isEmpty()}"/>
            </h:column>
            <h:column>
                <f:facet name="header">#{msg.lblCaseCount}</f:facet>
                <inek:InputIntegerWithMessage value="#{item.caseCount}" required="#{!item.isEmpty()}"/>
            </h:column>
            <h:column>
                <f:facet name="header">#{msg.lblRevenueVolume}</f:facet>
                <inek:InputIntegerWithMessage value="#{item.delimitationAmount}" required="#{!item.isEmpty()}"/>
            </h:column>
            <h:column>
                <f:facet name="header">#{msg.lblMarkedOfCostVolume}</f:facet>
                <inek:InputIntegerWithMessage value="#{item.amount}" required="#{!item.isEmpty()}"/>
            </h:column>
        </h:dataTable>

        <h:panelGroup rendered="#{editCalcBasicsDrg.priorCalcBasics.kstTop.stream().filter(i -> i.ktCostCenterId == 6).filter(i -> !i.text.isEmpty()).count() > 0}">
            <h3>#{editCalcBasicsDrg.calcBasics.dataYear - 1}</h3>

            <h:dataTable value="#{editCalcBasicsDrg.priorCalcBasics.kstTop.stream().filter(i -> i.ktCostCenterId == 6).toList()}" var="item"
                         columnClasses="colValue, col14 number, col14 number, col14 number" rowClasses="row1, row2">
                <h:column>
                    <f:facet name="header">#{msg.lblNotation}</f:facet>
                    <h:outputLabel value="#{item.text}"/>
                </h:column>

                <h:column>
                    <f:facet name="header">#{msg.lblCaseCount}</f:facet>
                    <h:outputLabel value="#{item.caseCount}"><f:convertNumber/></h:outputLabel>
                </h:column>

                <h:column>
                    <f:facet name="header">#{msg.lblRevenueVolume}</f:facet>
                    <h:outputLabel value="#{item.delimitationAmount}"><f:convertNumber/></h:outputLabel>
                </h:column>

                <h:column>
                    <f:facet name="header">#{msg.lblMarkedOfCostVolume}</f:facet>
                    <h:outputLabel value="#{item.amount}"><f:convertNumber/></h:outputLabel>
                </h:column>
            </h:dataTable>
        </h:panelGroup>
        
    </div>

</ui:composition>

