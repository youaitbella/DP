<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html [<!ENTITY nbsp "&#160;">]>

<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:cb="http://inek.org/dataportal/clientbehaviour"
                xmlns:inek="http://xmlns.jcp.org/jsf/composite/components"
                xmlns:jsf="http://xmlns.jcp.org/jsf">

    <h2 title="#{msg.titleMaternityRoom}">#{msg.lblCalcMaternityRoom}</h2>

    <inek:LabeledCheckbox label="#{msg.lblHasGynecology}" 
                          styleClassLabel="label60"
                          value="#{editCalcBasicsDrg.calcBasics.gynecology}"
                          renderElement="@form"/>
    <inek:LabeledCheckbox label="#{msg.lblHasObstetrical}" 
                          styleClassLabel="label60"
                          value="#{editCalcBasicsDrg.calcBasics.obstetrical}"
                          renderElement="@form"/>

    <div jsf:id="maternity" jsf:rendered="#{editCalcBasicsDrg.calcBasics.gynecology 
                                            || editCalcBasicsDrg.calcBasics.obstetrical}">
        <h2>Erbrachte Leistungen</h2>

        <h:outputLabel styleClass="label50" value=" "/>
        <h:outputLabel styleClass="label15 number" value="#{editCalcBasicsDrg.calcBasics.dataYear}"/>
        <h:outputLabel styleClass="label15 number" value="#{editCalcBasicsDrg.calcBasics.dataYear - 1}"/>
        <h:outputLabel styleClass="label15 number" value="Abweichung"/>
        
        <br/>
        <h:outputLabel styleClass="label50" value="Summe der Aufenthaltszeit der Patientin im Kreißsaal in Stunden (ausschließlich für vollstationäre Patientinnen)"/>
        <h:inputText styleClass="element15" id="deliveryRoomHours" value="#{editCalcBasicsDrg.calcBasics.deliveryRoomHours}" required="true">
            <f:ajax event="blur" render="@this :logout:remaining" />
        </h:inputText>
        <h:outputLabel styleClass="label15 number" value="#{editCalcBasicsDrg.priorCalcBasics.deliveryRoomHours}"/>
        <h:outputLabel styleClass="label15 number" value="#{editCalcBasicsDrg.priorCalcBasics.deliveryRoomHours - editCalcBasicsDrg.calcBasics.deliveryRoomHours}"/>

        <br/>
        <h:outputLabel styleClass="label50"  value="davon für vorgeburtliche Kreißsaalaufenthalte"/>

        <h:inputText styleClass="element15" id="preBirthHabitationCnt" value="#{editCalcBasicsDrg.calcBasics.deliveryRoomPreBirthHabitationCnt}" required="true">
            <f:ajax event="blur" render="@this lblDiffPreBirthHabitantCnt :maternity:txtStructure :logout:remaining" />
        </h:inputText>
        <h:outputLabel styleClass="label15 number" id="lblPreBirthHabitantCnt" value="#{editCalcBasicsDrg.priorCalcBasics.deliveryRoomPreBirthHabitationCnt}"/>
        <h:outputLabel styleClass="label15 number" id="lblDiffPreBirthHabitantCnt" value="#{editCalcBasicsDrg.priorCalcBasics.deliveryRoomPreBirthHabitationCnt - editCalcBasicsDrg.calcBasics.deliveryRoomPreBirthHabitationCnt}"/>

        <br/>
        <h:outputLabel styleClass="label50"  value="Anzahl vollstationär geborener Kinder"/>
        <h:inputText styleClass="element15" id="instationBirthCnt" value="#{editCalcBasicsDrg.calcBasics.deliveryRoomInstationBirthCnt}" required="true">
            <f:ajax event="blur" render="@this :logout:remaining" />
        </h:inputText>
        <h:outputLabel styleClass="label15 number" value="#{editCalcBasicsDrg.priorCalcBasics.deliveryRoomInstationBirthCnt}"/>
        <h:outputLabel styleClass="label15 number" value="#{editCalcBasicsDrg.priorCalcBasics.deliveryRoomInstationBirthCnt - editCalcBasicsDrg.calcBasics.deliveryRoomInstationBirthCnt}"/>

        <h:inputTextarea id="txtStructure" styleClass="areaHuge" value="#{editCalcBasicsDrg.calcBasics.deliveryRoomOrganizationalStructure}" 
                         rendered="#{editCalcBasicsDrg.calcBasics.deliveryRoomPreBirthHabitationCnt == 0}" >
            <f:ajax event="blur" render="@this :logout:remaining" />
        </h:inputTextarea>

        <h2>Kostenstellen der erbrachten Leistungen</h2>

        <h:dataTable id="table"
                     value="#{editCalcBasicsDrg.calcBasics.obstetricsGynecologies}" 
                     var ="item"
                     width="100%"
                     columnClasses="colIcon, col20em, colValue, colValue, colValue, col05em number, col05em number, col05em number, col05em number"
                     rowClasses="row1, row2">

            <h:column id="colDeleteId">
                <f:facet name="header">
                    <h:outputText value=""/>
                </f:facet>
                <h:commandLink action="#{editCalcBasicsDrg.deleteObstreticsGynecology(item)}" immediate="true" rendered="true">
                    <h:graphicImage alt="#{msg.btnDelete}" name="Icon/small/delete.png" title="#{msg.btnDelete}" value=""/>
                    <cb:confirmDelete/>
                </h:commandLink>
            </h:column>

            <h:column>
                <f:facet name="header">Kostenstelle</f:facet>
                <h:outputLabel styleClass="label" value="#{item.serviceProvisionType.text}" rendered="#{item.serviceProvisionTypeID ge 0}"/>
                <inek:InputTextWithMessage styleClassComponent="element100" styleClass="element100" 
                                           value="#{item.domain}" rendered="#{item.serviceProvisionTypeID lt 0}"/>
            </h:column>

            <h:column>
                <f:facet name="header">Kostenstellengruppe</f:facet>
                <h:selectOneMenu id="externalProvision"
                                 required="true"
                                 requiredMessage="#{msg.msgValueNeeded}"
                                 value="#{item.providedTypeID}" 
                                 hideNoSelectionOption="true" >
                    <f:selectItem itemLabel="#{msg.lblChooseEntryShort}" itemValue="#{0}" noSelectionOption="true"/>
                    <f:selectItem itemLabel="#{msg.itemNotProvided}" itemValue="#{1}"/>
                    <f:selectItem itemLabel="#{msg.itemNotExternalProvided}" itemValue="#{2}"/>
                    <f:selectItem itemLabel="#{msg.itemExternalProvided}" itemValue="#{3}"/>
                    <f:selectItem itemLabel="#{msg.itemPartialExternalProvided}" itemValue="#{4}"/>
                    <f:ajax event="change" render="@form :logout:remaining msgLevel"/>
                </h:selectOneMenu>
            </h:column>

            <h:column>
                <f:facet name="header">Ärztlicher Dienst</f:facet>
                <inek:InputTextWithMessage id="partition" value="#{item.partitionExternalAssignment}" styleClass="inputwide" disabled="#{item.providedTypeID ne 4}"/>
            </h:column>

            <h:column>
                <f:facet name="header">davon Belegärzte</f:facet>
                <inek:InputTextWithMessage value="#{item.note}" styleClass="inputwide"/>
            </h:column>

            <h:column>
                <f:facet name="header">Pflegedienst</f:facet>
                <inek:InputTextWithMessage value="#{item.amount}" styleClass="col05em" renderElement="@form"/>
            </h:column>

            <h:column>
                <f:facet name="header">Funktionsdienst (ohne Hebammen)</f:facet>
                <inek:InputTextWithMessage value="#{editCalcBasicsDrg.priorProvisionAmount(item)}" disabled="true" styleClass="col05em"/>
            </h:column>

            <h:column>
                <f:facet name="header">Hebammen</f:facet>
                <inek:InputTextWithMessage value="#{editCalcBasicsDrg.calcPercentualDiff(editCalcBasicsDrg.priorProvisionAmount(item), item.amount)}" disabled="true" styleClass="col05em"/>
            </h:column>

            <h:column>
                <f:facet name="header">davon Beleg-Hebammen</f:facet>
                <inek:InputTextWithMessage value="#{editCalcBasicsDrg.calcPercentualDiff(editCalcBasicsDrg.priorProvisionAmount(item), item.amount)}" disabled="true" styleClass="col05em"/>
            </h:column>

        </h:dataTable>

        <h:commandLink id="addButton" styleClass="addButton inputPart" value="#{msg.btnAddEntry}"
                       rendered="#{!editCalcBasicsDrg.readOnly}">
            <f:ajax event="click" render="@form :logout:remaining" listener="#{editCalcBasicsDrg.addServiceProvision}"/>
        </h:commandLink>


        <h2>#{msg.lblTopMaternityService} #{editCalcBasicsDrg.calcBasics.dataYear}</h2>

        <h:dataTable value="#{editCalcBasicsDrg.calcBasics.kstTop.stream().filter(i -> i.ktCostCenterID == 6).toList()}" var="item">
            <h:column>
                <f:facet name="header">#{msg.lblNotation}</f:facet>
                <inek:InputTextWithMessage value="#{item.text}"/>
            </h:column>
            <h:column>
                <f:facet name="header">#{msg.lblCaseCount}</f:facet>
                <inek:InputTextWithMessage value="#{item.caseCount}"/>
            </h:column>
            <h:column>
                <f:facet name="header">#{msg.lblRevenueVolume}</f:facet>
                <inek:InputTextWithMessage value="#{item.delimitationAmount}"/>
            </h:column>
            <h:column>
                <f:facet name="header">#{msg.lblMarkedOfCostVolume}</f:facet>
                <inek:InputTextWithMessage value="#{item.amount}"/>
            </h:column>
        </h:dataTable>

        <h:panelGroup rendered="#{editCalcBasicsDrg.priorCalcBasics.kstTop.stream().filter(i -> i.ktCostCenterID == 6).count() > 0}">
            <h2>#{msg.lblTopMaternityService} #{editCalcBasicsDrg.calcBasics.dataYear - 1}</h2>

            <h:dataTable value="#{editCalcBasicsDrg.priorCalcBasics.kstTop.stream().filter(i -> i.ktCostCenterID == 6).toList()}" var="item">
                <h:column>
                    <f:facet name="header">#{msg.lblNotation}</f:facet>
                    <h:inputText value="#{item.text}" disabled="true"/>
                </h:column>
                <h:column>
                    <f:facet name="header">#{msg.lblCaseCount}</f:facet>
                    <h:inputText value="#{item.caseCount}" disabled="true"/>
                </h:column>
                <h:column>
                    <f:facet name="header">#{msg.lblRevenueVolume}</f:facet>
                    <h:inputText value="#{item.delimitationAmount}" disabled="true"/>
                </h:column>
                <h:column>
                    <f:facet name="header">#{msg.lblMarkedOfCostVolume}</f:facet>
                    <h:inputText value="#{item.amount}" disabled="true"/>
                </h:column>
            </h:dataTable>
        </h:panelGroup>
    </div>


</ui:composition>

