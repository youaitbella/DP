<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html [<!ENTITY nbsp "&#160;">]>

<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:cb="http://inek.org/dataportal/clientbehaviour"
                xmlns:inek="http://xmlns.jcp.org/jsf/composite/components"
                >

    <h:selectBooleanCheckbox value="#{editDistributionModel.showWide}">
        <f:ajax render="details"/>
    </h:selectBooleanCheckbox>
    <h:outputLabel value="breite Ansicht" styleClass="marginLeft" title="Standardmäßig werden die Felder der folgenden List so verkürzt, dass Sie in den Dialog passen. Markieren Sie breite Ansicht, um breite Eingabefelder zu erhalten. In diesem Fall können Sie den Inhalt der Liste mittels Scrollbar (Schieberegler) horizontal verschieben."/>
    
    <div class="container">

        <h:dataTable id="details"
                     value="#{editDistributionModel.model.details}" var="item"
                     styleClass="marginTop" style="width: #{editDistributionModel.showWide ? '200em' : '100%'};"
                     rowClasses="row1, row2"
                     columnClasses="colIcon, colValue, col05em, col05em, #{editDistributionModel.model.type eq 1 ? 'col4em, ' : ''} col04em, col04em, col03em, colValue, col03em, colValue, col03em, colValue, col03em, colValue, col03em, colValue">

            <h:column>
                <f:facet name="header">
                    <h:graphicImage alt="" name="Icon/small/information.png" title="Platzieren Sie den Mauszeiger auf eine Spaltenüberschrift, um zusätzliche Informationen zu erhalten."/>
                </f:facet>
                <h:commandLink action="#{editDistributionModel.deleteDetail(item)}" immediate="true" rendered="#{!editDistributionModel.readOnly}">
                    <h:graphicImage alt="#{msg.btnDelete}" name="Icon/small/delete.png" title="#{msg.btnDelete}" value=""/>
                    <cb:confirmDelete/>
                </h:commandLink>
            </h:column>

            <h:column>
                <f:facet name="header"><h:outputLabel value="Artikel" title="Artikel"/></f:facet>
                <inek:InputTextWithMessage value="#{item.article}" readonly="#{editDistributionModel.readOnly}" required="true"/>
            </h:column>

            <h:column>
                <f:facet name="header"><h:outputLabel value="KoStGrp" title="Kostenstellengruppe"/></f:facet>

                <h:selectOneMenu  value="#{item.costCenterId}" 
                                  styleClass="fullWidth"
                                  readonly="#{editDistributionModel.readOnly}" 
                                  required="true"
                                  hideNoSelectionOption="true">
                    <f:selectItem itemLabel="#{msg.lblChooseEntryShort}" itemValue="#{-1}" noSelectionOption="true"/>
                    <f:selectItems value="#{valueLists.getCostCentersCDM(editDistributionModel.model.type)}"/>
                    <f:ajax/>
                </h:selectOneMenu>
            </h:column>

            <h:column>
                <f:facet name="header"><h:outputLabel value="KoArtGrp" title="Kostenartengruppe"/></f:facet>

                <h:selectOneMenu  value="#{item.costTypeId}" 
                                  styleClass="fullWidth"
                                  readonly="#{editDistributionModel.readOnly}" 
                                  required="true"
                                  hideNoSelectionOption="true">
                    <f:selectItem itemLabel="#{msg.lblChooseEntryShort}" itemValue="#{-1}" noSelectionOption="true"/>
                    <f:selectItems value="#{valueLists.costTypesCDM}"/>
                    <f:ajax/>
                </h:selectOneMenu>
            </h:column>

            <h:column rendered="#{editDistributionModel.model.type eq 1}">
                <f:facet name="header"><h:outputLabel value="Pflegetage" title="Anzahl Pflegetage"/></f:facet>
                <inek:InputTextWithMessage value="#{item.countCaredays}" readonly="#{editDistributionModel.readOnly}" required="true"/>
            </h:column>

            <h:column class="col4em">
                <f:facet name="header"><h:outputLabel value="Fallzahl" title="Anzahl Fälle"/></f:facet>
                <inek:InputNumberWithMessage value="#{item.countCases}" readonly="#{editDistributionModel.readOnly}" required="true"/>
            </h:column>

            <h:column class="col4em">
                <f:facet name="header"><h:outputLabel value="Kostenvolumen" title="Kostenvolumen (€)"/></f:facet>
                <inek:InputNumberWithMessage value="#{item.costVolume}" readonly="#{editDistributionModel.readOnly}" required="true"/>
            </h:column>

            <h:column>
                <f:facet name="header"><h:outputLabel value="OPS" title="Verteilung basiert auf Prozedurencode (OPS)"/></f:facet>
                <inek:Checkbox value="#{item.useProcCode}" readonly="#{editDistributionModel.readOnly}" renderElement="details"/>
            </h:column>

            <h:column rendered="#{editDistributionModel.model.details.stream().anyMatch(d -> d.isUseProcCode())}">
                <f:facet name="header"><h:outputLabel value="Erläuterung OPS" title="Optionale Erläuterung zur Verteilung via Prozeduren, z.B. Angabe des oder der OPS Codes"/></f:facet>
                <inek:InputTextWithMessage value="#{item.noteProcCode}" disabled="#{editDistributionModel.readOnly or not item.useProcCode}"/>
            </h:column>

            <h:column>
                <f:facet name="header"><h:outputLabel value="ICD" title="Verteilung basiert auf Diagnosencode (ICD)"/></f:facet>
                <inek:Checkbox value="#{item.useDiagCode}" readonly="#{editDistributionModel.readOnly}" renderElement="details" styleClass="col03em"/>
            </h:column>

            <h:column rendered="#{editDistributionModel.model.details.stream().anyMatch(d -> d.isUseDiagCode())}">
                <f:facet name="header"><h:outputLabel value="Erläuterung ICD" title="Optionale Erläuterung zur Verteilung via Diagnosen, z.B. Angabe des oder der ICD Codes"/></f:facet>
                <inek:InputTextWithMessage value="#{item.noteDiagCode}" disabled="#{editDistributionModel.readOnly or not item.useDiagCode}"/>
            </h:column>

            <h:column>
                <f:facet name="header"><h:outputLabel value="#{editDistributionModel.model.type eq 0 ? 'DRG' : 'PEPP'}" 
                                                      title="Verteilung basiert auf Fallgruppierung (#{editDistributionModel.model.type eq 0 ? 'DRG' : 'PEPP'})"/></f:facet>
                <inek:Checkbox value="#{item.useGroupResult}" readonly="#{editDistributionModel.readOnly}" renderElement="details" styleClass="col03em"/>
            </h:column>

            <h:column rendered="#{editDistributionModel.model.details.stream().anyMatch(d -> d.isUseGroupResult())}">
                <f:facet name="header"><h:outputLabel value="Erläuterung #{editDistributionModel.model.type eq 0 ? 'DRG' : 'PEPP'}" title="Optionale Erläuterung zur Verteilung via Fallgruppierung"/></f:facet>
                <inek:InputTextWithMessage value="#{item.noteGroupResult}" disabled="#{editDistributionModel.readOnly or not item.useGroupResult}"/>
            </h:column>

            <h:column>
                <f:facet name="header"><h:outputLabel value="sonstiger Schlüssel" title="Verteilung basiert auf einem sonstigen Schlüssel - bitte erläutern"/></f:facet>
                <inek:Checkbox value="#{item.useOtherCode}" readonly="#{editDistributionModel.readOnly}" renderElement="details" styleClass="col03em"/>
            </h:column>

            <h:column rendered="#{editDistributionModel.model.details.stream().anyMatch(d -> d.isUseOtherCode())}">
                <f:facet name="header"><h:outputLabel value="Erläuterung sonstiger Schlüssel" title="Erläuterung zur Verteilung via sonstigem Schlüssel"/></f:facet>
                <inek:InputTextWithMessage value="#{item.noteOtherCode}" disabled="#{editDistributionModel.readOnly or not item.useOtherCode}" required="#{not editDistributionModel.readOnly and item.useOtherCode}"/>
            </h:column>

            <h:column>
                <f:facet name="header"><h:outputLabel value="genehmigt" title="Das InEK hat die geplante Kostenverteilung geprüft und genehmigt"/></f:facet>
                <inek:Checkbox value="#{item.approved}" readonly="#{editDistributionModel.readOnly or not sessionController.isInekUser('CALCULATION_HOSPITAL')}" styleClass="col03em"/>
            </h:column>

            <h:column>
                <f:facet name="header"><h:outputLabel value="Bemerkung" title="Bemerkung (vom InEK)"/></f:facet>
                <inek:InputTextWithMessage value="#{item.approvalNote}" readonly="#{editDistributionModel.readOnly or not sessionController.isInekUser('CALCULATION_HOSPITAL')}"/>
            </h:column>

        </h:dataTable>
    </div>

    <h:commandLink styleClass="addButton marginRight" value="#{msg.btnAddEntry}"
                   rendered="#{!editDistributionModel.readOnly}">
        <f:ajax event="click" render="@form :logout:remaining" listener="#{editDistributionModel.addDetail()}"/>
    </h:commandLink>

</ui:composition>

