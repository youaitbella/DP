<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html [<!ENTITY nbsp "&#160;">]>
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/Templates/PortalMenuTemplate.xhtml"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:cb="http://inek.org/dataportal/clientbehaviour"
                xmlns:c="http://java.sun.com/jsp/jstl/core">

    <f:metadata>
        <f:viewParam name="noticeId" id="noticeId" value="#{flash.noticeId}" />
    </f:metadata>

    <ui:define name="content">
        <h:form>
            <h1>
                <h:commandLink value="#{msg.nameINSURANCE}" action="#{sessionController.navigate(sessionTools.pages.InsuranceSummary)}" immediate="true"/>
            </h1>
        </h:form>
        <div class="edit">
        
        <h:form id="addressForm">

            <div class="inputPart">
                <h:outputLabel for="insuranceName" styleClass="label" value="#{msg.lblInsuranceName}:" />
                <h:message for="insuranceName" id="msgInsuranceName" styleClass="errorMessage"/>
                <br />
                <h:inputText styleClass="inputlong" readonly="#{editInsuranceNubNotice.readOnly}" maxlength="100" id="insuranceName" 
                             value="#{editInsuranceNubNotice.notice.insuranceName}" required="true" requiredMessage="#{msg.msgValueNeeded}">
                    <f:ajax event="blur" render="@this :logout:remaining msgInsuranceName"/>
                </h:inputText>
            </div>

            <div class="inputPart">
                <h:outputLabel for="insuranceIk" styleClass="label" value="#{msg.lblInsuranceIk}:" />
                <h:message for="insuranceIk" id="msgInsuranceIk" styleClass="errorMessage"/>
                <br />
                <h:inputText styleClass="inputSmall" readonly="#{editInsuranceNubNotice.readOnly}" id="insuranceIk" 
                             value="#{editInsuranceNubNotice.notice.insuranceIk}">
                    <f:converter converterId="IntegerConverter" />
                    <f:ajax event="blur" render="@this :logout:remaining msgInsuranceIk"/>
                </h:inputText>
            </div>

            <div class="inputPart">
                <h:outputLabel for="year" styleClass="label" value="#{msg.lblYear}:" />
                <h:message for="year" id="msgYear" styleClass="errorMessage"/>
                <br />
                <h:inputText styleClass="inputSmall" readonly="#{editInsuranceNubNotice.readOnly}" id="year" 
                             value="#{editInsuranceNubNotice.notice.year}">
                    <f:converter converterId="IntegerConverter" />
                    <f:ajax event="blur" render="@this :logout:remaining msgYear"/>
                </h:inputText>
            </div>

            <div class="inputPart">
                <h:outputLabel for="hospitalIk" styleClass="label" value="#{msg.lblHospitalIk}:" />
                <h:message for="hospitalIk" id="msgHospitalIk" styleClass="errorMessage"/>
                <br />
                <h:inputText styleClass="inputSmall" readonly="#{editInsuranceNubNotice.readOnly}" id="hospitalIk" 
                             value="#{editInsuranceNubNotice.notice.hospitalIk}"
                             required="true" requiredMessage="#{msg.msgValueNeeded}"
                             validator="#{sessionTools.checkIk}">
                    <f:converter converterId="IntegerConverter" />
                    <f:ajax event="blur" render="@this :logout:remaining msgHospitalIk hospitalName"/>
                </h:inputText>
                <h:outputText id="hospitalName" styleClass="marginLeft" value="#{sessionController.getIkName(editInsuranceNubNotice.notice.hospitalIk)}"/>
            </div>

        </h:form>
        
        <h:form id="costUploadForm" rendered="#{!editInsuranceNubNotice.readOnly}" enctype="multipart/form-data" style="margin-top: 40px;">
            <div class="uploadFile">
                <h:inputFile styleClass="hiddenFile" id="file" value="#{editInsuranceNubNotice.file}" title="#{msg.btnUploadMessage}" >
                    <f:ajax listener="#{editInsuranceNubNotice.uploadNotices()}" render="@all"/>
                </h:inputFile>
                <div class="fakeFile">
                    <h:outputLabel styleClass="button" value="#{msg.btnUploadMessage}"/>
                </div>
            </div>
        </h:form>

        <h:form id="messageForm">
            <h:dataTable  headerClass="list-header" id="tblNotices"
                          value="#{editInsuranceNubNotice.notice.items}" var="item" width="100%" rowClasses="row1, row2" 
                          columnClasses="colIcon, col09, col11, col09, col05, col05, col04, col06, col11, col11, col01">

                <h:column>
                    <f:facet name="header">
                        <h:outputText value=""/>
                    </f:facet>
                    <h:commandLink action="#{editInsuranceNubNotice.deleteItem(item)}" immediate="true" styleClass="colIcon">
                        <h:graphicImage alt="#{msg.btnDelete}" name="Icon/small/delete.png" title="#{msg.btnDelete}" value=""/>
                        <cb:confirmDelete/>
                    </h:commandLink>
                </h:column>

                <h:column>
                    <f:facet name="header">
                        <h:outputText value="#{msg.lblNubId}"/>
                    </f:facet>
                    <h:selectOneMenu value="#{item.nubRequestId}" hideNoSelectionOption="true" styleClass="col07em">
                        <f:selectItem itemLabel="#{msg.lblChooseEntryShort}" itemValue="#{0}" noSelectionOption="true"/>
                        <f:selectItems value="#{editInsuranceNubNotice.nubMethodInfos}" var="info" itemLabel="#{info}" itemValue="#{info.requestId}"/>
                        <f:ajax render="@form :logout:remaining"/>
                    </h:selectOneMenu>
                </h:column>

                <h:column>
                    <f:facet name="header">
                        <h:outputText value="#{msg.lblName}"/>
                    </f:facet>
                    <h:selectOneMenu value="#{item.nubRequestId}" hideNoSelectionOption="true" styleClass="col10em" required="true">
                        <f:selectItem itemLabel="#{msg.lblChooseEntryShort}" itemValue="#{0}" noSelectionOption="true"/>
                        <f:selectItems value="#{editInsuranceNubNotice.inekMethods}" var="m" itemLabel="#{m.label}" itemValue="#{m.value}" itemDescription="#{m.description}"/>
                        <f:ajax render="@form :logout:remaining"/>
                    </h:selectOneMenu>
                </h:column>

                <h:column>
                    <f:facet name="header">
                        <h:outputText value="#{msg.lblForm}"/>
                    </f:facet>
                    <h:selectOneMenu value="#{item.dosageFormId}" hideNoSelectionOption="true" styleClass="col07em">
                        <f:selectItem itemLabel="#{msg.lblChooseEntryShort}" itemValue="#{0}" noSelectionOption="true"/>
                        <f:selectItems value="#{editInsuranceNubNotice.dosageForms}" var="dosageForm" itemLabel="#{dosageForm.text}" itemValue="#{dosageForm.id}"/>
                        <f:ajax render="@this :logout:remaining"/>
                    </h:selectOneMenu>
                </h:column>

                <h:column>
                    <f:facet name="header">
                        <h:outputText value="#{msg.lblAmount}"/>
                    </f:facet>
                    <h:inputText value="#{item.amount}" styleClass="fullWidth">
                        <f:ajax render="@this :logout:remaining "/>
                    </h:inputText>
                </h:column>

                <h:column>
                    <f:facet name="header">
                        <h:outputText value="#{msg.lblUnit}"/>
                    </f:facet>
                    <h:selectOneMenu value="#{item.unitId}" hideNoSelectionOption="true" styleClass="fullWidth">
                        <f:selectItem itemLabel="#{msg.lblChooseEntryShort}" itemValue="#{0}" noSelectionOption="true"/>
                        <f:selectItems value="#{editInsuranceNubNotice.units}" var="unit" itemLabel="#{unit.text}" itemValue="#{unit.id}"/>
                        <f:ajax render="@this :logout:remaining"/>
                    </h:selectOneMenu>
                </h:column>

                <h:column>
                    <f:facet name="header">
                        <h:outputText value="#{msg.lblCount}"/>
                    </f:facet>
                    <h:inputText value="#{item.quantity}" required="true" styleClass="fullWidth">
                        <f:ajax render="@this :logout:remaining "/>
                    </h:inputText>
                </h:column>

                <h:column>
                    <f:facet name="header">
                        <h:outputText value="#{msg.lblPrice}"/>
                    </f:facet>
                    <h:inputText required="true" value="#{item.price}" styleClass="fullWidth">
                        <f:ajax render="@this :logout:remaining "/>
                    </h:inputText>
                </h:column>

                <h:column>
                    <f:facet name="header">
                        <h:outputText value="#{msg.lblRemunerationCode}"/>
                    </f:facet>
                    <h:inputText id="remun" required="true" value="#{item.remunerationTypeCharId}" styleClass="fullWidth" validator="#{editInsuranceNubNotice.validateRemuneration}">
                        <f:ajax render="@this :logout:remaining msgRemun"/>
                    </h:inputText>
                    <h:message for="remun" id="msgRemun" styleClass="errorMessage" />
                </h:column>

                <h:column>
                    <f:facet name="header">
                        <h:outputText value="#{msg.lblProcedures}"/>
                    </f:facet>
                    <h:inputTextarea id="proc" value="#{item.procedures}" styleClass="areaLow fullWidth" validator="#{editInsuranceNubNotice.validateProcedures}">
                        <f:ajax render="@this :logout:remaining msgProc"/>
                    </h:inputTextarea>
                    <h:message for="proc" id="msgProc" styleClass="errorMessage"/>
                </h:column>

                <h:column>
                    <f:facet name="header">
                        <h:outputText value="#{msg.lblComment}"/>
                    </f:facet>
                    <h:inputTextarea value="#{item.note}" styleClass="areaLow fullWidth">
                        <f:ajax render="@this :logout:remaining "/>
                    </h:inputTextarea>
                </h:column>

            </h:dataTable>
            
            <h:commandLink id="addButton" styleClass="addButton inputPart" value="#{msg.btnAddEntry}"
                           rendered="#{!editInsuranceNubNotice.readOnly}">
                <f:ajax event="click" render="@form :logout:remaining" listener="#{editInsuranceNubNotice.addItem}"/>
            </h:commandLink>
        </h:form>

            <h:form id="buttons">
                <div class="toolBar  floatContainer">
                    <h:commandLink styleClass="bigButton" 
                                   action="#{editInsuranceNubNotice.save}" 
                                   value="#{msg.btnSave}" 
                                   immediate="true">
                        <f:ajax render="@all"/>
                    </h:commandLink>

                    <h:commandLink styleClass="sendButton"
                                   action="#{editInsuranceNubNotice.provide}"
                                   value="#{msg.btnSaveAndClose}"
                                   rendered="#{editInsuranceNubNotice.provideEnabled}"
                                   title="#{msg.infoSaveAndClose}">
                        <cb:confirmSeal/>
                    </h:commandLink>
                </div>
            </h:form>
        </div>

    </ui:define>

</ui:composition>
