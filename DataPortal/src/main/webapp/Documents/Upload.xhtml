<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html [<!ENTITY nbsp "&#160;">]>
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
                template="Manager.xhtml"
                xmlns:cb="http://inek.org/dataportal/clientbehaviour"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:jsf="http://xmlns.jcp.org/jsf">

    <ui:define name="documentContent">
        <h:outputStylesheet name="css/fileuploader.css"/>
        <h:outputScript name="script/fileuploader.js"/>
        <script>
            var fileCounter = 0;
            function createUploader() {
                var uploader = new qq.FileUploader({
                    element: document.getElementById('file-uploader'),
                    action: '/DataPortal/upload/nubrequest',
                    debug: true,
                    allowedExtensions: ['png', 'jpg', 'pdf', 'txt', 'odt', 'doc', 'docx', 'odc', 'xls', 'xlsx'],
                    onSubmit: function (id, fileName) {
                        fileCounter++;
                    },
                    onCancel: function (id, fileName) {
                        fileCounter--;
                        if (fileCounter === 0) {
                        }
                    },
                    onComplete: function (id, fileName, responseJSON) {
                        fileCounter--;
                        if (fileCounter === 0) {
                            document.getElementById('form:refresh').click();
                        }
                    },
                    template: '<div class="qq-uploader">' +
                            '<div class="qq-upload-drop-area"><span>Dateien mittels Ziehen und Ablegen hochladen.</span></div>' +
                            '<div class="qq-upload-button">Datei hochladen</div>' +
                            '<ul class="qq-upload-list"></ul>' +
                            '</div>'
                });
            }
        </script>

        <h:form id="uploadDocs" enctype="multipart/form-data">
            <f:ajax render="@all :logout:remaining">
                <h:selectOneRadio styleClass="radioGroup" id="radDocumentTarget" value="#{documentUpload.documentTarget}" >
                    <f:selectItem itemLabel="#{msg.lblUserAccount} &nbsp;" itemValue="Account"/>
                    <f:selectItem itemLabel="#{msg.lblAgency} &nbsp;" itemValue="Agency"/>
                </h:selectOneRadio>
            </f:ajax>

            <h:panelGroup id="Account" rendered="#{documentUpload.documentTarget eq 'Account'}" styleClass="marginTop">
                <div class="inputPart">
                    <h:outputLabel for="UserEmail" value="#{msg.lblEMail}" styleClass="label20"/>
                    <h:inputText id="UserEmail" value="#{documentUpload.email}" validator="#{documentUpload.checkEmail}" styleClass="inputlong">
                        <f:ajax render="@form :logout:remaining" immediate="true"/>
                    </h:inputText>
                    <h:message id="msgUserEmail" for="UserEmail" styleClass="errorMessage"/>
                </div>                    

                <div class="inputPart">
                    <h:outputLabel for="accountId" value="AccountId" styleClass="label20"/>
                    <h:inputText id="accountId" value="#{documentUpload.accountId}" validator="#{documentUpload.checkAccountId}" styleClass="inputmedium">
                        <f:ajax render="@form :logout:remaining"/>
                    </h:inputText>
                    <h:message id="msgAccountId" for="accountId" styleClass="errorMessage"/>
                </div>        

                <div class="inputPart">
                    <h:outputLabel value="#{msg.lblName}" styleClass="label20"/>
                    <h:inputText id="UserName" value="#{documentUpload.account.firstName} #{documentUpload.account.lastName}" disabled="true" styleClass="inputlong"/>
                </div>        

                <div class="inputPart">
                    <h:outputLabel value="#{msg.lblHospital}" styleClass="label20"/>
                    <h:inputText id="UserInstitute" value="#{documentUpload.account.company}" disabled="true" styleClass="inputlong"/>
                </div>        

            </h:panelGroup>

            <h:panelGroup id="Agency" rendered="#{documentUpload.documentTarget eq 'Agency'}" styleClass="marginTop">
                <div>
                    <h:selectOneMenu value="#{documentUpload.agency}" styleClass="inputmedium" hideNoSelectionOption="true">
                        <f:selectItem itemLabel="#{msg.lblChooseEntry}" itemValue="#{null}" noSelectionOption="true"/>
                        <f:selectItems value="#{documentUpload.agencies}" var="agency" itemLabel="#{agency.name}" itemValue="#{agency.id}"/>
                        <f:ajax render="@form :logout:remaining"/>
                    </h:selectOneMenu>
                </div>
            </h:panelGroup>

            <div class="inputPart">
                <h:outputLabel value="#{msg.lblAvailability}" styleClass="label20"/>
                <h:inputText value="#{documentUpload.availability}" >
                    <f:ajax render="@form :logout:remaining"/>
                </h:inputText>
            </div>        

            <div>
                <h:outputLabel value="#{msg.lblDomain}" styleClass="label20"/>
                <h:selectOneMenu id="domainId" value="#{documentUpload.domainId}" styleClass="inputmedium" hideNoSelectionOption="true" required="true">
                    <f:selectItem itemLabel="#{msg.lblChooseEntry}" itemValue="#{null}" noSelectionOption="true"/>
                    <f:selectItems value="#{documentUpload.domains}" var="domain" itemLabel="#{domain.name}" itemValue="#{domain.id}"/>
                    <f:ajax render="@form :logout:remaining"/>
                </h:selectOneMenu>
                <h:message for="domainId" styleClass="errorMessage"/>
            </div>

            <h:panelGroup id="lastDocs" rendered="#{documentUpload.lastDocuments.size() gt 0}" styleClass="marginTop">
                <br/>
                <h:outputLabel value="#{msg.lblLatestFiles}:" styleClass="label"/>
                <ui:repeat value="#{documentUpload.lastDocuments}" var="name">
                    <p>#{name}</p>
                </ui:repeat>
            </h:panelGroup>

            <hr/>

            <h:panelGroup id="documentUpload">
                <div class="uploadFile">
                    <h:inputFile styleClass="hiddenFile" id="file" value="#{documentUpload.file}" title="#{msg.btnUploadDocument}">
                        <f:ajax listener="#{documentUpload.uploadDoc()}" render="documentUpload"/>
                    </h:inputFile>
                    <div class="fakeFile">
                        <h:outputLabel styleClass="button" value="#{msg.btnUploadDocument}"/>
                    </div>
                </div>

                  
                <div  jsf:rendered="#{documentUpload.file ne null and documentUpload.domainId gt 0 and (documentUpload.account ne null or documentUpload.agency ne null)}" class="marginTop">
                    <div>
                        <h:outputLabel value="#{msg.lblFile}: #{documentUpload.file.submittedFileName}"/>
                    </div>
                    <h:commandLink styleClass="bigButton" action="#{documentUpload.saveDocument}" value="#{msg.btnSaveDocument}" immediate="true"/>
                </div>
                
                <h:messages />
            </h:panelGroup>

        </h:form>



    </ui:define>
</ui:composition>
